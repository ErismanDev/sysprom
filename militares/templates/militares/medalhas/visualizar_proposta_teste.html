<!DOCTYPE html>
<html>
<head>
    <title>Teste Visualizar Proposta</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .content { background: white; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .btn { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; margin: 5px; }
        .btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Teste de Visualização de Proposta</h1>
            <p>ID da Proposta: {{ proposta.pk|default:"N/A" }}</p>
        </div>
        
        {% if erro %}
        <div class="error">
            <h3>Erro:</h3>
            <p>{{ erro }}</p>
        </div>
        {% endif %}
        
        {% if proposta %}
        <div class="info">
            <h3>Proposta Encontrada:</h3>
            <p><strong>Número:</strong> {{ proposta.numero_proposta }}</p>
            <p><strong>Título:</strong> {{ proposta.titulo }}</p>
            <p><strong>Status:</strong> {{ proposta.get_status_display }}</p>
            <p><strong>Criada por:</strong> {{ proposta.criado_por.get_full_name|default:proposta.criado_por.username }}</p>
            <p><strong>Data de criação:</strong> {{ proposta.criado_em|date:"d/m/Y H:i" }}</p>
            <p><strong>Total de concessões:</strong> {{ proposta.get_total_concessoes }}</p>
        </div>
        
        <div class="content">
            <h3>Concessões por Categoria:</h3>
            {% if concessoes_por_categoria %}
                {% for categoria, concessoes in concessoes_por_categoria.items %}
                <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #dee2e6; border-radius: 5px;">
                    <h4>{{ categoria }}</h4>
                    <p>Total: {{ concessoes|length }} concessão(ões)</p>
                    <ul>
                    {% for concessao in concessoes %}
                        <li>{{ concessao.militar.nome_guerra }} - {{ concessao.get_status_display }}</li>
                    {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            {% else %}
                <p>Nenhuma concessão encontrada para esta proposta.</p>
            {% endif %}
        </div>
        {% endif %}
        
        <div style="margin-top: 20px; text-align: center;">
            <a href="{% url 'militares:lista_propostas' %}" class="btn">Voltar à Lista</a>
            <a href="{% url 'militares:concessoes_list' %}" class="btn">Voltar às Concessões</a>
        </div>
    </div>
</body>
</html>
