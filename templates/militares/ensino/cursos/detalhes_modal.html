{% load static %}

<div class="modal-header bg-primary text-white">
    <h5 class="modal-title" id="detalhesCursoModalLabel{{ curso.pk }}">
        <i class="fas fa-book me-2"></i>
        Detalhes do Curso: {{ curso.codigo|default:curso.nome }}
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
</div>

<div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
    <!-- Informações Básicas -->
    <div class="card mb-3">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>
                Informações Básicas
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Código:</dt>
                        <dd class="col-sm-7"><strong>{{ curso.codigo|default:"Não informado" }}</strong></dd>
                        
                        <dt class="col-sm-5">Nome:</dt>
                        <dd class="col-sm-7">{{ curso.nome|default:"Não informado" }}</dd>
                        
                        <dt class="col-sm-5">Tipo de Curso:</dt>
                        <dd class="col-sm-7">
                            {% if curso.tipo_curso %}
                                {{ curso.get_tipo_curso_display }}
                            {% else %}
                                <span class="text-muted">Não informado</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Modalidade:</dt>
                        <dd class="col-sm-7">
                            {% if curso.modalidade %}
                                {{ curso.get_modalidade_display }}
                            {% else %}
                                <span class="text-muted">Não informado</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Público-Alvo:</dt>
                        <dd class="col-sm-7">
                            {% if curso.publico_alvo %}
                                {{ curso.get_publico_alvo_display }}
                            {% else %}
                                <span class="text-muted">Não informado</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7">
                            {% if curso.status %}
                                <span class="badge {% if curso.status == 'ATIVO' %}bg-success{% elif curso.status == 'INATIVO' %}bg-danger{% else %}bg-warning{% endif %}">
                                    {{ curso.get_status_display }}
                                </span>
                            {% else %}
                                <span class="text-muted">Não informado</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Ativo:</dt>
                        <dd class="col-sm-7">
                            {% if curso.ativo %}
                                <span class="badge bg-success">Sim</span>
                            {% else %}
                                <span class="badge bg-secondary">Não</span>
                            {% endif %}
                        </dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Carga Horária:</dt>
                        <dd class="col-sm-7">
                            {% if curso.carga_horaria %}
                                {{ curso.carga_horaria }} horas
                            {% else %}
                                <span class="text-muted">Não informado</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Unidade Responsável:</dt>
                        <dd class="col-sm-7">{{ curso.unidade_responsavel|default:"Não informado" }}</dd>
                        
                        <dt class="col-sm-5">Data de Criação:</dt>
                        <dd class="col-sm-7">{{ curso.data_criacao|date:"d/m/Y H:i" }}</dd>
                        
                        <dt class="col-sm-5">Última Atualização:</dt>
                        <dd class="col-sm-7">{{ curso.data_atualizacao|date:"d/m/Y H:i" }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Descrição e Objetivos -->
    {% if curso.finalidade or curso.descricao_resumida or curso.objetivos_especificos %}
    <div class="card mb-3">
        <div class="card-header bg-info text-white">
            <h6 class="mb-0">
                <i class="fas fa-bullseye me-2"></i>
                Descrição e Objetivos
            </h6>
        </div>
        <div class="card-body">
            {% if curso.descricao_resumida %}
            <div class="mb-2">
                <strong>Descrição Resumida:</strong>
                <p class="mb-0">{{ curso.descricao_resumida|linebreaks }}</p>
            </div>
            {% endif %}
            
            {% if curso.finalidade %}
            <div class="mb-2">
                <strong>Objetivo Geral / Finalidade:</strong>
                <p class="mb-0">{{ curso.finalidade|linebreaks }}</p>
            </div>
            {% endif %}
            
            {% if curso.objetivos_especificos %}
            <div class="mb-2">
                <strong>Objetivos Específicos:</strong>
                <p class="mb-0">{{ curso.objetivos_especificos|linebreaks }}</p>
            </div>
            {% endif %}
            
            {% if curso.competencias_habilidades %}
            <div>
                <strong>Competências e Habilidades:</strong>
                <p class="mb-0">{{ curso.competencias_habilidades|linebreaks }}</p>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- Disciplinas -->
    {% if disciplinas_curso %}
    <div class="card mb-3">
        <div class="card-header bg-success text-white">
            <h6 class="mb-0">
                <i class="fas fa-list-ul me-2"></i>
                Disciplinas do Curso
                <span class="badge bg-light text-dark ms-2">{{ disciplinas_curso.count }}</span>
            </h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Ordem</th>
                            <th>Disciplina</th>
                            <th>Tipo</th>
                            <th>Carga Horária</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for disc_curso in disciplinas_curso %}
                        <tr>
                            <td>{{ disc_curso.ordem }}</td>
                            <td>
                                <a href="{% url 'militares:ensino_disciplina_detalhes' pk=disc_curso.disciplina.pk %}" class="text-decoration-none" target="_blank">
                                    {{ disc_curso.disciplina.nome }}
                                </a>
                            </td>
                            <td>
                                <span class="badge bg-info">{{ disc_curso.get_tipo_display }}</span>
                            </td>
                            <td>
                                {% if disc_curso.carga_horaria_curso %}
                                    {{ disc_curso.carga_horaria_curso }}h
                                {% else %}
                                    {{ disc_curso.disciplina.carga_horaria|default:"-" }}h
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Turmas -->
    {% if turmas %}
    <div class="card mb-3">
        <div class="card-header bg-warning text-dark">
            <h6 class="mb-0">
                <i class="fas fa-users me-2"></i>
                Turmas
                <span class="badge bg-light text-dark ms-2">{{ turmas.count }}</span>
            </h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Identificação</th>
                            <th>Data Início</th>
                            <th>Data Fim</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for turma in turmas %}
                        <tr>
                            <td>{{ turma.identificacao }}</td>
                            <td>{{ turma.data_inicio|date:"d/m/Y"|default:"-" }}</td>
                            <td>{{ turma.data_fim|date:"d/m/Y"|default:"-" }}</td>
                            <td>
                                {% if turma.ativa %}
                                    <span class="badge bg-success">Ativa</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inativa</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Documentos -->
    {% if curso.documentos.all %}
    <div class="card mb-3">
        <div class="card-header bg-secondary text-white">
            <h6 class="mb-0">
                <i class="fas fa-file-alt me-2"></i>
                Documentos
                <span class="badge bg-light text-dark ms-2">{{ curso.documentos.count }}</span>
            </h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Título</th>
                            <th>Data Upload</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for doc in curso.documentos.all %}
                        <tr>
                            <td>{{ doc.get_tipo_display }}</td>
                            <td>{{ doc.titulo }}</td>
                            <td>{{ doc.data_upload|date:"d/m/Y H:i" }}</td>
                            <td>
                                <a href="{{ doc.arquivo.url }}" target="_blank" class="btn btn-sm btn-info">
                                    <i class="fas fa-download"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Arquivos Legados -->
    {% if curso.ementa or curso.plano_curso or curso.plano_pedagogico or curso.matriz_curricular %}
    <div class="card mb-3">
        <div class="card-header bg-dark text-white">
            <h6 class="mb-0">
                <i class="fas fa-file-pdf me-2"></i>
                Arquivos
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                {% if curso.ementa %}
                <div class="col-md-6 mb-2">
                    <a href="{{ curso.ementa.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-download me-1"></i>Ementa
                    </a>
                </div>
                {% endif %}
                
                {% if curso.plano_curso %}
                <div class="col-md-6 mb-2">
                    <a href="{{ curso.plano_curso.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-download me-1"></i>Plano de Curso
                    </a>
                </div>
                {% endif %}
                
                {% if curso.plano_pedagogico %}
                <div class="col-md-6 mb-2">
                    <a href="{{ curso.plano_pedagogico.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-download me-1"></i>Plano Pedagógico
                    </a>
                </div>
                {% endif %}
                
                {% if curso.matriz_curricular %}
                <div class="col-md-6 mb-2">
                    <a href="{{ curso.matriz_curricular.url }}" target="_blank" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-download me-1"></i>Matriz Curricular
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div class="modal-footer">
    {% if menu_permissions.ENSINO_EDITAR or user.is_superuser %}
    <button type="button" class="btn btn-warning btn-editar-curso-modal" data-curso-id="{{ curso.pk }}">
        <i class="fas fa-edit me-2"></i>Editar
    </button>
    {% endif %}
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
</div>

<script>
(function() {
    'use strict';
    
    // Listener para o botão de editar dentro do modal de detalhes
    document.addEventListener('click', function(e) {
        if (e.target.closest('.btn-editar-curso-modal')) {
            const btn = e.target.closest('.btn-editar-curso-modal');
            const cursoId = btn.getAttribute('data-curso-id');
            
            // Fechar modal de detalhes
            const detalhesModal = btn.closest('.modal');
            if (detalhesModal) {
                const bootstrapModal = bootstrap.Modal.getInstance(detalhesModal);
                if (bootstrapModal) {
                    bootstrapModal.hide();
                }
            }
            
            // Abrir modal de edição
            setTimeout(function() {
                const editarModal = document.getElementById('editarCursoModalLista');
                if (editarModal) {
                    editarModal.setAttribute('data-curso-id', cursoId);
                    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                        const modal = new bootstrap.Modal(editarModal);
                        modal.show();
                    }
                }
            }, 300);
        }
    });
})();
</script>

