<div class="modal-header bg-primary text-white">
    <h5 class="modal-title" id="detalhesTurmaModalListaLabel">
        <i class="fas fa-users me-2"></i>
        Detalhes da Turma
    </h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
</div>
<div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
    <!-- Informações Básicas -->
    <div class="card mb-3">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>
                Informações Básicas
            </h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Identificação:</dt>
                        <dd class="col-sm-7"><strong>{{ turma.identificacao }}</strong></dd>
                        
                        <dt class="col-sm-5">Curso:</dt>
                        <dd class="col-sm-7">
                            <a href="{% url 'militares:ensino_curso_detalhes' pk=turma.curso.pk %}" class="text-decoration-none">
                                {{ turma.curso.nome }}
                            </a>
                        </dd>
                        
                        <dt class="col-sm-5">Data de Início:</dt>
                        <dd class="col-sm-7">{{ turma.data_inicio|date:"d/m/Y"|default:"Não informado" }}</dd>
                        
                        <dt class="col-sm-5">Data de Término:</dt>
                        <dd class="col-sm-7">{{ turma.data_fim|date:"d/m/Y"|default:"Não informado" }}</dd>
                        
                        <dt class="col-sm-5">Status:</dt>
                        <dd class="col-sm-7">
                            {% if turma.ativa %}
                                <span class="badge bg-success">Ativa</span>
                            {% else %}
                                <span class="badge bg-secondary">Inativa</span>
                            {% endif %}
                        </dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Supervisor do Curso:</dt>
                        <dd class="col-sm-7">
                            {% if turma.supervisor_curso %}
                                <small>{{ turma.supervisor_curso.get_posto_graduacao_display }} {{ turma.supervisor_curso.nome_completo }}</small>
                            {% else %}
                                <span class="text-muted">Não definido</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Coordenador do Curso:</dt>
                        <dd class="col-sm-7">
                            {% if turma.coordenador_curso %}
                                <small>{{ turma.coordenador_curso.get_posto_graduacao_display }} {{ turma.coordenador_curso.nome_completo }}</small>
                            {% else %}
                                <span class="text-muted">Não definido</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Supervisor de Turma:</dt>
                        <dd class="col-sm-7">
                            {% if turma.supervisor_turma %}
                                <small>{{ turma.supervisor_turma.get_posto_graduacao_display }} {{ turma.supervisor_turma.nome_completo }}</small>
                            {% else %}
                                <span class="text-muted">Não definido</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Coordenador de Turma:</dt>
                        <dd class="col-sm-7">
                            {% if turma.coordenador_turma %}
                                <small>{{ turma.coordenador_turma.get_posto_graduacao_display }} {{ turma.coordenador_turma.nome_completo }}</small>
                            {% else %}
                                <span class="text-muted">Não definido</span>
                            {% endif %}
                        </dd>
                        
                        <dt class="col-sm-5">Data de Criação:</dt>
                        <dd class="col-sm-7">{{ turma.data_criacao|date:"d/m/Y H:i" }}</dd>
                        
                        <dt class="col-sm-5">Última Atualização:</dt>
                        <dd class="col-sm-7">{{ turma.data_atualizacao|date:"d/m/Y H:i" }}</dd>
                    </dl>
                </div>
            </div>
            
            {% if turma.observacoes %}
            <div class="row mt-3">
                <div class="col-12">
                    <h6>Observações:</h6>
                    <p>{{ turma.observacoes|linebreaks }}</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Disciplinas -->
    {% if turma.disciplinas.all %}
    <div class="card mb-3">
        <div class="card-header bg-success text-white">
            <h6 class="mb-0">
                <i class="fas fa-list-ul me-2"></i>
                Disciplinas da Turma
                <span class="badge bg-light text-dark ms-2">{{ turma.disciplinas.count }}</span>
            </h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Disciplina</th>
                            <th>Instrutor</th>
                            <th>Monitores</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for disciplina in turma.disciplinas.all %}
                        <tr>
                            <td><strong>{{ disciplina.codigo }}</strong></td>
                            <td>
                                <a href="{% url 'militares:ensino_disciplina_detalhes' pk=disciplina.pk %}" class="text-decoration-none">
                                    {{ disciplina.nome }}
                                </a>
                            </td>
                            <td>
                                {% if disciplina.instrutor_responsavel_militar %}
                                    {{ disciplina.instrutor_responsavel_militar.get_posto_graduacao_display }} {{ disciplina.instrutor_responsavel_militar.nome_completo }}
                                {% elif disciplina.instrutor_responsavel_externo %}
                                    {{ disciplina.instrutor_responsavel_externo.get_nome_completo }}
                                {% else %}
                                    <span class="text-muted">Não definido</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if disciplina.monitores_militares.all or disciplina.monitores_externos.all %}
                                    {% if disciplina.monitores_militares.all %}
                                        {% for monitor in disciplina.monitores_militares.all %}
                                            {{ monitor.get_posto_graduacao_display }} {{ monitor.nome_completo }}{% if not forloop.last or disciplina.monitores_externos.all %}, {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    {% if disciplina.monitores_externos.all %}
                                        {% for monitor in disciplina.monitores_externos.all %}
                                            {{ monitor.get_nome_completo }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Nenhum</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Alunos -->
    {% if alunos %}
    <div class="card mb-3">
        <div class="card-header bg-info text-white">
            <h6 class="mb-0">
                <i class="fas fa-user-graduate me-2"></i>
                Alunos
                <span class="badge bg-light text-dark ms-2">{{ total_alunos }}</span>
                <small class="ms-2">({{ alunos_ativos }} ativo(s))</small>
            </h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead>
                        <tr>
                            <th>Matrícula</th>
                            <th>Nome</th>
                            <th>CPF</th>
                            <th>Situação</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for aluno in alunos %}
                        <tr>
                            <td><strong>{{ aluno.matricula }}</strong></td>
                            <td>
                                {% if aluno.militar %}
                                    {{ aluno.militar.get_posto_graduacao_display }} {{ aluno.militar.nome_completo }}
                                {% elif aluno.pessoa_externa %}
                                    {{ aluno.pessoa_externa.nome_completo }}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td>
                                {% if aluno.militar %}
                                    {{ aluno.militar.cpf|default:"-" }}
                                {% elif aluno.pessoa_externa %}
                                    {{ aluno.pessoa_externa.cpf|default:"-" }}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge {% if aluno.situacao == 'ATIVO' %}bg-success{% elif aluno.situacao == 'CONCLUIDO' %}bg-primary{% elif aluno.situacao == 'DESLIGADO' %}bg-danger{% else %}bg-secondary{% endif %}">
                                    {{ aluno.get_situacao_display }}
                                </span>
                            </td>
                            <td>
                                {% if aluno.situacao == 'ATIVO' %}
                                <button type="button" class="btn btn-sm btn-danger btn-desligar-aluno-modal" 
                                        data-aluno-id="{{ aluno.pk }}"
                                        data-aluno-nome="{% if aluno.militar %}{{ aluno.militar.nome_completo }}{% elif aluno.pessoa_externa %}{{ aluno.pessoa_externa.nome_completo }}{% endif %}"
                                        data-aluno-matricula="{{ aluno.matricula }}"
                                        title="Desligar Aluno">
                                    <i class="fas fa-user-times"></i>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times me-2"></i>
        Fechar
    </button>
    {% if menu_permissions.ENSINO_EDITAR or user.is_superuser %}
    <button type="button" class="btn btn-warning btn-editar-turma-modal" data-turma-id="{{ turma.pk }}">
        <i class="fas fa-edit me-2"></i>
        Editar
    </button>
    {% endif %}
</div>

<!-- Modal Desligar Aluno -->
<div class="modal fade" id="desligarAlunoModalDetalhes" tabindex="-1" aria-labelledby="desligarAlunoModalDetalhesLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="desligarAlunoModalDetalhesLabel">
                    <i class="fas fa-user-times me-2"></i>
                    Desligar Aluno
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <form method="post" id="formDesligarAlunoDetalhes" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Tem certeza que deseja desligar o aluno <strong id="aluno-nome-desligar-detalhes"></strong> (Matrícula: <strong id="aluno-matricula-desligar-detalhes"></strong>)?
                    </div>
                    
                    <div class="mb-3">
                        <label for="data_desligamento_detalhes" class="form-label">
                            Data de Desligamento <span class="text-danger">*</span>
                        </label>
                        <input type="date" class="form-control" id="data_desligamento_detalhes" name="data_desligamento" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="motivo_desligamento_detalhes" class="form-label">
                            Motivo/Justificativa do Desligamento <span class="text-danger">*</span>
                        </label>
                        <textarea class="form-control" id="motivo_desligamento_detalhes" name="motivo_desligamento" rows="5" required placeholder="Descreva o motivo e a justificativa do desligamento do aluno..."></textarea>
                        <small class="form-text text-muted">Campo obrigatório. Descreva detalhadamente o motivo do desligamento.</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            Documentos Anexos (Processos Disciplinares, Atestados, etc.)
                        </label>
                        <div id="documentos-container">
                            <div class="documento-item mb-2">
                                <div class="row">
                                    <div class="col-md-4">
                                        <select class="form-select form-select-sm tipo-documento" name="tipo_documento[]">
                                            <option value="PROCESSO_DISCIPLINAR">Processo Disciplinar</option>
                                            <option value="TERMO_DESLIGAMENTO">Termo de Desligamento</option>
                                            <option value="NOTIFICACAO">Notificação</option>
                                            <option value="ADVERTENCIA">Advertência</option>
                                            <option value="SUSPENSAO">Suspensão</option>
                                            <option value="RELATORIO">Relatório</option>
                                            <option value="PARECER">Parecer</option>
                                            <option value="DECISAO">Decisão</option>
                                            <option value="PORTARIA">Portaria</option>
                                            <option value="OFICIO">Ofício</option>
                                            <option value="ATA">Ata</option>
                                            <option value="ATESTADO">Atestado Médico</option>
                                            <option value="LAUDO">Laudo</option>
                                            <option value="AUTORIZACAO">Autorização</option>
                                            <option value="DECLARACAO">Declaração</option>
                                            <option value="HISTORICO">Histórico Escolar</option>
                                            <option value="OUTROS">Outros</option>
                                        </select>
                                    </div>
                                    <div class="col-md-5">
                                        <input type="text" class="form-control form-control-sm nome-documento" name="nome_documento[]" placeholder="Nome do documento (ex: Processo Disciplinar)">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="file" class="form-control form-control-sm arquivo-documento" name="arquivo_documento[]" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-secondary mt-2" id="adicionar-documento">
                            <i class="fas fa-plus me-1"></i> Adicionar Mais Documentos
                        </button>
                        <small class="form-text text-muted d-block mt-2">
                            Você pode anexar múltiplos documentos (PDF, DOC, DOCX, JPG, PNG). Máximo 10MB por arquivo.
                        </small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-user-times me-2"></i>
                        Confirmar Desligamento
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
(function() {
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function() {
        // Botão Editar no modal de detalhes
        const btnEditarTurmaModal = document.querySelector('.btn-editar-turma-modal');
        if (btnEditarTurmaModal) {
            btnEditarTurmaModal.addEventListener('click', function() {
                const turmaId = this.getAttribute('data-turma-id');
                const detalhesModal = document.getElementById('detalhesTurmaModalLista');
                const editarModal = document.getElementById('editarTurmaModalLista');
                const editarModalContent = document.getElementById('editarTurmaModalListaContent');
                
                // Fechar modal de detalhes
                if (detalhesModal && typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                    const detalhesModalInstance = bootstrap.Modal.getInstance(detalhesModal);
                    if (detalhesModalInstance) {
                        detalhesModalInstance.hide();
                    }
                }
                
                // Carregar formulário de edição
                if (editarModal && editarModalContent) {
                    editarModalContent.innerHTML = `
                        <div class="modal-body text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Carregando...</span>
                            </div>
                            <p class="mt-3 text-muted">Carregando formulário...</p>
                        </div>
                    `;
                    
                    fetch('/militares/ensino/turmas/' + turmaId + '/editar/', {
                        method: 'GET',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                        },
                        credentials: 'same-origin'
                    })
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Erro HTTP: ' + response.status);
                        }
                        return response.text();
                    })
                    .then(function(html) {
                        editarModalContent.innerHTML = html;
                        
                        setTimeout(function() {
                            const scripts = editarModalContent.querySelectorAll('script');
                            scripts.forEach(function(oldScript) {
                                const newScript = document.createElement('script');
                                Array.from(oldScript.attributes).forEach(function(attr) {
                                    newScript.setAttribute(attr.name, attr.value);
                                });
                                newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                                if (oldScript.parentNode) {
                                    oldScript.parentNode.replaceChild(newScript, oldScript);
                                }
                            });
                            
                            // Inicializar Select2 após carregar o formulário
                            setTimeout(function() {
                                if (typeof $ !== 'undefined' && typeof $.fn.select2 !== 'undefined') {
                                    $('.militar-select2').select2({
                                        placeholder: 'Digite o nome, matrícula ou posto do militar...',
                                        allowClear: true,
                                        minimumInputLength: 2,
                                        dropdownParent: $('#editarTurmaModalLista'),
                                        ajax: {
                                            url: '/militares/militar-autocomplete/',
                                            dataType: 'json',
                                            delay: 250,
                                            data: function (params) {
                                                return {
                                                    q: params.term
                                                };
                                            },
                                            processResults: function (data) {
                                                return {
                                                    results: data.results
                                                };
                                            },
                                            cache: true
                                        },
                                        language: {
                                            inputTooShort: function () {
                                                return 'Digite pelo menos 2 caracteres...';
                                            },
                                            noResults: function () {
                                                return 'Nenhum militar encontrado';
                                            },
                                            searching: function () {
                                                return 'Buscando...';
                                            }
                                        }
                                    });
                                }
                            }, 200);
                        }, 100);
                    })
                    .catch(function(error) {
                        console.error('Erro ao carregar formulário:', error);
                    });
                    
                    // Abrir modal de edição
                    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                        const editarModalInstance = new bootstrap.Modal(editarModal);
                        editarModalInstance.show();
                    }
                }
            });
        }
        
        // Botão Desligar Aluno no modal de detalhes - usando event delegation no documento
        // Como o conteúdo é carregado dinamicamente, usamos event delegation
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('.btn-desligar-aluno-modal');
            if (!btn) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            const alunoId = btn.getAttribute('data-aluno-id');
            const alunoNome = btn.getAttribute('data-aluno-nome');
            const alunoMatricula = btn.getAttribute('data-aluno-matricula');
            
            const nomeElement = document.getElementById('aluno-nome-desligar-detalhes');
            const matriculaElement = document.getElementById('aluno-matricula-desligar-detalhes');
            const formElement = document.getElementById('formDesligarAlunoDetalhes');
            
            if (nomeElement) nomeElement.textContent = alunoNome || 'N/A';
            if (matriculaElement) matriculaElement.textContent = alunoMatricula || 'N/A';
            if (formElement) formElement.action = '/militares/ensino/alunos/' + alunoId + '/desligar/';
            
            // Definir data atual como padrão
            const hoje = new Date().toISOString().split('T')[0];
            const dataElement = document.getElementById('data_desligamento_detalhes');
            if (dataElement) dataElement.value = hoje;
            
            // Limpar documentos anteriores
            const container = document.getElementById('documentos-container');
            if (container) {
                container.innerHTML = `
                    <div class="documento-item mb-2">
                        <div class="row">
                            <div class="col-md-4">
                                <select class="form-select form-select-sm tipo-documento" name="tipo_documento[]">
                                    <option value="PROCESSO_DISCIPLINAR">Processo Disciplinar</option>
                                    <option value="TERMO_DESLIGAMENTO">Termo de Desligamento</option>
                                    <option value="NOTIFICACAO">Notificação</option>
                                    <option value="ADVERTENCIA">Advertência</option>
                                    <option value="SUSPENSAO">Suspensão</option>
                                    <option value="RELATORIO">Relatório</option>
                                    <option value="PARECER">Parecer</option>
                                    <option value="DECISAO">Decisão</option>
                                    <option value="PORTARIA">Portaria</option>
                                    <option value="OFICIO">Ofício</option>
                                    <option value="ATA">Ata</option>
                                    <option value="ATESTADO">Atestado Médico</option>
                                    <option value="LAUDO">Laudo</option>
                                    <option value="AUTORIZACAO">Autorização</option>
                                    <option value="DECLARACAO">Declaração</option>
                                    <option value="HISTORICO">Histórico Escolar</option>
                                    <option value="OUTROS">Outros</option>
                                </select>
                            </div>
                            <div class="col-md-5">
                                <input type="text" class="form-control form-control-sm nome-documento" name="nome_documento[]" placeholder="Nome do documento">
                            </div>
                            <div class="col-md-3">
                                <input type="file" class="form-control form-control-sm arquivo-documento" name="arquivo_documento[]" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                            </div>
                        </div>
                    </div>
                `;
            }
            
            const desligarModal = document.getElementById('desligarAlunoModalDetalhes');
            if (desligarModal && typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                const modal = new bootstrap.Modal(desligarModal);
                modal.show();
            }
        });
        
        // Adicionar mais documentos - usando event delegation
        // Funciona mesmo quando o conteúdo é carregado dinamicamente
        document.addEventListener('click', function(e) {
            const btn = e.target.closest('#adicionar-documento');
            if (!btn) return;
            
            e.preventDefault();
            e.stopPropagation();
            
            const container = document.getElementById('documentos-container');
            if (!container) return;
            
            const novoItem = document.createElement('div');
            novoItem.className = 'documento-item mb-2';
            novoItem.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <select class="form-select form-select-sm tipo-documento" name="tipo_documento[]">
                            <option value="PROCESSO_DISCIPLINAR">Processo Disciplinar</option>
                            <option value="TERMO_DESLIGAMENTO">Termo de Desligamento</option>
                            <option value="NOTIFICACAO">Notificação</option>
                            <option value="ADVERTENCIA">Advertência</option>
                            <option value="SUSPENSAO">Suspensão</option>
                            <option value="RELATORIO">Relatório</option>
                            <option value="PARECER">Parecer</option>
                            <option value="DECISAO">Decisão</option>
                            <option value="PORTARIA">Portaria</option>
                            <option value="OFICIO">Ofício</option>
                            <option value="ATA">Ata</option>
                            <option value="ATESTADO">Atestado Médico</option>
                            <option value="LAUDO">Laudo</option>
                            <option value="AUTORIZACAO">Autorização</option>
                            <option value="DECLARACAO">Declaração</option>
                            <option value="HISTORICO">Histórico Escolar</option>
                            <option value="OUTROS">Outros</option>
                        </select>
                    </div>
                    <div class="col-md-5">
                        <input type="text" class="form-control form-control-sm nome-documento" name="nome_documento[]" placeholder="Nome do documento">
                    </div>
                    <div class="col-md-2">
                        <input type="file" class="form-control form-control-sm arquivo-documento" name="arquivo_documento[]" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-sm btn-outline-danger remover-documento" title="Remover">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            container.appendChild(novoItem);
        });
        
        // Remover documento (delegation)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.remover-documento')) {
                e.target.closest('.documento-item').remove();
            }
        });
        
        // Submissão do formulário de desligamento
        const formDesligar = document.getElementById('formDesligarAlunoDetalhes');
        if (formDesligar) {
            formDesligar.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Processando...';
                
                fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                    },
                    credentials: 'same-origin'
                })
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    }
                    return response.json().then(function(data) {
                        throw new Error(data.error || 'Erro ao desligar aluno');
                    });
                })
                .then(function(data) {
                    if (data.success) {
                        // Fechar modais e recarregar
                        const desligarModal = bootstrap.Modal.getInstance(document.getElementById('desligarAlunoModalDetalhes'));
                        if (desligarModal) {
                            desligarModal.hide();
                        }
                        const detalhesModal = bootstrap.Modal.getInstance(document.getElementById('detalhesTurmaModalLista'));
                        if (detalhesModal) {
                            detalhesModal.hide();
                        }
                        // Recarregar a página para atualizar a lista
                        location.reload();
                    } else {
                        throw new Error(data.error || 'Erro ao desligar aluno');
                    }
                })
                .catch(function(error) {
                    console.error('Erro:', error);
                    alert('Erro ao desligar aluno: ' + error.message);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                });
            });
        }
    });
})();
</script>

