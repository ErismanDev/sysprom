{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <title>Recuperar senha</title>
    <style>
        :root { --primary-color: #ff6b35; --secondary-color: #e55a2b; --accent-color: #ff8c42; --dark-color: #1a1a1a; --dark-gray: #2d2d2d; --light-orange: #ffa726; --gold: #ffd700; --red-accent: #d32f2f; --yellow-accent: #ffeb3b; --light-blue: #87CEEB; }
        body { background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 40%, var(--primary-color) 100%); min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; position: relative; overflow: hidden; margin: 0; padding: 0; }
        body::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.2) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 140, 66, 0.15) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 167, 38, 0.1) 0%, transparent 50%); animation: backgroundShift 25s ease-in-out infinite; }
        body::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(45deg, rgba(255, 107, 53, 0.08) 25%, transparent 25%), linear-gradient(-45deg, rgba(255, 140, 66, 0.06) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(255, 167, 38, 0.04) 75%), linear-gradient(-45deg, transparent 75%, rgba(255, 193, 7, 0.04) 75%); background-size: 100px 100px; }
        @keyframes backgroundShift { 0%, 100% { transform: translateX(0) translateY(0) rotate(0deg); } 25% { transform: translateX(-20px) translateY(-10px) rotate(1deg); } 50% { transform: translateX(20px) translateY(10px) rotate(-1deg); } 75% { transform: translateX(-10px) translateY(20px) rotate(0.5deg); } }
        .login-container { display: flex; min-height: 100vh; align-items: center; justify-content: center; padding: 2rem; position: relative; z-index: 10; }
        .login-sidebar { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center; color: white; }
        .login-form-section { flex: 1; display: flex; align-items: center; justify-content: center; padding: 2rem; }
        .login-header { background: none; color: white; padding: 0; text-align: center; position: relative; overflow: hidden; border: none; border-radius: 0; max-width: none; width: 100%; margin: 0; box-shadow: none; }
        .login-header h1 { margin: 0 0 1rem 0; font-size: 2.5rem; font-weight: 700; position: relative; z-index: 2; text-shadow: 0 4px 8px rgba(0,0,0,0.5); }
        .login-header p { margin: 0.3rem 0 0 0; opacity: 0.9; font-size: 0.9rem; position: relative; z-index: 2; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .login-body { padding: 2rem; background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 15px; max-width: 420px; width: 100%; margin: 0; box-shadow: 0 8px 32px rgba(0,0,0,0.2); border: 1px solid rgba(255, 255, 255, 0.15); }
        .form-control { border-radius: 12px; border: 2px solid rgba(255, 255, 255, 0.3); padding: 0.75rem 1rem; font-size: 1rem; transition: all 0.3s ease; background-color: rgba(255, 255, 255, 0.9); color: #333333; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .form-control:focus { border-color: var(--primary-color); box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25), 0 4px 12px rgba(255, 107, 53, 0.15); background-color: rgba(255, 255, 255, 0.95); color: #333333; }
        .btn-login { background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); border: none; border-radius: 10px; padding: 0.6rem 1.2rem; font-size: 0.95rem; font-weight: 600; color: white; transition: all 0.3s ease; }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3); }
        .form-label { color: white; font-weight: 600; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .logos-container { display: flex; align-items: center; justify-content: center; gap: 3rem; margin-bottom: 3rem; flex-wrap: wrap; }
        .cbmepi-logo { width: 250px; height: 250px; background: rgba(255, 255, 255, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 40px rgba(0,0,0,0.3); overflow: hidden; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .sysgabom-logo { width: 250px; height: 250px; background: rgba(255, 255, 255, 0.9); border-radius: 25px; display: flex; align-items: center; justify-content: center; box-shadow: 0 12px 40px rgba(0,0,0,0.3); overflow: hidden; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .cbmepi-logo img { width: 95%; height: 95%; object-fit: contain; border-radius: 50%; }
        .sysgabom-logo img { width: 95%; height: 95%; object-fit: contain; border-radius: 12px; }
        .floating-elements { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .floating-circle { position: absolute; border-radius: 50%; background: linear-gradient(45deg, rgba(255, 107, 53, 0.2), rgba(255, 140, 66, 0.15)); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 2px solid var(--accent-color); box-shadow: 0 0 20px rgba(255, 107, 53, 0.3); }
        .circle-1 { width: 80px; height: 80px; top: 20%; left: 10%; animation: float1 15s ease-in-out infinite; }
        .circle-2 { width: 120px; height: 120px; top: 60%; right: 15%; animation: float2 20s ease-in-out infinite; }
        .circle-3 { width: 60px; height: 60px; bottom: 20%; left: 20%; animation: float3 12s ease-in-out infinite; }
        .floating-square { position: absolute; background: linear-gradient(45deg, rgba(255, 107, 53, 0.15), rgba(255, 140, 66, 0.1)); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border: 2px solid var(--accent-color); transform: rotate(45deg); box-shadow: 0 0 15px rgba(255, 107, 53, 0.2); }
        .square-1 { width: 40px; height: 40px; top: 30%; right: 30%; animation: float4 18s ease-in-out infinite; }
        .square-2 { width: 60px; height: 60px; bottom: 40%; right: 5%; animation: float5 14s ease-in-out infinite; }
        @keyframes float1 { 0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); } 25% { transform: translateY(-20px) translateX(10px) rotate(90deg); } 50% { transform: translateY(-10px) translateX(-15px) rotate(180deg); } 75% { transform: translateY(-30px) translateX(5px) rotate(270deg); } }
        @keyframes float2 { 0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); } 33% { transform: translateY(-25px) translateX(-20px) rotate(120deg); } 66% { transform: translateY(-15px) translateX(25px) rotate(240deg); } }
        @keyframes float3 { 0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); } 50% { transform: translateY(-30px) translateX(20px) rotate(180deg); } }
        @keyframes float4 { 0%, 100% { transform: translateY(0px) translateX(0px) rotate(45deg); } 50% { transform: translateY(-25px) translateX(-10px) rotate(225deg); } }
        @media (max-width: 768px) { .login-container { flex-direction: column; padding: 1rem; } .login-sidebar { order: 2; padding: 1rem; } .login-form-section { order: 1; padding: 1rem; } .login-body { max-width: 100%; } .logos-container { gap: 1rem; } .cbmepi-logo, .sysgabom-logo { width: 180px; height: 180px; } .floating-circle, .floating-square { opacity: 0.5; } .circle-1, .circle-2, .circle-3 { width: 60px; height: 60px; } .square-1, .square-2 { width: 30px; height: 30px; } .login-header h1 { font-size: 1.1rem; } .login-header p { font-size: 0.8rem; } }
        @media (min-width: 1200px) { .login-body { max-width: 450px; } .floating-circle, .floating-square { opacity: 0.8; } }
        .fire-icon, .helmet-icon, .shield-icon, .axe-icon, .hose-icon, .hydrant-icon, .hose-long { position: absolute; color: var(--primary-color); font-size: 2rem; opacity: 0.6; animation: iconFloat 10s ease-in-out infinite; text-shadow: 0 0 10px rgba(255, 107, 53, 0.5); }
        .fire-icon { color: var(--red-accent); animation: fireFlicker 3s ease-in-out infinite; }
        .helmet-icon { color: var(--dark-gray); animation: helmetFloat 12s ease-in-out infinite; }
        .shield-icon { color: var(--gold); animation: shieldFloat 15s ease-in-out infinite; }
        .axe-icon { color: var(--dark-gray); animation: axeSwing 8s ease-in-out infinite; font-size: 1.8rem; }
        .hose-icon { color: var(--light-blue); animation: hoseFlow 6s ease-in-out infinite; font-size: 1.5rem; }
        .hydrant-icon { color: var(--red-accent); animation: hydrantPulse 4s ease-in-out infinite; font-size: 1.2rem; }
        .hose-long { color: var(--light-blue); animation: hoseLongFlow 8s ease-in-out infinite; font-size: 1.8rem; opacity: 0.4; }
        .fire-1 { top: 15%; right: 20%; }
        .fire-2 { bottom: 25%; left: 15%; }
        .helmet-1 { top: 40%; right: 10%; }
        .helmet-2 { bottom: 40%; left: 25%; }
        .shield-1 { top: 60%; left: 10%; }
        .axe-1 { top: 25%; left: 5%; }
        .axe-2 { bottom: 30%; right: 8%; }
        .hose-1 { top: 35%; right: 5%; }
        .hose-2 { bottom: 45%; left: 8%; }
        .hose-3 { top: 55%; right: 25%; }
        .hydrant-1 { top: 10%; left: 30%; }
        .hydrant-2 { bottom: 15%; right: 30%; }
        .hydrant-3 { top: 70%; left: 40%; }
        .hydrant-4 { top: 45%; right: 40%; }
        .hydrant-5 { bottom: 60%; left: 50%; }
        .hose-4 { top: 20%; left: 15%; }
        .hose-5 { bottom: 20%; right: 15%; }
        .hose-6 { top: 65%; right: 35%; }
        .hose-long-1 { top: 30%; left: 60%; }
        .hose-long-2 { bottom: 35%; right: 45%; }
        @keyframes fireFlicker { 0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.6; } 25% { transform: scale(1.1) rotate(5deg); opacity: 0.8; } 50% { transform: scale(0.9) rotate(-5deg); opacity: 0.4; } 75% { transform: scale(1.05) rotate(3deg); opacity: 0.7; } }
        @keyframes helmetFloat { 0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; } 50% { transform: translateY(-20px) rotate(10deg); opacity: 0.8; } }
        @keyframes shieldFloat { 0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.5; } 33% { transform: translateY(-15px) rotate(5deg); opacity: 0.7; } 66% { transform: translateY(-10px) rotate(-5deg); opacity: 0.6; } }
        @keyframes iconFloat { 0%, 100% { transform: translateY(0px) translateX(0px); } 25% { transform: translateY(-10px) translateX(5px); } 50% { transform: translateY(-5px) translateX(-5px); } 75% { transform: translateY(-15px) translateX(3px); } }
        @keyframes axeSwing { 0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.6; } 25% { transform: rotate(15deg) scale(1.1); opacity: 0.8; } 50% { transform: rotate(-10deg) scale(0.9); opacity: 0.5; } 75% { transform: rotate(5deg) scale(1.05); opacity: 0.7; } }
        @keyframes hoseFlow { 0%, 100% { transform: translateY(0px) scale(1); opacity: 0.6; } 50% { transform: translateY(-15px) scale(1.2); opacity: 0.8; } }
        @keyframes hydrantPulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.3); opacity: 0.9; } }
        @keyframes hoseLongFlow { 0%, 100% { transform: translateY(0px) scale(1) rotate(0deg); opacity: 0.4; } 25% { transform: translateY(-20px) scale(1.1) rotate(5deg); opacity: 0.6; } 50% { transform: translateY(-10px) scale(0.9) rotate(-3deg); opacity: 0.3; } 75% { transform: translateY(-25px) scale(1.05) rotate(2deg); opacity: 0.5; } }
        .extinguisher-jet { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; pointer-events: none; z-index: 1000; opacity: 0; }
        .water-particle { position: absolute; width: 3px; height: 3px; background: linear-gradient(45deg, #87CEEB, #4682B4, #B0E0E6); border-radius: 50%; animation: waterSpray 1.5s ease-out forwards; box-shadow: 0 0 6px rgba(135, 206, 235, 0.6); }
        .water-particle:nth-child(odd) { width: 2px; height: 2px; background: linear-gradient(45deg, #B0E0E6, #87CEEB); }
        .water-particle:nth-child(3n) { width: 5px; height: 5px; background: linear-gradient(45deg, #4682B4, #87CEEB); }
        @keyframes waterSpray { 0% { opacity: 1; transform: translate(0, 0) scale(1); } 50% { opacity: 0.8; transform: translate(var(--random-x), var(--random-y)) scale(1.2); } 100% { opacity: 0; transform: translate(var(--random-x), var(--random-y)) scale(0.5); } }
        .apk-header { display:none; align-items:center; justify-content:center; gap:.5rem; padding:.75rem 0; }
        body.apk-mode .apk-header { display:flex; }
        body.apk-mode .floating-elements, body.apk-mode .logos-container { display:none !important; }
        body.apk-mode .login-body { max-width: 360px; padding: 1rem; }
    </style>
    <script>
        (function(){ try { var ua = navigator.userAgent||''; var isApk = (/Android/.test(ua) && (/; wv/.test(ua) || /Version\//.test(ua))) || window.location.search.indexOf('apk=1') !== -1; if (isApk) { document.addEventListener('DOMContentLoaded', function(){ document.body.classList.add('apk-mode'); }); } } catch(e){} })();
    </script>
</head>
<body>
    <div class="apk-header">
        <img src="{% static 'sysgabomlogo.png' %}" alt="SysgaBom" style="height:36px;width:auto;">
        <div class="apk-title" style="font-size:1.1rem;font-weight:600;">SysgaBom - CBMEPI</div>
    </div>
    <div class="floating-elements">
        <div class="floating-circle circle-1"></div>
        <div class="floating-circle circle-2"></div>
        <div class="floating-circle circle-3"></div>
        <div class="floating-square square-1"></div>
        <div class="floating-square square-2"></div>
        <div class="fire-icon fire-1"><i class="fas fa-fire"></i></div>
        <div class="fire-icon fire-2"><i class="fas fa-fire"></i></div>
        <div class="helmet-icon helmet-1"><i class="fas fa-hard-hat"></i></div>
        <div class="helmet-icon helmet-2"><i class="fas fa-hard-hat"></i></div>
        <div class="shield-icon shield-1"><i class="fas fa-shield-alt"></i></div>
        <div class="axe-icon axe-1"><i class="fas fa-hammer"></i></div>
        <div class="axe-icon axe-2"><i class="fas fa-hammer"></i></div>
        <div class="hose-icon hose-1"><i class="fas fa-tint"></i></div>
        <div class="hose-icon hose-2"><i class="fas fa-tint"></i></div>
        <div class="hose-icon hose-3"><i class="fas fa-tint"></i></div>
        <div class="hydrant-icon hydrant-1"><i class="fas fa-circle"></i></div>
        <div class="hydrant-icon hydrant-2"><i class="fas fa-circle"></i></div>
        <div class="hydrant-icon hydrant-3"><i class="fas fa-circle"></i></div>
        <div class="hydrant-icon hydrant-4"><i class="fas fa-circle"></i></div>
        <div class="hydrant-icon hydrant-5"><i class="fas fa-circle"></i></div>
        <div class="hose-icon hose-4"><i class="fas fa-tint"></i></div>
        <div class="hose-icon hose-5"><i class="fas fa-tint"></i></div>
        <div class="hose-icon hose-6"><i class="fas fa-tint"></i></div>
        <div class="hose-long hose-long-1"><i class="fas fa-tint"></i></div>
        <div class="hose-long hose-long-2"><i class="fas fa-tint"></i></div>
    </div>
    <div class="extinguisher-jet" id="extinguisher-jet"></div>
    <div class="login-container">
        <div class="login-sidebar">
            <div class="login-header">
                <div class="logos-container">
                    <div class="cbmepi-logo">
                        <img src="{% static 'logo_cbmepi.png' %}" alt="Logo CBMEPI">
                    </div>
                    <div class="sysgabom-logo">
                        <img src="{% static 'sysgabomlogo.png' %}" alt="Logo SysgaBom">
                    </div>
                </div>
                <h1>SysgaBom - CBMEPI</h1>
                <p>Sistema de Gerenciamento Administrativo do Corpo de Bombeiros</p>
            </div>
        </div>
        <div class="login-form-section">
            <div class="login-body">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
            <form method="post">
                {% csrf_token %}
                {{ form.email.errors }}
                <div class="mb-3">
                    <label for="pr_username" class="form-label"><i class="fas fa-user me-2"></i>Usuário</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" id="pr_username" class="form-control" autocomplete="username" autocapitalize="none" placeholder="Digite seu usuário">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="id_email" class="form-label"><i class="fas fa-envelope me-2"></i>E-mail</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                        <input type="email" class="form-control" id="id_email" name="email" placeholder="Seu e-mail" autocomplete="email" required>
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-login">Enviar link</button>
                    <a href="{% url 'login' %}" class="btn btn-outline-light">Voltar ao login</a>
                </div>
            </form>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            var u = document.getElementById('pr_username');
            var email = document.getElementById('id_email');
            function fetchEmail(username){
                fetch('/api/user-email/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: username.trim() })
                }).then(function(r){ return r.json(); }).then(function(data){
                    if (data && data.success && data.email) { email.value = data.email; }
                }).catch(function(){});
            }
            if (u && email){
                u.addEventListener('input', function(){
                    email.value = '';
                    var v = u.value.trim();
                    if (v) { fetchEmail(v); }
                });
            }
            var submitBtn = document.querySelector('button[type="submit"]');
            function createWaterParticle(container) {
                var particle = document.createElement('div');
                particle.className = 'water-particle';
                var angle = (Math.random() - 0.5) * Math.PI / 3;
                var distance = 50 + Math.random() * 100;
                var x = Math.cos(angle) * distance;
                var y = Math.sin(angle) * distance - Math.random() * 20;
                particle.style.setProperty('--random-x', x + 'px');
                particle.style.setProperty('--random-y', y + 'px');
                particle.style.left = '50%';
                particle.style.top = '50%';
                container.appendChild(particle);
                setTimeout(function(){ if (particle.parentNode) { particle.parentNode.removeChild(particle); } }, 1500);
            }
            function createExtinguisherJet(anchorEl) {
                var jetContainer = document.getElementById('extinguisher-jet');
                if (!jetContainer || !anchorEl) return;
                var iconRect = anchorEl.getBoundingClientRect();
                var containerRect = document.querySelector('.login-container').getBoundingClientRect();
                var x = iconRect.left + iconRect.width / 2 - containerRect.left;
                var y = iconRect.top + iconRect.height / 2 - containerRect.top;
                jetContainer.style.left = x + 'px';
                jetContainer.style.top = y + 'px';
                jetContainer.style.opacity = '1';
                for (var i = 0; i < 50; i++) { (function(i){ setTimeout(function(){ createWaterParticle(jetContainer); }, i * 15); })(i); }
                setTimeout(function(){ jetContainer.style.opacity = '0'; jetContainer.innerHTML = ''; }, 2000);
            }
            if (submitBtn) { submitBtn.addEventListener('click', function(){ createExtinguisherJet(submitBtn); }); }
        });
    </script>
</body>
</html>
