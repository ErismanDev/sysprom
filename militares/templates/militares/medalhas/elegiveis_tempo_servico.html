{% extends 'base.html' %}
{% load static %}

{% block title %}Eleg√≠veis - Medalhas de Tempo de Servi√ßo - SysProm - CBMEPI{% endblock %}

{% block extra_css %}
<style>
    /* Busca Discreta */
    .search-discreet {
        position: relative;
        margin: 20px 0;
        transition: all 0.3s ease;
    }
    
    .search-input-discreet {
        width: 100%;
        max-width: 400px;
        padding: 12px 45px 12px 45px;
        border: 2px solid #e9ecef;
        border-radius: 25px;
        font-size: 14px;
        background: white;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .search-input-discreet:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        transform: translateY(-1px);
    }
    
    .search-icon-discreet {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        font-size: 16px;
        z-index: 2;
        transition: color 0.3s ease;
    }
    
    .search-input-discreet:focus + .search-icon-discreet {
        color: #667eea;
    }
    
    .search-clear-discreet {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #6c757d;
        cursor: pointer;
        font-size: 14px;
        display: none;
        transition: color 0.3s ease;
    }
    
    .search-clear-discreet:hover {
        color: #dc3545;
    }
    
    /* Autocomplete */
    .autocomplete-container {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        max-width: 400px;
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        z-index: 1000;
        max-height: 300px;
        overflow-y: auto;
        display: none;
    }
    
    .autocomplete-item {
        padding: 12px 15px;
        cursor: pointer;
        border-bottom: 1px solid #f8f9fa;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .autocomplete-item:hover {
        background-color: #f8f9fa;
    }
    
    .autocomplete-item.selected {
        background-color: #667eea;
        color: white;
    }
    
    /* Filtros discretos */
    .filters-discreet {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        opacity: 0.7;
        transition: opacity 0.3s ease;
    }
    
    .filters-discreet:hover {
        opacity: 1;
    }
    
    .filter-select-discreet {
        padding: 6px 12px;
        border: 1px solid #e9ecef;
        border-radius: 15px;
        font-size: 12px;
        background: white;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .filter-select-discreet:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }
    
    /* Anima√ß√µes */
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .highlight {
        background-color: #fff3cd !important;
        transition: background-color 0.3s ease;
    }
    
    /* Responsivo */
    @media (max-width: 768px) {
        .search-input-discreet {
            max-width: 100%;
            font-size: 16px; /* Evita zoom no iOS */
        }
        
        .autocomplete-container {
            max-width: 100%;
        }
        
        .filters-discreet {
            flex-direction: column;
        }
    }
    
    .bg-gradient-primary { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); }
    .card.shadow-lg { box-shadow: 0 1rem 3rem rgba(0,0,0,.175) !important; }
    .nav-tabs .nav-link { color: #0d6efd !important; font-weight: 500; }
    .nav-tabs .nav-link.active { color: #0a58ca !important; font-weight: 700; }
    .tab-badge { font-size: .75rem; }
    .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
    
    /* Estilos espec√≠ficos para medalhas */
    .medalha-10 { color: #cd7f32; }
    .medalha-20 { color: #c0c0c0; }
    .medalha-30 { color: #ffd700; }
    
    .list-group-item {
        transition: all 0.2s ease;
        border-left: 4px solid transparent;
    }
    
    .list-group-item:hover {
        border-left-color: #007bff;
        background-color: #f8f9fa;
        transform: translateX(2px);
    }
    
    .elegivel-count {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 1rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 2rem;
        color: #6c757d;
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="col-lg-12">
        <!-- Cabe√ßalho -->
        <div class="card shadow-lg border-0 mb-4">
            <div class="card-header bg-gradient-primary text-white py-3">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-users fa-2x me-3"></i>
                        <div>
                            <h4 class="mb-0">Eleg√≠veis - Medalhas de Tempo de Servi√ßo</h4>
                            <small class="opacity-75">Militares eleg√≠veis para receber medalhas por tempo de servi√ßo</small>
                        </div>
                    </div>
                    <div class="btn-group">
                        <a href="{% url 'militares:concessoes_list' %}" class="btn btn-light">
                            <i class="fas fa-arrow-left me-2"></i>Voltar √†s Medalhas
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Busca Discreta -->
        <div class="search-discreet">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="position-relative">
                            <input type="text" 
                                   id="pesquisaElegiveis" 
                                   class="search-input-discreet" 
                                   placeholder="üîç Digite o nome, posto ou matr√≠cula..."
                                   value="{{ query|default:'' }}"
                                   autocomplete="off">
                            <i class="fas fa-search search-icon-discreet"></i>
                            <button class="search-clear-discreet" id="searchClear" title="Limpar busca">
                                <i class="fas fa-times"></i>
                            </button>
                            
                            <!-- Autocomplete -->
                            <div class="autocomplete-container" id="autocompleteContainer">
                                <!-- Itens do autocomplete ser√£o inseridos aqui -->
                            </div>
                        </div>
                        
                        <!-- Filtros Discretos -->
                        <form id="filtrosForm" method="get" class="filters-discreet">
                            <select name="posto" id="filterPosto" class="filter-select-discreet">
                                <option value="">Todos os Postos</option>
                                <option value="cb" {% if filtros.posto == 'cb' %}selected{% endif %}>Coronel</option>
                                <option value="tc" {% if filtros.posto == 'tc' %}selected{% endif %}>Tenente Coronel</option>
                                <option value="mj" {% if filtros.posto == 'mj' %}selected{% endif %}>Major</option>
                                <option value="cp" {% if filtros.posto == 'cp' %}selected{% endif %}>Capit√£o</option>
                                <option value="1t" {% if filtros.posto == '1t' %}selected{% endif %}>1¬∫ Tenente</option>
                                <option value="2t" {% if filtros.posto == '2t' %}selected{% endif %}>2¬∫ Tenente</option>
                                <option value="st" {% if filtros.posto == 'st' %}selected{% endif %}>Subtenente</option>
                                <option value="1s" {% if filtros.posto == '1s' %}selected{% endif %}>1¬∫ Sargento</option>
                                <option value="2s" {% if filtros.posto == '2s' %}selected{% endif %}>2¬∫ Sargento</option>
                                <option value="3s" {% if filtros.posto == '3s' %}selected{% endif %}>3¬∫ Sargento</option>
                                <option value="cab" {% if filtros.posto == 'cab' %}selected{% endif %}>Cabo</option>
                                <option value="sd" {% if filtros.posto == 'sd' %}selected{% endif %}>Soldado</option>
                            </select>
                            <select name="quadro" id="filterQuadro" class="filter-select-discreet">
                                <option value="">Todos os Quadros</option>
                                <option value="COMB" {% if filtros.quadro == 'COMB' %}selected{% endif %}>Combatente</option>
                                <option value="ENG" {% if filtros.quadro == 'ENG' %}selected{% endif %}>Engenheiro</option>
                                <option value="COMP" {% if filtros.quadro == 'COMP' %}selected{% endif %}>Complementar</option>
                                <option value="PRACAS" {% if filtros.quadro == 'PRACAS' %}selected{% endif %}>Pra√ßas</option>
                            </select>
                            <button type="button" id="limparFiltros" class="btn btn-outline-secondary btn-sm" title="Limpar todos os filtros">
                                <i class="fas fa-times"></i> Limpar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Abas -->
        <ul class="nav nav-tabs mb-4" id="elegiveisTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="ts10-tab" data-bs-toggle="tab" data-bs-target="#ts10-content" type="button" role="tab" aria-controls="ts10-content" aria-selected="true">
                    <i class="fas fa-medal me-2 medalha-10"></i>10 Anos (Bronze)
                    <span class="badge bg-secondary tab-badge ms-2">{{ elegiveis_10|length }}</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ts20-tab" data-bs-toggle="tab" data-bs-target="#ts20-content" type="button" role="tab" aria-controls="ts20-content" aria-selected="false">
                    <i class="fas fa-medal me-2 medalha-20"></i>20 Anos (Prata)
                    <span class="badge bg-secondary tab-badge ms-2">{{ elegiveis_20|length }}</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ts30-tab" data-bs-toggle="tab" data-bs-target="#ts30-content" type="button" role="tab" aria-controls="ts30-content" aria-selected="false">
                    <i class="fas fa-medal me-2 medalha-30"></i>30 Anos (Ouro)
                    <span class="badge bg-secondary tab-badge ms-2">{{ elegiveis_30|length }}</span>
                </button>
                    </li>
        </ul>

        <!-- Conte√∫do das Abas -->
        <div class="tab-content" id="elegiveisTabsContent">
            <!-- Aba 10 Anos -->
            <div class="tab-pane fade show active" id="ts10-content" role="tabpanel" aria-labelledby="ts10-tab">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-medal me-2 medalha-10"></i>
                            Medalha de Bronze - 10 Anos de Servi√ßo
                        </h6>
                        <small class="text-muted">Militares eleg√≠veis para receber a medalha de bronze</small>
                    </div>
                    <div class="card-body">
                        {% if elegiveis_10 %}
                            <div class="elegivel-count">
                                <i class="fas fa-info-circle me-1"></i>
                                Total de eleg√≠veis: {{ elegiveis_10|length }}
                            </div>
                            <div class="list-group">
                                {% for militar in elegiveis_10 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ militar.get_posto_graduacao_display }} {{ militar.nome_completo }}</strong>
                                            <br>
                                            <small class="text-muted">
                                                <i class="fas fa-id-card me-1"></i>{{ militar.matricula }} | 
                                                <i class="fas fa-calendar me-1"></i>{{ militar.data_ingresso|date:"d/m/Y" }} | 
                                                <i class="fas fa-clock me-1"></i>{{ militar.tempo_servico }} anos
                                            </small>
                                        </div>
                                        <a class="btn btn-success btn-sm" href="{% url 'militares:conceder_medalha_militar' %}?medalha=TS_10&militar={{ militar.id }}">
                                            <i class="fas fa-medal me-1"></i>Conceder
                                        </a>
                                    </div>
                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-medal medalha-10"></i>
                                <h6>Nenhum eleg√≠vel encontrado</h6>
                                <p>N√£o h√° militares eleg√≠veis para receber a medalha de 10 anos no momento.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Aba 20 Anos -->
            <div class="tab-pane fade" id="ts20-content" role="tabpanel" aria-labelledby="ts20-tab">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-medal me-2 medalha-20"></i>
                            Medalha de Prata - 20 Anos de Servi√ßo
                        </h6>
                        <small class="text-muted">Militares eleg√≠veis para receber a medalha de prata</small>
                    </div>
                    <div class="card-body">
                        {% if elegiveis_20 %}
                            <div class="elegivel-count">
                                <i class="fas fa-info-circle me-1"></i>
                                Total de eleg√≠veis: {{ elegiveis_20|length }}
                            </div>
                            <div class="list-group">
                                {% for militar in elegiveis_20 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ militar.get_posto_graduacao_display }} {{ militar.nome_completo }}</strong>
                                            <br>
                                            <small class="text-muted">
                                                <i class="fas fa-id-card me-1"></i>{{ militar.matricula }} | 
                                                <i class="fas fa-calendar me-1"></i>{{ militar.data_ingresso|date:"d/m/Y" }} | 
                                                <i class="fas fa-clock me-1"></i>{{ militar.tempo_servico }} anos
                                            </small>
                                        </div>
                                        <a class="btn btn-success btn-sm" href="{% url 'militares:conceder_medalha_militar' %}?medalha=TS_20&militar={{ militar.id }}">
                                            <i class="fas fa-medal me-1"></i>Conceder
                                        </a>
        </div>
                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-medal medalha-20"></i>
                                <h6>Nenhum eleg√≠vel encontrado</h6>
                                <p>N√£o h√° militares eleg√≠veis para receber a medalha de 20 anos no momento.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Aba 30 Anos -->
            <div class="tab-pane fade" id="ts30-content" role="tabpanel" aria-labelledby="ts30-tab">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-medal me-2 medalha-30"></i>
                            Medalha de Ouro - 30 Anos de Servi√ßo
                        </h6>
                        <small class="text-muted">Militares eleg√≠veis para receber a medalha de ouro</small>
                    </div>
                    <div class="card-body">
                        {% if elegiveis_30 %}
                            <div class="elegivel-count">
                                <i class="fas fa-info-circle me-1"></i>
                                Total de eleg√≠veis: {{ elegiveis_30|length }}
                            </div>
                            <div class="list-group">
                                {% for militar in elegiveis_30 %}
                                    <div class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>{{ militar.get_posto_graduacao_display }} {{ militar.nome_completo }}</strong>
                                            <br>
                                            <small class="text-muted">
                                                <i class="fas fa-id-card me-1"></i>{{ militar.matricula }} | 
                                                <i class="fas fa-calendar me-1"></i>{{ militar.data_ingresso|date:"d/m/Y" }} | 
                                                <i class="fas fa-clock me-1"></i>{{ militar.tempo_servico }} anos
                                            </small>
                                        </div>
                                        <a class="btn btn-success btn-sm" href="{% url 'militares:conceder_medalha_militar' %}?medalha=TS_30&militar={{ militar.id }}">
                                            <i class="fas fa-medal me-1"></i>Conceder
                                        </a>
        </div>
                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-medal medalha-30"></i>
                                <h6>Nenhum eleg√≠vel encontrado</h6>
                                <p>N√£o h√° militares eleg√≠veis para receber a medalha de 30 anos no momento.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funcionalidade de busca discreta
    const searchInput = document.getElementById('pesquisaElegiveis');
    const searchClear = document.getElementById('searchClear');
    const autocompleteContainer = document.getElementById('autocompleteContainer');
    const limparFiltros = document.getElementById('limparFiltros');
    
    // Mostrar/ocultar bot√£o de limpar busca
    if (searchInput && searchClear) {
        searchInput.addEventListener('input', function() {
            searchClear.style.display = this.value ? 'block' : 'none';
        });
        
        searchClear.addEventListener('click', function() {
            searchInput.value = '';
            searchInput.focus();
            this.style.display = 'none';
            // Limpar busca e recarregar p√°gina
            window.location.href = window.location.pathname;
        });
        
        // Busca por Enter
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                performSearch();
            }
        });
    }
    
    function performSearch() {
        const query = searchInput.value.trim();
        if (!query) return;
        
        const params = new URLSearchParams();
        params.append('q', query);
        
        // Adicionar filtros ativos
        if (filterPosto && filterPosto.value) {
            params.append('posto', filterPosto.value);
        }
        if (filterQuadro && filterQuadro.value) {
            params.append('quadro', filterQuadro.value);
        }
        
        const url = window.location.pathname + '?' + params.toString();
        window.location.href = url;
    }
    
    // Limpar filtros
    if (limparFiltros) {
        limparFiltros.addEventListener('click', function() {
            window.location.href = window.location.pathname;
        });
    }
    
    // Funcionalidade dos filtros
    const filterPosto = document.getElementById('filterPosto');
    const filterQuadro = document.getElementById('filterQuadro');
    
    if (filterPosto) {
        filterPosto.addEventListener('change', () => {
            applyFilters();
        });
    }
    
    if (filterQuadro) {
        filterQuadro.addEventListener('change', () => {
            applyFilters();
        });
    }
    
    function applyFilters() {
        const params = new URLSearchParams();
        
        if (filterPosto && filterPosto.value) {
            params.append('posto', filterPosto.value);
        }
        if (filterQuadro && filterQuadro.value) {
            params.append('quadro', filterQuadro.value);
        }
        
        const url = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
        window.location.href = url;
    }
    
    // Ativar a primeira aba por padr√£o
    const firstTab = document.querySelector('#elegiveisTabs .nav-link');
    if (firstTab) {
        firstTab.classList.add('active');
    }
    
    // Adicionar funcionalidade para as abas
    const tabLinks = document.querySelectorAll('#elegiveisTabs .nav-link');
    tabLinks.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remover classe active de todas as abas
            tabLinks.forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('show', 'active'));
            
            // Adicionar classe active na aba clicada
            this.classList.add('active');
            const target = document.querySelector(this.getAttribute('data-bs-target'));
            if (target) {
                target.classList.add('show', 'active');
            }
        });
    });
});
</script>
{% endblock %}


