{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SysgaBom - Sistema de Gerenciamento Administrativo do Corpo de Bombeiros{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'logo_cbmepi.png' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'logo_cbmepi.png' %}">
    
    <!-- Bootstrap CSS (local) -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/bootstrap-icons.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/all.min.css' %}" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #ff6b35; /* Laranja vibrante */
            --secondary-color: #d62828; /* Vermelho */
            --accent-color: #f77f00; /* Laranja mais escuro */
            --dark-color: #1a1a1a; /* Preto */
            --dark-gray: #2d2d2d; /* Cinza escuro */
            --light-orange: #ff8c42; /* Laranja claro */
        }
        
        body {
            background-color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333333;
        }
        img { max-width: 100%; height: auto; }
        .img-fluid { max-width: 100%; height: auto; }
        @media (max-width: 768px) {
            .table { display: block; width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .btn { white-space: normal; }
            .container, .container-fluid { padding-left: 8px; padding-right: 8px; }
            .card { margin-left: 0; margin-right: 0; }
            .mobile-bottom-nav { display: flex; }
            /* Offcanvas Sidebar (mobile) */
            #mainSidebar {
                display: block;
                position: fixed;
                top: 0; bottom: 0; left: -280px;
                width: 280px;
                background: #ffffff;
                box-shadow: 4px 0 16px rgba(0,0,0,0.12);
                transition: left .25s ease;
                z-index: 1041;
                overflow-y: auto;
            }
            #mainSidebar.show { left: 0; }
            .sidebar-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.35);
                opacity: 0; visibility: hidden;
                transition: opacity .2s ease;
                z-index: 1040;
            }
            .sidebar-overlay.show { opacity: 1; visibility: visible; }
        }
        @media (min-width: 769px) {
            .mobile-bottom-nav { display: none; }
        }
        /* Dark mode */
        [data-theme="dark"] body { background-color: #121212; color: #eaeaea; }
        [data-theme="dark"] .card { background-color: #1e1e1e; color: #eaeaea; border-color: #2a2a2a; }
        [data-theme="dark"] .mobile-bottom-nav { background: #1e1e1e; border-top-color: #2a2a2a; }
        [data-theme="dark"] #mainSidebar { background: #1e1e1e; }
        [data-theme="dark"] .nav-link { color: #ddd; }
        [data-theme="dark"] .nav-link.active { color: #fff; }
        .mobile-bottom-nav {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            z-index: 1040;
            background: #ffffff;
            border-top: 1px solid #e5e5e5;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.06);
            padding: 8px 12px;
            align-items: center;
            justify-content: space-between;
        }
        .mobile-bottom-nav .mobile-nav-item {
            flex: 1;
            text-align: center;
            color: #333;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .mobile-bottom-nav .mobile-nav-item i {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        /* Estilos Discretos e Elegantes para Card do Navbar */
        .navbar-card-ultra {
            transition: all 0.3s ease;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .navbar-card-ultra:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15) !important;
        }
        
        .navbar-card-ultra::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.4) 0%, 
                rgba(255,255,255,0.2) 50%, 
                rgba(255,255,255,0.4) 100%);
        }
        
        .info-section {
            display: flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .info-section:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(2px);
        }
        
        .info-icon {
            margin-right: 0.6rem;
            position: relative;
            z-index: 2;
        }
        
        .info-icon i {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: all 0.2s ease;
            color: rgba(255,255,255,0.9);
        }
        
        .info-section:hover .info-icon i {
            transform: scale(1.05);
            color: rgba(255,255,255,1);
        }
        
        .info-content {
            flex: 1;
            position: relative;
            z-index: 2;
        }
        
        .info-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.1rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            letter-spacing: 0.2px;
            color: rgba(255,255,255,0.95);
        }
        
        .info-text {
            font-size: 0.7rem;
            margin: 0;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            font-weight: 400;
            opacity: 0.9;
            color: rgba(255,255,255,0.85);
        }
        
        /* Estilos para Menu Moderno e Robusto */
        .modern-nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #fff;
            position: relative;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .modern-nav-link:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            color: #fff;
        }
        
        .nav-icon-wrapper {
            position: relative;
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .modern-nav-link:hover .nav-icon-wrapper {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        /* Espaçamento entre itens do navbar */
        .navbar-nav .nav-item:not(:last-child) {
            margin-right: 0.5rem;
        }
        
        .navbar-nav .nav-item.me-4 {
            margin-right: 1rem !important;
        }
        
        .navbar-nav .nav-item.ms-2 {
            margin-left: 0.5rem !important;
        }
        
        /* Cores para ícones de boneco bombeiro */
        #funcaoDropdown .nav-icon-wrapper i {
            color: #000000 !important; /* Preto */
        }
        
        #navbarDropdown .nav-icon-wrapper i {
            color: #000000 !important; /* Preto */
        }
        
        /* Efeito hover para os ícones pretos */
        #funcaoDropdown:hover .nav-icon-wrapper i {
            color: #333333 !important; /* Cinza escuro no hover */
            transform: scale(1.1);
        }
        
        #navbarDropdown:hover .nav-icon-wrapper i {
            color: #333333 !important; /* Cinza escuro no hover */
            transform: scale(1.1);
        }
        
        .nav-icon-wrapper i {
            font-size: 1.2rem;
            color: #fff;
        }
        
        .nav-text-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .nav-title {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.2;
            color: #fff;
            white-space: normal;
            word-wrap: break-word;
            overflow: visible;
            text-overflow: clip;
        }
        
        .nav-subtitle {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
            line-height: 1.2;
        }
        
        .nav-label {
            font-weight: 500;
            font-size: 0.85rem;
            color: #fff;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(220,53,69,0.4);
        }
        
        .notification-badge.warning {
            background: #ffc107;
            color: #000;
            box-shadow: 0 2px 8px rgba(255,193,7,0.4);
        }
        
        .session-timer {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 400;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .session-timer:hover {
            background: rgba(255,255,255,0.15);
            color: rgba(255,255,255,0.9);
        }
        
        /* Cronômetro Digital Discreto */
        .discrete-timer-container {
            position: relative;
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        
        .discrete-timer {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 0.3rem 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            font-weight: 500;
            color: rgba(255,255,255,0.9);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            opacity: 0.9;
        }
        
        .discrete-timer:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        
        .discrete-timer i {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.8);
        }
        
        .discrete-timer.warning {
            background: rgba(255,193,7,0.2);
            color: #ffc107;
            border-color: rgba(255,193,7,0.4);
        }
        
        .discrete-timer.danger {
            background: rgba(220,53,69,0.2);
            color: #dc3545;
            border-color: rgba(220,53,69,0.4);
            animation: pulse-discrete 1s infinite;
        }
        
        @keyframes pulse-discrete {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Responsividade para cronômetro discreto */
        @media (max-width: 768px) {
            .discrete-timer-container {
                margin-top: 0.8rem;
                margin-bottom: 0.8rem;
            }
            
            .discrete-timer {
                padding: 0.25rem 0.5rem;
                font-size: 0.7rem;
            }
        }
        
        @media (max-width: 576px) {
            .discrete-timer-container {
                margin-top: 0.6rem;
                margin-bottom: 0.6rem;
            }
            
            .discrete-timer {
                padding: 0.2rem 0.4rem;
                font-size: 0.65rem;
                gap: 0.3rem;
            }
        }
        
        
        .modern-dropdown {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 0.5rem 0;
            margin-top: 0.5rem;
        }
        
        .modern-dropdown .dropdown-header {
            padding: 0.75rem 1rem 0.5rem;
            font-weight: 600;
            color: #495057;
            font-size: 0.85rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            margin-bottom: 0.5rem;
        }
        
        .modern-dropdown-item {
            padding: 0.75rem 1rem;
            transition: all 0.2s ease;
            border-radius: 8px;
            margin: 0.25rem 0.5rem;
            color: #495057;
        }
        
        .modern-dropdown-item:hover {
            background: rgba(0,123,255,0.1);
            color: #007bff;
            transform: translateX(5px);
        }
        
        .modern-badge {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }
        
        /* Responsividade para Menu Moderno */
        @media (max-width: 768px) {
            .modern-nav-link {
                padding: 0.5rem 0.75rem;
                margin-bottom: 0.25rem;
            }
            
            .nav-icon-wrapper {
                width: 35px;
                height: 35px;
                margin-right: 0.5rem;
            }
            
            .nav-icon-wrapper i {
                font-size: 1rem;
            }
            
            .nav-title {
                font-size: 0.8rem;
            }
            
            .nav-subtitle {
                font-size: 0.7rem;
            }
            
            .nav-label {
                font-size: 0.8rem;
            }
            
            .modern-dropdown {
                margin-top: 0.25rem;
                border-radius: 12px;
            }
            
            .modern-dropdown-item {
                padding: 0.5rem 0.75rem;
                margin: 0.15rem 0.25rem;
            }
        }
        
        @media (max-width: 576px) {
            .modern-nav-link {
                padding: 0.4rem 0.6rem;
            }
            
            .nav-icon-wrapper {
                width: 30px;
                height: 30px;
                margin-right: 0.4rem;
            }
            
            .nav-icon-wrapper i {
                font-size: 0.9rem;
            }
            
            .nav-title {
                font-size: 0.75rem;
            }
            
            .nav-subtitle {
                font-size: 0.65rem;
            }
            
            .nav-label {
                font-size: 0.75rem;
            }
        }
        
        
        /* Responsividade Larga e Baixa */
        @media (max-width: 576px) {
            .navbar-card-ultra {
                border-radius: 12px;
                margin: 0 0.25rem;
            }
            
            .info-section {
                padding: 0.2rem 0.4rem;
                margin-bottom: 0.1rem;
            }
            
            .info-icon {
                margin-right: 0.5rem;
            }
            
            .info-icon i {
                font-size: 1.2rem;
            }
            
            .info-title {
                font-size: 0.75rem;
            }
            
            .info-text {
                font-size: 0.65rem;
            }
        }
        
        @media (min-width: 577px) and (max-width: 768px) {
            .info-section {
                padding: 0.25rem 0.45rem;
            }
            
            .info-icon {
                margin-right: 0.55rem;
            }
            
            .info-icon i {
                font-size: 1.3rem;
            }
        }
        
        @media (min-width: 769px) and (max-width: 992px) {
            .info-section {
                padding: 0.25rem 0.5rem;
            }
            
            .info-icon {
                margin-right: 0.6rem;
            }
            
            .info-icon i {
                font-size: 1.4rem;
            }
        }
        
        @media (min-width: 993px) {
            .info-section {
                padding: 0.25rem 0.5rem;
            }
            
            .info-icon {
                margin-right: 0.6rem;
            }
            
            .info-icon i {
                font-size: 1.5rem;
            }
        }
        
        /* Conteúdo principal com fundo branco */
        .main-content {
            background-color: #ffffff;
            color: #333333;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 10px;
            background-color: #ffffff;
            color: #333333;
            border: 1px solid #e5e7eb;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .btn-danger {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-warning {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .table {
            background-color: #ffffff;
            color: #333333;
        }
        
        .table td {
            border-color: #dee2e6;
        }
        
        .sidebar {
            min-height: calc(100vh - 56px);
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.9) !important;
            border-radius: 8px;
            margin: 3px 0;
            padding: 10px 15px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            color: #ffffff !important;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            border-left: 3px solid #ffffff;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .sidebar-heading {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.8) !important;
            font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        /* Garantir que ícones e texto no sidebar permaneçam brancos */
        .sidebar .nav-link i,
        .sidebar .nav-link span,
        .sidebar .nav-link:hover i,
        .sidebar .nav-link:hover span,
        .sidebar .nav-link.active i,
        .sidebar .nav-link.active span {
            color: #ffffff !important;
        }
        
        /* Estilos para submenu */
        .sidebar .nav-link.dropdown-toggle::after {
            color: rgba(255,255,255,0.7);
            border-top: 0.3em solid;
            border-right: 0.3em solid transparent;
            border-bottom: 0;
            border-left: 0.3em solid transparent;
            margin-left: auto;
            transition: transform 0.3s ease;
        }
        
        .sidebar .nav-link.dropdown-toggle[aria-expanded="true"]::after {
            transform: rotate(180deg);
        }
        
        .sidebar .collapse .nav-link {
            font-size: 0.9rem;
            padding: 8px 15px;
            margin: 2px 0;
            border-left: 2px solid transparent;
            background: rgba(255,255,255,0.1);
        }
        
        .sidebar .collapse .nav-link:hover {
            background: rgba(255,255,255,0.2);
            border-left: 2px solid rgba(255,255,255,0.5);
        }
        
        .sidebar .collapse .nav-link.active {
            background: rgba(255,255,255,0.25);
            border-left: 2px solid #ffffff;
        }
        
        
        /* Sobrescrever qualquer estilo que possa afetar a cor do texto no sidebar */
        .sidebar * {
            color: inherit !important;
        }
        
        /* Garantir que o container da logo não seja afetado pelos estilos do sidebar */
        .sidebar .sidebar-logo-container {
            background-color: white !important;
            padding: 5px !important;
            border-radius: 10px !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
            margin-bottom: 10px !important;
            display: inline-block !important;
            color: #333 !important;
        }
        
        .sidebar .sidebar-logo-container * {
            color: #333 !important;
        }
        
        /* Estilo específico para o container da logo usando ID */
        #sidebar-logo-container {
            background-color: white !important;
            padding: 5px !important;
            border-radius: 10px !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2) !important;
            margin-bottom: 10px !important;
            display: inline-block !important;
            color: #333 !important;
            width: auto !important;
            box-sizing: border-box !important;
        }
        
        #sidebar-logo-container * {
            color: #333 !important;
        }
        
        .sidebar .nav-link,
        .sidebar .nav-link:hover,
        .sidebar .nav-link:focus,
        .sidebar .nav-link.active {
            color: #ffffff !important;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
            border-radius: 15px;
        }
        
        .stats-card.success {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--light-orange) 100%);
        }
        
        .stats-card.warning {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #e74c3c 100%);
        }
        
        .stats-card.info {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        }
        
        /* Estilos específicos para o dashboard */
        .border-left-danger {
            border-left: 4px solid var(--secondary-color) !important;
        }
        
        .card-header.bg-danger {
            background: linear-gradient(135deg, var(--secondary-color), #e74c3c) !important;
        }
        
        .list-group-item {
            border: none;
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        
        .list-group-item:last-child {
            border-bottom: none;
        }
        
        /* Estilos adicionais para o tema laranja+vermelho+preto */
        .navbar-dark {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%) !important;
            border-bottom: 3px solid var(--accent-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .navbar-brand {
            color: #ffffff !important;
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .navbar-brand img {
            transition: all 0.3s ease;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .navbar-brand:hover img {
            transform: scale(1.1);
        }
        
        .dropdown-menu {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--dark-color) 100%);
            border: 2px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        .dropdown-item {
            color: #333333;
        }
        
        .dropdown-item:hover {
            background-color: var(--primary-color);
            color: #ffffff;
        }
        
        .dropdown-item {
            color: #ffffff !important;
        }
        
        .dropdown-item:hover {
            background-color: var(--primary-color);
            color: #ffffff !important;
        }
        
        .nav-link {
            color: #ffffff !important;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: var(--accent-color) !important;
            text-shadow: 0 0 8px rgba(255,255,255,0.5);
        }
        
        .form-control, .form-select {
            background-color: #ffffff;
            border: 1px solid #ced4da;
            color: #333333;
        }
        
        .form-control:focus, .form-select:focus {
            background-color: #ffffff;
            border-color: var(--primary-color);
            color: #333333;
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .alert {
            background-color: #ffffff;
            border: 1px solid var(--primary-color);
            color: #333333;
        }
        
        .modal-content {
            background-color: #ffffff;
            color: #333333;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
        }
        
        .badge.bg-danger {
            background-color: var(--secondary-color) !important;
        }
        
        .badge.bg-primary {
            background-color: var(--primary-color) !important;
        }
        
        .badge.bg-warning {
            background-color: var(--accent-color) !important;
        }
        
        /* Estilos para o cronômetro de sessão */
        #session-timer {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            min-width: 60px;
            text-align: center;
        }
        
        #session-timer.bg-success {
            animation: pulse-green 2s infinite;
        }
        
        #session-timer.bg-warning {
            animation: pulse-orange 2s infinite;
        }
        
        #session-timer.bg-danger {
            animation: pulse-red 1s infinite;
        }
        
        @keyframes pulse-green {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes pulse-orange {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes pulse-red {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Estilos para o modal de aviso de sessão */
        #sessionWarningModal .modal-header {
            background: linear-gradient(135deg, #ffc107, #ff8c00) !important;
        }
        
        #sessionWarningModal .alert-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border: none;
        }
        
        /* Estilos para os toasts */
        .toast-container {
            z-index: 9999;
        }
        
        .toast {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        /* Estilos para campos de senha com toggle */
        .password-field-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .password-field-wrapper input[type="password"],
        .password-field-wrapper input[type="text"] {
            padding-right: 40px !important;
        }
        
        .password-toggle-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            border: none;
            background: transparent;
            color: #6c757d;
            font-size: 14px;
            padding: 6px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .password-toggle-btn:hover {
            background-color: #f8f9fa !important;
            color: #495057 !important;
        }
        
        .password-toggle-btn:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        .password-toggle-btn.active {
            color: #dc3545 !important;
        }
        
        .password-toggle-btn.active:hover {
            color: #c82333 !important;
        }
        
        /* Melhorar aparência dos campos de senha */
        .form-control[type="password"]:focus,
        .form-control[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        /* Responsividade para campos de senha */
        @media (max-width: 768px) {
            .password-toggle-btn {
                padding: 8px 10px;
                font-size: 16px;
            }
            
            .password-field-wrapper input[type="password"],
            .password-field-wrapper input[type="text"] {
                padding-right: 45px !important;
            }
        }
        
        /* Estilos para o submenu de medalhas */
        #medalhasSubmenu {
            border-left: 2px solid rgba(255,255,255,0.3);
            margin-left: 1rem;
            background-color: rgba(255,255,255,0.05);
            border-radius: 0 8px 8px 0;
        }
        
        #medalhasSubmenu .nav-link {
            padding: 8px 15px;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8) !important;
            border-left: 2px solid transparent;
            transition: all 0.2s ease;
            margin: 2px 0;
        }
        
        #medalhasSubmenu .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            color: #ffffff !important;
            border-left-color: var(--accent-color);
            transform: translateX(3px);
        }
        
        #medalhasSubmenu .nav-link.active {
            background-color: rgba(255,255,255,0.15);
            color: #ffffff !important;
            border-left-color: var(--accent-color);
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        #medalhasSubmenu .nav-link i {
            width: 16px;
            font-size: 0.8rem;
        }
        
        /* Indicador visual para menu expandido */
        .dropdown-toggle[aria-expanded="true"] {
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)) !important;
            color: #ffffff !important;
            border-left: 3px solid var(--accent-color) !important;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        /* Animação suave para o submenu */
        #medalhasSubmenu.collapse {
            transition: all 0.3s ease;
        }
        
        #medalhasSubmenu.show {
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ============================================
           RESPONSIVIDADE PARA SMARTPHONES
           ============================================ */
        
        /* Botão toggle para sidebar em mobile */
        .sidebar-toggle-btn {
            display: none;
            position: fixed;
            top: 70px;
            left: 10px;
            z-index: 1050;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        
        .sidebar-toggle-btn:active {
            transform: scale(0.95);
        }
        
        /* Overlay para fechar sidebar em mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1040;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.show {
            display: block;
            opacity: 1;
        }
        
        /* Ajustes da sidebar para mobile */
        @media (max-width: 767.98px) {
            .sidebar-toggle-btn {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                width: 280px;
                z-index: 1050;
                transition: left 0.3s ease;
                overflow-y: auto;
                box-shadow: 2px 0 15px rgba(0,0,0,0.3);
            }
            
            .sidebar.show {
                left: 0;
            }
            
            /* Ajustar conteúdo principal quando sidebar está aberta */
            main {
                width: 100% !important;
                margin-left: 0 !important;
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            /* Garantir que o conteúdo principal ocupe toda a largura em mobile */
            .container-fluid > .row {
                margin-left: 0;
                margin-right: 0;
            }
            
            .container-fluid > .row > main {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            /* Navbar ajustes */
            .navbar {
                padding: 0.5rem 1rem;
            }
            
            .navbar-brand {
                font-size: 1rem;
            }
            
            /* Foto do usuário no navbar - menor em mobile */
            .navbar-brand img {
                width: 60px !important;
                height: 60px !important;
            }
            
            /* Card de informações da função - ajustes */
            .navbar-card-ultra {
                margin: 0.5rem 0;
                border-radius: 10px;
            }
            
            .navbar-card-ultra .card-body {
                padding: 0.75rem !important;
            }
            
            .info-section {
                padding: 0.4rem 0.5rem;
                margin-bottom: 0.3rem;
            }
            
            .info-icon i {
                font-size: 1rem !important;
            }
            
            .info-title {
                font-size: 0.7rem !important;
            }
            
            .info-text {
                font-size: 0.6rem !important;
            }
            
            /* Links do navbar - ajustes */
            .modern-nav-link {
                padding: 0.5rem 0.75rem;
                margin-bottom: 0.25rem;
            }
            
            .nav-icon-wrapper {
                width: 32px;
                height: 32px;
            }
            
            .nav-icon-wrapper i {
                font-size: 0.9rem;
            }
            
            .nav-label {
                font-size: 0.75rem;
            }
            
            .nav-title {
                font-size: 0.75rem;
            }
            
            .nav-subtitle {
                font-size: 0.65rem;
            }
            
            /* Dropdown menus - ajustes */
            .modern-dropdown {
                max-width: calc(100vw - 20px);
                margin-top: 0.25rem;
            }
            
            /* Container principal */
            .container-fluid {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            
            /* Tabelas responsivas */
            .table-responsive {
                border-radius: 8px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .table {
                font-size: 0.85rem;
            }
            
            .table th,
            .table td {
                padding: 0.5rem 0.4rem;
                white-space: nowrap;
            }
            
            /* Cards - ajustes */
            .card {
                margin-bottom: 1rem;
                border-radius: 10px;
            }
            
            .card-header {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            .card-body {
                padding: 1rem 0.75rem;
            }
            
            /* Botões - ajustes */
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
            
            /* Formulários - ajustes */
            .form-control,
            .form-select {
                font-size: 16px; /* Evita zoom no iOS */
                padding: 0.6rem 0.75rem;
            }
            
            .form-label {
                font-size: 0.9rem;
                margin-bottom: 0.4rem;
            }
            
            /* Modais - ajustes */
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            .modal-content {
                border-radius: 10px;
            }
            
            .modal-header {
                padding: 0.75rem 1rem;
            }
            
            .modal-body {
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .modal-footer {
                padding: 0.75rem 1rem;
            }
            
            /* Alerts - ajustes */
            .alert {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }
            
            /* Badges - ajustes */
            .badge {
                font-size: 0.7rem;
                padding: 0.3rem 0.5rem;
            }
            
            /* Espaçamentos gerais */
            .mb-3 {
                margin-bottom: 1rem !important;
            }
            
            .mb-4 {
                margin-bottom: 1.5rem !important;
            }
            
            .mt-3 {
                margin-top: 1rem !important;
            }
            
            .mt-4 {
                margin-top: 1.5rem !important;
            }
            
            /* Logo da sidebar - ajustes */
            #sidebar-logo-container img {
                height: 60px !important;
                max-width: 200px;
            }
            
            /* Links da sidebar - ajustes */
            .sidebar .nav-link {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .sidebar .nav-link i {
                font-size: 1rem;
                width: 20px;
            }
            
            /* Cronômetro discreto - ajustes */
            .discrete-timer-container {
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            .discrete-timer {
                padding: 0.2rem 0.4rem;
                font-size: 0.65rem;
            }
        }
        
        /* Ajustes para tablets */
        @media (min-width: 768px) and (max-width: 991.98px) {
            .sidebar {
                width: 200px;
            }
            
            main {
                margin-left: 200px;
            }
            
            .navbar-card-ultra .card-body {
                padding: 0.5rem 0.75rem !important;
            }
            
            .info-title {
                font-size: 0.75rem;
            }
            
            .info-text {
                font-size: 0.65rem;
            }
        }
        
        /* Melhorias gerais para telas pequenas */
        @media (max-width: 575.98px) {
            /* Navbar ainda mais compacto */
            .navbar {
                padding: 0.4rem 0.75rem;
            }
            
            /* Ocultar alguns elementos em telas muito pequenas */
            .nav-subtitle {
                display: none;
            }
            
            /* Foto do usuário ainda menor */
            .navbar-brand img {
                width: 50px !important;
                height: 50px !important;
            }
            
            /* Cards de informação mais compactos */
            .info-section {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.3rem 0.4rem;
            }
            
            .info-icon {
                margin-right: 0;
                margin-bottom: 0.2rem;
            }
            
            /* Tabelas - scroll horizontal mais suave */
            .table-responsive {
                -webkit-overflow-scrolling: touch;
            }
            
            /* Botões em linha - empilhar */
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn-group .btn {
                border-radius: 0.375rem !important;
                margin-bottom: 0.25rem;
            }
            
            /* Inputs full width */
            .form-control,
            .form-select {
                width: 100%;
            }
        }
        .apk-mode .container, .apk-mode .container-fluid { padding-left: 12px; padding-right: 12px; }
        .apk-mode .navbar-brand img { width: 48px; height: 48px; }
        .apk-ensino .btn { padding: .6rem 1rem; }
    </style>
    
    {% block extra_css %}{% endblock %}
    {% block ckeditor_media %}{% endblock %}
</head>
<body class="{% if is_apk or request.GET.apk %}apk-mode{% endif %} {% if 'ensino' in request.path %}apk-ensino{% endif %}">
    <!-- CSRF Token para JavaScript -->
    {% csrf_token %}
    <script>
        // Disponibilizar CSRF token globalmente
        window.csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    </script>
    <script>
        {% if is_apk or request.GET.apk %}
        (function(){
            var anchors = document.querySelectorAll('a[href]');
            anchors.forEach(function(a){
                var href = a.getAttribute('href');
                if (!href) return;
                if (href.indexOf('http') === 0) return;
                if (href.indexOf('#') === 0) return;
                if (href.indexOf('apk=') !== -1) return;
                var sep = href.indexOf('?') === -1 ? '?' : '&';
                a.setAttribute('href', href + sep + 'apk=1');
            });
        })();
        {% endif %}
    </script>
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <!-- Informações Adicionais da Função Ativa -->
            <div class="navbar-brand d-flex align-items-center">
                {% if funcao_atual %}
                    <div class="text-white">
                        <div class="d-flex flex-wrap align-items-center gap-3">
                            <!-- Foto do Usuário -->
                            {% if user.militar and user.militar.foto %}
                                <div class="me-3">
                                    <img src="{{ user.militar.foto.url }}" 
                                         alt="Foto do {{ user.militar.nome_guerra }}" 
                                         style="width: 100px; height: 100px; border-radius: 12px; object-fit: cover; box-shadow: 0 4px 20px rgba(0,0,0,0.3); filter: contrast(1.1) brightness(1.05) saturate(1.1);"
                                         title="{{ user.militar.get_posto_graduacao_display }} {{ user.militar.nome_guerra }}">
                                </div>
                            {% endif %}
                            <!-- Card Unificado Ultra Moderno -->
                            <div class="row justify-content-center">
                                <div class="col-12">
                                    <div class="card border-0 navbar-card-ultra" 
                                         style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #3498db 100%);">
                                        <div class="card-body text-white py-1 px-2 py-md-1 px-md-3 py-lg-1 px-lg-4">
                                            <div class="row g-1 g-md-2 g-lg-3">
                                                <!-- Acesso -->
                                                <div class="col-12 col-sm-6 col-lg-4">
                                                    <div class="info-section">
                                                        <div class="info-icon">
                                                            <i class="fas fa-shield-alt"></i>
                                                        </div>
                                                        <div class="info-content">
                                                            <h6 class="info-title">Acesso</h6>
                                                            <p class="info-text">{{ funcao_atual.funcao_militar.get_acesso_display }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Publicação -->
                                                {% if funcao_atual.funcao_militar.publicacao != 'NENHUM' %}
                                                <div class="col-12 col-sm-6 col-lg-4">
                                                    <div class="info-section">
                                                        <div class="info-icon">
                                                            <i class="fas fa-edit"></i>
                                                        </div>
                                                        <div class="info-content">
                                                            <h6 class="info-title">Publicação</h6>
                                                            <p class="info-text">{{ funcao_atual.funcao_militar.get_publicacao_display }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endif %}
                                                
                                                <!-- Grupo -->
                                                <div class="col-12 col-sm-6 col-lg-4">
                                                    <div class="info-section">
                                                        <div class="info-icon">
                                                            <i class="fas fa-tag"></i>
                                                        </div>
                                                        <div class="info-content">
                                                            <h6 class="info-title">Grupo</h6>
                                                            <p class="info-text">{{ funcao_atual.funcao_militar.get_grupo_display }}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cronômetro Digital Discreto -->
                            <div class="discrete-timer-container">
                                <div class="discrete-timer" id="discrete-timer">
                                    <i class="fas fa-clock"></i>
                                    <span id="discrete-timer-display">30:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    {% if aluno_ensino and turma_ensino %}
                    <div class="text-white">
                        <div class="fw-bold fs-5">
                            <i class="fas fa-graduation-cap me-2"></i>Módulo de Ensino
                        </div>
                        <div class="text-muted">
                            {% if curso_ensino %}
                            <div><strong>Curso:</strong> {{ curso_ensino.nome }}</div>
                            {% endif %}
                            <div><strong>Turma:</strong> {{ turma_ensino.identificacao }}</div>
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    
                    <li class="nav-item me-4">
                        <a class="nav-link modern-nav-link" href="{% url 'militares:notificacoes_list' %}" 
                           title="Visualizar notificações do sistema">
                            <div class="nav-icon-wrapper">
                                <i class="fas fa-bell"></i>
                                {% if total_notificacoes > 0 %}
                                    <span class="notification-badge">{{ total_notificacoes }}</span>
                                {% endif %}
                            </div>
                            <span class="nav-label">Notificações</span>
                        </a>
                    </li>
                    {% if sessoes_alertas.tem_alertas %}
                        <li class="nav-item">
                            <a class="nav-link modern-nav-link" href="#" data-bs-toggle="modal" data-bs-target="#sessaoAlertModal">
                                <div class="nav-icon-wrapper">
                                    <i class="fas fa-calendar"></i>
                                    <span class="notification-badge warning">
                                        {% if sessoes_alertas.em_andamento %}
                                            {{ sessoes_alertas.em_andamento.count }}
                                        {% elif sessoes_alertas.hoje %}
                                            {{ sessoes_alertas.hoje.count }}
                                        {% else %}
                                            {{ sessoes_alertas.proximas.count }}
                                        {% endif %}
                                    </span>
                                </div>
                                <span class="nav-label">Sessões</span>
                            </a>
                        </li>
                    {% endif %}
                    
                    <!-- Dropdown de Seleção de Função -->
                    {% if user.is_authenticated and not user.is_superuser and funcoes_usuario %}
                    <li class="nav-item dropdown ms-2 me-3">
                        <a class="nav-link dropdown-toggle modern-nav-link" href="#" id="funcaoDropdown" role="button" data-bs-toggle="dropdown">
                            <div class="nav-icon-wrapper">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="nav-text-content">
                                <div class="nav-title" id="funcao-atual-nome" style="white-space: normal; word-wrap: break-word;">
                                    {% if funcao_atual %}
                                        {{ funcao_atual.funcao_militar.nome }}
                                    {% else %}
                                        Selecionar Função
                                    {% endif %}
                                </div>
                                <div class="nav-subtitle" id="funcao-atual-lotacao">
                                    {% if funcao_atual and funcao_atual.get_nivel_lotacao and funcao_atual.get_nivel_lotacao != "Sem lotação definida" %}
                                        {{ funcao_atual.get_nivel_lotacao }}
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                        <ul class="dropdown-menu modern-dropdown" aria-labelledby="funcaoDropdown">
                            <li class="dropdown-header">
                                <i class="fas fa-user-tie me-2"></i>Suas Funções
                            </li>
                            {% if funcoes_usuario %}
                                {% for funcao in funcoes_usuario %}
                                    <li>
                                        <a class="dropdown-item modern-dropdown-item funcao-option" href="#" data-funcao-id="{{ funcao.id }}">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="flex-grow-1">
                                                    <div class="fw-bold" style="white-space: normal; word-wrap: break-word;">{{ funcao.funcao_militar.nome }}</div>
                                                    <div class="d-flex align-items-center mt-1">
                                                        <span class="badge modern-badge bg-{% if funcao.tipo_funcao == 'PRINCIPAL' %}warning{% elif funcao.tipo_funcao == 'ADICIONAL' %}info{% elif funcao.tipo_funcao == 'TEMPORARIA' %}secondary{% elif funcao.tipo_funcao == 'COMISSAO' %}primary{% else %}light{% endif %}">
                                                            {{ funcao.get_tipo_funcao_display }}
                                                        </span>
                                                        {% if funcao.militar.lotacao_atual %}
                                                            <small class="text-muted ms-2">{{ funcao.militar.lotacao_atual }}</small>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="ms-2">
                                                    {% if funcao.ativo %}
                                                        <i class="fas fa-check-circle text-success" title="Função Ativa"></i>
                                                    {% else %}
                                                        <i class="fas fa-circle text-muted" title="Função Inativa"></i>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li>
                                    <div class="dropdown-item text-muted text-center">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Nenhuma função disponível
                                    </div>
                                </li>
                            {% endif %}
                        </ul>
                    </li>
                    {% endif %}
                    
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle modern-nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <div class="nav-icon-wrapper">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="nav-text-content">
                                <div class="nav-title">
                                    {% if aluno_ensino %}
                                        {% if aluno_ensino.tipo_aluno == 'BOMBEIRO' and aluno_ensino.militar %}
                                            {{ aluno_ensino.militar.get_posto_graduacao_display }} {{ aluno_ensino.militar.nome_completo }}
                                        {% elif aluno_ensino.tipo_aluno == 'OUTRA_FORCA' and aluno_ensino.nome_outra_forca %}
                                            {{ aluno_ensino.nome_outra_forca }}
                                        {% elif aluno_ensino.tipo_aluno == 'CIVIL' and aluno_ensino.nome_civil %}
                                            {{ aluno_ensino.nome_civil }}
                                        {% else %}
                                            {{ aluno_ensino.get_nome_completo|default:user.username }}
                                        {% endif %}
                                    {% elif user.militar %}
                                        {{ user.militar.get_posto_graduacao_display }} {{ user.militar.nome_guerra }}
                                    {% else %}
                                        {{ user.username }}
                                    {% endif %}
                                </div>
                                <div class="nav-subtitle">
                                    <i class="fas fa-clock me-1"></i>
                                    <span>Sessão Ativa</span>
                                </div>
                            </div>
                        </a>
                        <ul class="dropdown-menu modern-dropdown dropdown-menu-end">
                            {% if funcao_atual %}
                            <li class="dropdown-header">
                                <i class="fas fa-user-tag me-2"></i>Função Atual
                            </li>
                            <li class="px-3 py-2">
                                <div class="fw-bold text-primary" style="white-space: normal; word-wrap: break-word;">{{ funcao_atual.funcao_militar.nome }}</div>
                                <small class="text-muted">{{ funcao_atual.lotacao.nome }}</small>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            {% if aluno_ensino or user.militar and menu_permissions.show_ensino_instrutores %}
                            <li class="dropdown-header">
                                <i class="fas fa-graduation-cap me-2"></i>Ensino
                            </li>
                            {% if aluno_ensino %}
                            <li class="px-3 py-2">
                                <div class="fw-bold" style="white-space: normal; word-wrap: break-word;">
                                    Aluno:
                                    {% if aluno_ensino.tipo_aluno == 'BOMBEIRO' and aluno_ensino.militar %}
                                        {{ aluno_ensino.militar.get_posto_graduacao_display }} {{ aluno_ensino.militar.nome_completo }}
                                    {% elif aluno_ensino.tipo_aluno == 'OUTRA_FORCA' and aluno_ensino.nome_outra_forca %}
                                        {{ aluno_ensino.nome_outra_forca }}
                                    {% elif aluno_ensino.tipo_aluno == 'CIVIL' and aluno_ensino.nome_civil %}
                                        {{ aluno_ensino.nome_civil }}
                                    {% else %}
                                        {{ aluno_ensino.get_nome_completo|default:user.username }}
                                    {% endif %}
                                </div>
                            </li>
                            {% endif %}
                            {% if user.militar and menu_permissions.show_ensino_instrutores %}
                            <li class="px-3 py-2">
                                <div class="fw-bold" style="white-space: normal; word-wrap: break-word;">
                                    Instrutor:
                                    {{ user.militar.get_posto_graduacao_display }} {{ user.militar.nome_completo }}
                                </div>
                            </li>
                            {% endif %}
                            <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            {% endif %}
                            
                            {% if menu_permissions.show_administracao %}
                            <li>
                                <a class="dropdown-item modern-dropdown-item" href="{% url 'admin:index' %}">
                                    <i class="fas fa-cog me-2"></i>Administração
                                </a>
                            </li>
                            {% endif %}
                            
                            <li>
                                {% if request.session.ensino_tipo and request.session.ensino_id %}
                                <a class="dropdown-item modern-dropdown-item" href="{% url 'militares:ensino_alterar_senha' %}">
                                    <i class="fas fa-key me-2"></i>Alterar Senha
                                </a>
                                {% else %}
                                <a class="dropdown-item modern-dropdown-item" href="{% url 'militares:alterar_senha' %}">
                                    <i class="fas fa-key me-2"></i>Alterar Senha
                                </a>
                                {% endif %}
                            </li>
                            
                            <li><hr class="dropdown-divider"></li>
                            
                            <li>
                                <a class="dropdown-item modern-dropdown-item text-danger" href="{% url 'logout' %}">
                                    <i class="fas fa-sign-out-alt me-2"></i>Sair
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Botão Toggle para Sidebar em Mobile -->
    <button class="sidebar-toggle-btn" id="sidebarToggle" type="button" aria-label="Toggle sidebar">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Overlay para fechar sidebar em mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Modal de Alertas de Sessões da Comissão -->
    {% if sessoes_alertas.tem_alertas %}
        <div class="modal fade" id="sessaoAlertModal" tabindex="-1" aria-labelledby="sessaoAlertModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="sessaoAlertModalLabel">
                            <i class="fas fa-bell me-2"></i>
                            Notificações de Sessões da Comissão
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% if sessoes_alertas.em_andamento %}
                            <div class="alert alert-warning border-0 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-play-circle fa-2x me-3 text-warning"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-2"><strong>Sessão em Andamento!</strong></h6>
                                        {% for sessao in sessoes_alertas.emandamento %}
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span><strong>{{ sessao.comissao.nome }}</strong> - {{ sessao.data|date:"d/m/Y H:i" }}</span>
                                                <a href="{% url 'militares:sessao_comissao_detail' sessao.id %}" class="btn btn-sm btn-warning">
                                                    <i class="fas fa-eye me-1"></i>Ver
                                                </a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if sessoes_alertas.hoje %}
                            <div class="alert alert-info border-0 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-calendar-day fa-2x me-3 text-info"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-2"><strong>Sessões de Hoje</strong></h6>
                                        {% for sessao in sessoes_alertas.hoje %}
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span><strong>{{ sessao.comissao.nome }}</strong> - {{ sessao.data|date:"d/m/Y H:i" }}</span>
                                                <a href="{% url 'militares:sessao_comissao_detail' sessao.id %}" class="btn btn-sm btn-info">
                                                    <i class="fas fa-eye me-1"></i>Ver
                                                </a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if sessoes_alertas.proximas %}
                            <div class="alert alert-success border-0">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-calendar-week fa-2x me-3 text-success"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-2"><strong>Próximas Sessões</strong></h6>
                                        {% for sessao in sessoes_alertas.proximas %}
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span><strong>{{ sessao.comissao.nome }}</strong> - {{ sessao.data|date:"d/m/Y H:i" }}</span>
                                                <a href="{% url 'militares:sessao_comissao_detail' sessao.id %}" class="btn btn-sm btn-success">
                                                    <i class="fas fa-eye me-1"></i>Ver
                                                </a>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <a href="{% url 'militares:comissao_list' %}" class="btn btn-primary">
                            <i class="fas fa-list me-1"></i>Ver Todas as Comissões
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Modal de Alertas de Revisões Próximas -->
    {% if total_alertas_revisao > 0 %}
        <div class="modal fade" id="revisaoAlertModal" tabindex="-1" aria-labelledby="revisaoAlertModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title" id="revisaoAlertModalLabel">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Alertas de Revisão de Viaturas
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="mb-3">
                            <strong>Atenção!</strong> As seguintes viaturas estão próximas da revisão (faltando 100km ou menos):
                        </p>
                        {% for alerta in alertas_revisao %}
                            <div class="alert alert-{% if alerta.urgente %}danger{% elif alerta.critico %}warning{% else %}info{% endif %} border-0 mb-3">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-{% if alerta.urgente %}exclamation-circle{% elif alerta.critico %}exclamation-triangle{% else %}info-circle{% endif %} fa-2x me-3"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-2">
                                            <strong>
                                                {{ alerta.viatura.placa }}
                                                {% if alerta.viatura.prefixo %}
                                                    ({{ alerta.viatura.prefixo }})
                                                {% endif %}
                                            </strong>
                                        </h6>
                                        <div class="mb-2">
                                            <strong>KM Atual:</strong> {{ alerta.km_atual|floatformat:0 }} km<br>
                                            <strong>KM Próxima Revisão:</strong> {{ alerta.km_proximo_revisao|floatformat:0 }} km<br>
                                            <strong>KM Restantes:</strong> 
                                            <span class="badge bg-{% if alerta.urgente %}danger{% elif alerta.critico %}warning{% else %}info{% endif %}">
                                                {% if alerta.km_restantes <= 0 %}
                                                    JÁ PASSOU ({{ alerta.km_restantes|floatformat:0 }} km)
                                                {% else %}
                                                    Faltam {{ alerta.km_restantes|floatformat:0 }} km
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div class="mt-2">
                                            <a href="{% url 'militares:viatura_detail' alerta.viatura.pk %}" class="btn btn-sm btn-outline-primary me-2">
                                                <i class="fas fa-eye me-1"></i>Ver Viatura
                                            </a>
                                            <a href="{% url 'militares:manutencao_create' %}?viatura={{ alerta.viatura.pk }}" class="btn btn-sm btn-primary">
                                                <i class="fas fa-wrench me-1"></i>Registrar Manutenção
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                        <a href="{% url 'militares:manutencao_list' %}" class="btn btn-primary">
                            <i class="fas fa-list me-1"></i>Ver Todas as Manutenções
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}


    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse" id="mainSidebar">
                <div class="position-sticky pt-3">
                    <!-- Logo SysgaBom -->
                    <div class="text-center mb-4 px-3">
                        <div id="sidebar-logo-container" class="sidebar-logo-container">
                            <img src="{% load static %}{% static 'sysgabomlogo.png' %}" 
                                 alt="SysgaBom Logo" 
                                 style="height: 80px; width: auto;"
                                 class="mb-2">
                        </div>
                        <div class="text-white">
                            <small class="text-white-50">Sistema de Gerenciamento Administrativo</small>
                        </div>
                    </div>
                    
                    <ul class="nav flex-column">
                        <!-- Link Home - Primeiro item do menu -->
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" 
                               href="{% url 'militares:home' %}"
                               style="background: linear-gradient(135deg, #007bff, #0056b3); border-radius: 12px; margin: 0 8px 15px 8px; box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3); border: 2px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease;"
                               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0, 123, 255, 0.4)';"
                               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0, 123, 255, 0.3)';">
                                <i class="fas fa-home me-2"></i>
                                <span style="font-weight: 600;">Início</span>
                            </a>
                        </li>
                        
                        {% if user.militar %}
                        <!-- Separador visual antes da seção Minhas Informações -->
                        <li class="nav-item">
                            <div class="mx-3 my-3" style="border-top: 3px solid #20b2aa; border-radius: 2px; position: relative;">
                                <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #20b2aa; color: white; padding: 2px 12px; border-radius: 12px; font-size: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">
                                    PESSOAL
                                </div>
                            </div>
                        </li>
                        
                        <!-- Seção Minhas Informações com estilo diferenciado - PRIMEIRA OPÇÃO -->
                        <li class="nav-item">
                            <div class="px-3 py-2 mt-2 mb-2" style="background: linear-gradient(135deg, #20b2aa, #48d1cc); border-radius: 12px; margin: 0 8px; box-shadow: 0 6px 12px rgba(32, 178, 170, 0.4); border: 2px solid rgba(255, 255, 255, 0.2);">
                                <h6 class="mb-0 text-white fw-bold d-flex align-items-center">
                                    <i class="fas fa-user-circle me-2"></i>
                                    Minhas Informações
                                </h6>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'militar_detail' or request.resolver_match.url_name == 'militar_detail_pessoal' %}active{% endif %}" 
                               href="{% url 'militares:militar_detail_pessoal' %}"
                               style="background-color: rgba(32, 178, 170, 0.1); border-left: 4px solid #20b2aa; margin: 3px 8px; border-radius: 8px; transition: all 0.3s ease;"
                               onmouseover="this.style.backgroundColor='rgba(32, 178, 170, 0.2)'; this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 8px rgba(32, 178, 170, 0.3)';"
                               onmouseout="this.style.backgroundColor='rgba(32, 178, 170, 0.1)'; this.style.transform='translateX(0)'; this.style.boxShadow='none';">
                                <i class="fas fa-user me-2" style="color: #20b2aa;"></i>
                                <span style="color: #20b2aa; font-weight: 600;">Minha Ficha de Cadastro</span>
                            </a>
                        </li>
                        {% if user.militar.is_oficial %}
                        <li class="nav-item">
                            {% if user.militar.fichaconceitooficiais_set.exists %}
                                <a class="nav-link" href="{% url 'militares:ficha_conceito_detail' user.militar.fichaconceitooficiais_set.first.pk %}"
                                   style="background-color: rgba(32, 178, 170, 0.1); border-left: 4px solid #20b2aa; margin: 3px 8px; border-radius: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.backgroundColor='rgba(32, 178, 170, 0.2)'; this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 8px rgba(32, 178, 170, 0.3)';"
                                   onmouseout="this.style.backgroundColor='rgba(32, 178, 170, 0.1)'; this.style.transform='translateX(0)'; this.style.boxShadow='none';">
                                    <i class="fas fa-clipboard-list me-2" style="color: #20b2aa;"></i>
                                    <span style="color: #20b2aa; font-weight: 600;">Minha Ficha de Conceito (Oficial)</span>
                                </a>
                            {% else %}
                                <a class="nav-link" href="{% url 'militares:ficha_conceito_create' %}?militar={{ user.militar.pk }}"
                                   style="background-color: rgba(32, 178, 170, 0.1); border-left: 4px solid #20b2aa; margin: 3px 8px; border-radius: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.backgroundColor='rgba(32, 178, 170, 0.2)'; this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 8px rgba(32, 178, 170, 0.3)';"
                                   onmouseout="this.style.backgroundColor='rgba(32, 178, 170, 0.1)'; this.style.transform='translateX(0)'; this.style.boxShadow='none';">
                                    <i class="fas fa-clipboard-list me-2" style="color: #20b2aa;"></i>
                                    <span style="color: #20b2aa; font-weight: 600;">Criar Ficha de Conceito (Oficial)</span>
                                </a>
                            {% endif %}
                        </li>
                        {% else %}
                        <li class="nav-item">
                            {% if user.militar.fichaconceitopracas_set.exists %}
                                <a class="nav-link" href="{% url 'militares:ficha_conceito_pracas_detail' user.militar.fichaconceitopracas_set.first.pk %}"
                                   style="background-color: rgba(32, 178, 170, 0.1); border-left: 4px solid #20b2aa; margin: 3px 8px; border-radius: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.backgroundColor='rgba(32, 178, 170, 0.2)'; this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 8px rgba(32, 178, 170, 0.3)';"
                                   onmouseout="this.style.backgroundColor='rgba(32, 178, 170, 0.1)'; this.style.transform='translateX(0)'; this.style.boxShadow='none';">
                                    <i class="fas fa-clipboard-list me-2" style="color: #20b2aa;"></i>
                                    <span style="color: #20b2aa; font-weight: 600;">Minha Ficha de Conceito (Praça)</span>
                                </a>
                            {% else %}
                                <a class="nav-link" href="{% url 'militares:ficha_conceito_pracas_form' user.militar.pk %}"
                                   style="background-color: rgba(32, 178, 170, 0.1); border-left: 4px solid #20b2aa; margin: 3px 8px; border-radius: 8px; transition: all 0.3s ease;"
                                   onmouseover="this.style.backgroundColor='rgba(32, 178, 170, 0.2)'; this.style.transform='translateX(4px)'; this.style.boxShadow='0 4px 8px rgba(32, 178, 170, 0.3)';"
                                   onmouseout="this.style.backgroundColor='rgba(32, 178, 170, 0.1)'; this.style.transform='translateX(0)'; this.style.boxShadow='none';">
                                    <i class="fas fa-clipboard-list me-2" style="color: #20b2aa;"></i>
                                    <span style="color: #20b2aa; font-weight: 600;">Criar Ficha de Conceito (Praça)</span>
                                </a>
                            {% endif %}
                        </li>
                        {% endif %}
                        
                        <!-- Separador visual após a seção Minhas Informações -->
                        <li class="nav-item">
                            <div class="mx-3 my-3" style="border-top: 2px solid #e9ecef; border-radius: 1px;"></div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_dashboard %}
                        <li class="nav-item">
                            <a class="nav-link {% if request.resolver_match.url_name == 'militar_dashboard' %}active{% endif %}" 
                               href="{% url 'militares:militar_dashboard' %}">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Dashboard
                            </a>
                        </li>
                        {% endif %}
                        
                        
                        {% if menu_permissions.show_efetivo or menu_permissions.show_ativos or menu_permissions.show_inativos or menu_permissions.show_lotacoes or menu_permissions.show_averbacoes %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#efetivoSubmenu" 
                               aria-expanded="{% if 'militar_list' in request.path or 'nvrr_list' in request.path or 'militar_inativo_list' in request.path or 'lotacao' in request.path or 'averbacao' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-users me-2"></i>
                                Efetivo
                            </a>
                            <div class="collapse {% if 'militar_list' in request.path or 'nvrr_list' in request.path or 'militar_inativo_list' in request.path or 'lotacao' in request.path or 'averbacao' in request.path %}show{% endif %}" id="efetivoSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_ativos %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'militar_list' %}active{% endif %}"
                                           href="{% url 'militares:militar_list' %}">
                                            <i class="fas fa-user-check me-2"></i>
                                            Ativos
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ativos %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'nvrr_list' %}active{% endif %}"
                                           href="{% url 'militares:nvrr_list' %}">
                                            <i class="fas fa-user-slash me-2"></i>
                                            NVRR
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_inativos %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'militar_inativo_list' %}active{% endif %}" 
                                           href="{% url 'militares:militar_inativo_list' %}">
                                            <i class="fas fa-user-times me-2"></i>
                                            Inativos
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_lotacoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'lotacao_list' %}active{% endif %}" 
                                           href="{% url 'militares:lotacao_list' %}">
                                            <i class="fas fa-building me-2"></i>
                                            Lotações
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_averbacoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'averbacao_list' %}active{% endif %}" 
                                           href="{% url 'militares:averbacao_list' %}">
                                            <i class="fas fa-file-signature me-2"></i>
                                            Averbações
                                        </a>
                                    </li>
                                    {% endif %}

                                </ul>
                            </div>
                        </li>
                        {% endif %}

                        {% if menu_permissions.show_elogios %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'elogios' in request.path %}active{% endif %}" href="{% url 'militares:elogio_list' %}">
                                <i class="fas fa-trophy me-2"></i>
                                Elogios
                            </a>
                        </li>
                        {% endif %}

                        {% if menu_permissions.show_punicoes %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'punicoes' in request.path %}active{% endif %}" href="{% url 'militares:punicao_list' %}">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Punições
                            </a>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_afastamentos or menu_permissions.show_ferias or menu_permissions.BOTAO_PLANO_LICENCA_ESPECIAL_VISUALIZAR or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'afastamento' in request.path or 'ferias' in request.path or 'planos-licencas-especiais' in request.path or 'licenca-especial' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#afastamentosSubmenu"
                               aria-expanded="{% if 'afastamento' in request.path or 'ferias' in request.path or 'planos-licencas-especiais' in request.path or 'licenca-especial' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-ban me-2"></i>
                                Afastamentos
                            </a>
                            <div class="collapse {% if 'afastamento' in request.path or 'ferias' in request.path or 'planos-licencas-especiais' in request.path or 'licenca-especial' in request.path %}show{% endif %}" id="afastamentosSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_ferias or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ferias' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ferias_list' %}">
                                            <i class="fas fa-umbrella-beach me-2"></i>
                                            Férias
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.BOTAO_PLANO_LICENCA_ESPECIAL_VISUALIZAR or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'planos-licencas-especiais' in request.path or 'licenca-especial' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:plano_licenca_especial_list' %}">
                                            <i class="fas fa-certificate me-2"></i>
                                            Licença Especial
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_afastamentos or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'afastamento' in request.path and 'ferias' not in request.path and 'planos-licencas-especiais' not in request.path and 'licenca-especial' not in request.path %}active{% endif %}" 
                                           href="{% url 'militares:afastamento_list' %}">
                                            <i class="fas fa-ban me-2"></i>
                                            Outros
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_viaturas or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'viatura' in request.path or 'viaturas' in request.path or 'abastecimento' in request.path or 'abastecimentos' in request.path or 'manutencao' in request.path or 'manutencoes' in request.path or 'troca' in request.path or 'trocas-oleo' in request.path or 'licenciamento' in request.path or 'licenciamentos' in request.path or 'rodagem' in request.path or 'rodagens' in request.path or 'painel-guarda' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#frotaSubmenu"
                               aria-expanded="{% if 'viatura' in request.path or 'viaturas' in request.path or 'abastecimento' in request.path or 'abastecimentos' in request.path or 'manutencao' in request.path or 'manutencoes' in request.path or 'troca' in request.path or 'trocas-oleo' in request.path or 'licenciamento' in request.path or 'licenciamentos' in request.path or 'rodagem' in request.path or 'rodagens' in request.path or 'painel-guarda' in request.path %}true{% else %}false{% endif %}">
                                <span style="position: relative;">
                                    <i class="fas fa-truck me-2"></i>
                                    Frota
                                    {% if total_alertas_revisao > 0 or total_alertas_licenciamento > 0 %}
                                        {% with total_alerts=total_alertas_revisao|add:total_alertas_licenciamento %}
                                        <span class="badge bg-danger ms-2" style="font-size: 0.65rem;">{{ total_alerts }}</span>
                                        {% endwith %}
                                    {% endif %}
                                </span>
                            </a>
                            <div class="collapse {% if 'viatura' in request.path or 'viaturas' in request.path or 'abastecimento' in request.path or 'abastecimentos' in request.path or 'manutencao' in request.path or 'manutencoes' in request.path or 'troca' in request.path or 'trocas-oleo' in request.path or 'licenciamento' in request.path or 'licenciamentos' in request.path or 'rodagem' in request.path or 'rodagens' in request.path or 'painel-guarda' in request.path %}show{% endif %}" id="frotaSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_viaturas_submenu or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'viatura_list' or 'viatura' in request.path and 'abastecimento' not in request.path and 'manutencao' not in request.path and 'troca' not in request.path and 'licenciamento' not in request.path and 'rodagem' not in request.path %}active{% endif %}" 
                                           href="{% url 'militares:viatura_list' %}">
                                            <i class="fas fa-car me-2"></i>
                                            Viaturas
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_controle_combustivel or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'abastecimento' in request.path or 'abastecimentos' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:abastecimento_list' %}">
                                            <i class="fas fa-gas-pump me-2"></i>
                                            Controle de Combustível
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_manutencoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'manutencao' in request.path or 'manutencoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:manutencao_list' %}">
                                            <i class="fas fa-wrench me-2"></i>
                                            Manutenções
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_trocas_oleo or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'troca' in request.path or 'trocas-oleo' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:troca_oleo_list' %}">
                                            <i class="fas fa-oil-can me-2"></i>
                                            Trocas de Óleo
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_licenciamentos or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'licenciamento' in request.path or 'licenciamentos' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:licenciamento_list' %}">
                                            <i class="fas fa-id-card me-2"></i>
                                            Licenciamentos
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_rodagens or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'rodagem' in request.path or 'rodagens' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:rodagem_list' %}">
                                            <i class="fas fa-route me-2"></i>
                                            Rodagens
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_painel_guarda or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'painel-guarda' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:painel_guarda' %}">
                                            <i class="fas fa-tachometer-alt me-2"></i>
                                            Painel de Guarda
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                                
                                {% if total_alertas_revisao > 0 or total_alertas_licenciamento > 0 %}
                                <!-- Alertas de Frota -->
                                <div class="mt-2 px-3">
                                    {% if total_alertas_revisao > 0 %}
                                    <!-- Alerta de Revisões Próximas -->
                                    {% with primeiro_alerta=alertas_revisao|first %}
                                    <div class="alert alert-{% if primeiro_alerta.urgente %}danger{% elif primeiro_alerta.critico %}warning{% else %}info{% endif %} mb-2 py-2" style="font-size: 0.85rem;">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Revisão!</strong> 
                                        <a href="#" data-bs-toggle="modal" data-bs-target="#revisaoAlertModal" class="alert-link text-decoration-none">
                                            {{ total_alertas_revisao }} viatura{{ total_alertas_revisao|pluralize }} próxima{{ total_alertas_revisao|pluralize }} da revisão
                                        </a>
                                    </div>
                                    {% endwith %}
                                    {% endif %}
                                    
                                    {% if total_alertas_licenciamento > 0 %}
                                    <!-- Alerta de Licenciamentos Próximos -->
                                    {% with primeiro_licenciamento=alertas_licenciamento|first %}
                                    <div class="alert alert-{% if primeiro_licenciamento.urgente %}danger{% elif primeiro_licenciamento.critico %}warning{% elif primeiro_licenciamento.atencao_media %}warning{% else %}info{% endif %} mb-2 py-2" style="font-size: 0.85rem;">
                                        <i class="fas fa-id-card me-2"></i>
                                        <strong>Licenciamento!</strong> 
                                        <a href="{% url 'militares:licenciamento_list' %}" class="alert-link text-decoration-none">
                                            {{ total_alertas_licenciamento }} licenciamento{{ total_alertas_licenciamento|pluralize }} próximo{{ total_alertas_licenciamento|pluralize }} do vencimento
                                        </a>
                                    </div>
                                    {% endwith %}
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_equipamentos_operacionais or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'equipamento' in request.path or 'equipamentos-operacionais' in request.path or 'tempo-uso' in request.path or 'tempos-uso' in request.path or 'equipamento-abastecimento' in request.path or 'equipamento-manutencao' in request.path or 'equipamento-troca-oleo' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#equipamentosOperacionaisSubmenu"
                               aria-expanded="{% if 'equipamento' in request.path or 'equipamentos-operacionais' in request.path or 'tempo-uso' in request.path or 'tempos-uso' in request.path or 'equipamento-abastecimento' in request.path or 'equipamento-manutencao' in request.path or 'equipamento-troca-oleo' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-hard-hat me-2"></i>
                                Equipamentos Operacionais
                            </a>
                            <div class="collapse {% if 'equipamento' in request.path or 'equipamentos-operacionais' in request.path or 'tempo-uso' in request.path or 'tempos-uso' in request.path or 'equipamento-abastecimento' in request.path or 'equipamento-manutencao' in request.path or 'equipamento-troca-oleo' in request.path %}show{% endif %}" id="equipamentosOperacionaisSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_equipamentos_operacionais or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'equipamento_operacional_list' or 'equipamentos-operacionais' in request.path and 'tempo-uso' not in request.path and 'tempos-uso' not in request.path and 'abastecimento' not in request.path and 'manutencao' not in request.path and 'troca-oleo' not in request.path %}active{% endif %}" 
                                           href="{% url 'militares:equipamento_operacional_list' %}">
                                            <i class="fas fa-cog me-2"></i>
                                            Equipamentos
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_equipamentos_operacionais_combustivel or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'equipamento-abastecimento' in request.path or 'equipamentos-abastecimentos' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:equipamento_abastecimento_list' %}">
                                            <i class="fas fa-gas-pump me-2"></i>
                                            Controle de Combustível
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_equipamentos_operacionais_manutencoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'equipamento-manutencao' in request.path or 'equipamentos-manutencoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:equipamento_manutencao_list' %}">
                                            <i class="fas fa-wrench me-2"></i>
                                            Manutenções
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_equipamentos_operacionais_trocas_oleo or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'equipamento-troca-oleo' in request.path or 'equipamentos-trocas-oleo' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:equipamento_troca_oleo_list' %}">
                                            <i class="fas fa-oil-can me-2"></i>
                                            Trocas de Óleo
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_equipamentos_operacionais_tempos_uso or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'tempo-uso' in request.path or 'tempos-uso' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:equipamento_operacional_list' %}">
                                            <i class="fas fa-clock me-2"></i>
                                            Controle de Uso por Horas
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo Material Bélico -->
                        {% if menu_permissions.show_material_belico or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'arma' in request.path or 'armas' in request.path or 'material-belico' in request.path or 'movimentacao' in request.path or 'cautelas-armas' in request.path or 'municoes' in request.path or 'cautelas-municoes' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#materialBelicoSubmenu"
                               aria-expanded="{% if 'arma' in request.path or 'armas' in request.path or 'material-belico' in request.path or 'movimentacao' in request.path or 'cautelas-armas' in request.path or 'municoes' in request.path or 'cautelas-municoes' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-gun me-2"></i>
                                Material Bélico
                            </a>
                            <div class="collapse {% if 'arma' in request.path or 'armas' in request.path or 'material-belico' in request.path or 'movimentacao' in request.path or 'cautelas-armas' in request.path or 'municoes' in request.path or 'cautelas-municoes' in request.path %}show{% endif %}" id="materialBelicoSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_armas_instituicao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'arma_list' or 'armas' in request.path and 'particulares' not in request.path %}active{% endif %}" 
                                           href="{% url 'militares:arma_list' %}">
                                            <i class="fas fa-shield-alt me-2"></i>
                                            Armas da Instituição
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_armas_particulares or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'arma_particular_list' or 'armas-particulares' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:arma_particular_list' %}">
                                            <i class="fas fa-user-shield me-2"></i>
                                            Armas Particulares
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_cautelas_armas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'cautela_arma_list' or 'cautelas-armas' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:cautela_arma_list' %}">
                                            <i class="fas fa-shield-alt me-2"></i>
                                            Cautelas de Armas
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_controle_movimentacoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'movimentacao_arma_list' or 'movimentacoes-armas' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:movimentacao_arma_list' %}">
                                            <i class="fas fa-exchange-alt me-2"></i>
                                            Controle de Movimentações
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_controle_municao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'municao_list' or 'municoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:municao_list' %}">
                                            <i class="fas fa-boxes me-2"></i>
                                            Controle de Munição
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_cautelas_municoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'cautela_municao_list' or 'cautelas-municoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:cautela_municao_list' %}">
                                            <i class="fas fa-shield-alt me-2"></i>
                                            Cautelas de Munição
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo Bens Móveis -->
                        {% if menu_permissions.show_bens_moveis or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'bens-moveis' in request.path or 'tombamento' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#bensMoveisSubmenu"
                               aria-expanded="{% if 'bens-moveis' in request.path or 'tombamento' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-box me-2"></i>
                                Bens Móveis
                            </a>
                            <div class="collapse {% if 'bens-moveis' in request.path or 'tombamento' in request.path %}show{% endif %}" id="bensMoveisSubmenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'bem_movel_list' %}active{% endif %}" 
                                           href="{% url 'militares:bem_movel_list' %}">
                                            <i class="fas fa-cube me-2"></i>
                                            Bens Móveis
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'tombamento_list' %}active{% endif %}" 
                                           href="{% url 'militares:tombamento_list' %}">
                                            <i class="fas fa-clipboard-list me-2"></i>
                                            Tombamentos
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo Almoxarifado -->
                        {% if menu_permissions.show_almoxarifado or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'almoxarifado' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#almoxarifadoSubmenu"
                               aria-expanded="{% if 'almoxarifado' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-warehouse me-2"></i>
                                Almoxarifado
                            </a>
                            <div class="collapse {% if 'almoxarifado' in request.path %}show{% endif %}" id="almoxarifadoSubmenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'produto_almoxarifado_list' %}active{% endif %}" 
                                           href="{% url 'militares:produto_almoxarifado_list' %}">
                                            <i class="fas fa-boxes me-2"></i>
                                            Itens
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'entrada_almoxarifado_list' %}active{% endif %}" 
                                           href="{% url 'militares:entrada_almoxarifado_list' %}">
                                            <i class="fas fa-arrow-down me-2"></i>
                                            Entradas
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'saida_almoxarifado_list' %}active{% endif %}" 
                                           href="{% url 'militares:saida_almoxarifado_list' %}">
                                            <i class="fas fa-arrow-up me-2"></i>
                                            Saídas
                                        </a>
                                    </li>
                                    {% if menu_permissions.show_almoxarifado_requisicoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'requisicao_almoxarifado_list' %}active{% endif %}" 
                                           href="{% url 'militares:requisicao_almoxarifado_list' %}">
                                            <i class="fas fa-hand-holding me-2"></i>
                                            Requisições
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo Processos Administrativos -->
                        {% if menu_permissions.show_processos or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'processos' in request.path %}active{% endif %}" 
                               href="{% url 'militares:processo_administrativo_list' %}">
                                <i class="fas fa-folder-open me-2"></i>
                                Processos Administrativos
                            </a>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo de Ensino -->
                        {% if menu_permissions.show_ensino or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle {% if 'ensino' in request.path %}active{% endif %}" 
                               href="#" 
                               data-bs-toggle="collapse" 
                               data-bs-target="#ensinoSubmenu"
                               aria-expanded="{% if 'ensino' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-graduation-cap me-2"></i>
                                Ensino
                            </a>
                            <div class="collapse {% if 'ensino' in request.path %}show{% endif %}" id="ensinoSubmenu">
                                <ul class="nav flex-column ms-3">
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'ensino_dashboard' %}active{% endif %}" 
                                           href="{% url 'militares:ensino_dashboard' %}">
                                            <i class="fas fa-chart-line me-2"></i>
                                            Dashboard
                                        </a>
                                    </li>
                                    
                                    {% if menu_permissions.show_ensino_alunos or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/alunos' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_alunos_listar' %}">
                                            <i class="fas fa-user-graduate me-2"></i>
                                            Alunos
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_instrutores or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/instrutores' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_instrutores_listar' %}">
                                            <i class="fas fa-chalkboard-teacher me-2"></i>
                                            Instrutores
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_monitores or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/monitores' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_monitores_listar' %}">
                                            <i class="fas fa-user-tie me-2"></i>
                                            Monitores
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_cursos or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/cursos' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_cursos_listar' %}">
                                            <i class="fas fa-book me-2"></i>
                                            Cursos
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.ENSINO_CRIAR or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/edicoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_edicoes_listar' %}">
                                            <i class="fas fa-calendar-alt me-2"></i>
                                            Edições de Curso
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_turmas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/turmas' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_turmas_listar' %}">
                                            <i class="fas fa-users me-2"></i>
                                            Turmas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_disciplinas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/disciplinas' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_disciplinas_listar' %}">
                                            <i class="fas fa-book-open me-2"></i>
                                            Disciplinas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_aulas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/aulas' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_aulas_listar' %}">
                                            <i class="fas fa-chalkboard me-2"></i>
                                            Aulas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_quadros_trabalho_semanal or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/quadros-trabalho-semanal' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_quadros_trabalho_semanal_listar' %}">
                                            <i class="fas fa-calendar-week me-2"></i>
                                            Quadro de Trabalho Semanal
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.ENSINO_EDITAR or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/usuarios' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_usuarios_listar' %}">
                                            <i class="fas fa-users-cog me-2"></i>
                                            Controle de Usuários
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_avaliacoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/avaliacoes' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_avaliacoes_listar' %}">
                                            <i class="fas fa-clipboard-check me-2"></i>
                                            Avaliações
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_ensino_certificados or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'ensino/certificados' in request.path %}active{% endif %}" 
                                           href="{% url 'militares:ensino_certificados_listar' %}">
                                            <i class="fas fa-certificate me-2"></i>
                                            Certificados
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_publicacoes or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#publicacoesSubmenu" 
                               aria-expanded="{% if 'publicacoes' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-newspaper me-2"></i>
                                Publicações
                            </a>
                            <div class="collapse {% if 'publicacoes' in request.path %}show{% endif %}" id="publicacoesSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_notas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'notas_list' %}active{% endif %}" 
                                           href="{% url 'militares:notas_list' %}">
                                            <i class="fas fa-file-alt me-2"></i>
                                            Notas
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_boletins_ostensivos or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'boletins_ostensivos_list' %}active{% endif %}" 
                                           href="{% url 'militares:boletins_ostensivos_list' %}">
                                            <i class="fas fa-bullhorn me-2"></i>
                                            Boletins Ostensivos
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_boletins_reservados or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'boletins_reservados_list' %}active{% endif %}" 
                                           href="{% url 'militares:boletins_reservados_list' %}">
                                            <i class="fas fa-lock me-2"></i>
                                            Boletins Reservados
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_boletins_especiais or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'boletins_especiais_list' %}active{% endif %}" 
                                           href="{% url 'militares:boletins_especiais_list' %}">
                                            <i class="fas fa-star me-2"></i>
                                            Boletins Especiais
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        
                        <!-- Módulo Escalas -->
                        {% if menu_permissions.show_escalas or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#escalasSubmenu" 
                               aria-expanded="{% if 'escalas' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-calendar-alt me-2"></i>
                                Escalas
                            </a>
                            <div class="collapse {% if 'escalas' in request.path %}show{% endif %}" id="escalasSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_escalas_lista or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'escalas_list' %}active{% endif %}" 
                                           href="{% url 'militares:escalas_list' %}">
                                            <i class="fas fa-list me-2"></i>
                                            Lista de Escalas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_escalas_configuracao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'escalas_configuracao' or request.resolver_match.url_name == 'escalas_abonar' %}active{% endif %}" 
                                           href="{% url 'militares:escalas_configuracao' %}"
                                           target="_blank">
                                            <i class="fas fa-calendar-check me-2"></i>
                                            Escala de Abonar
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_escalas_banco_horas or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'escalas_banco_horas' %}active{% endif %}" 
                                           href="{% url 'militares:escalas_banco_horas' %}">
                                            <i class="fas fa-clock me-2"></i>
                                            Banco de Horas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_escalas_operacoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'escalas_operacoes' %}active{% endif %}" 
                                           href="{% url 'militares:escalas_operacoes' %}">
                                            <i class="fas fa-tasks me-2"></i>
                                            Operações
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_escalas_operacoes or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'escalas_controle' %}active{% endif %}" 
                                           href="{% url 'militares:escalas_controle' %}">
                                            <i class="fas fa-chart-bar me-2"></i>
                                            Controle de Escalas
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        <!-- Módulo Planejadas -->
                        {% if menu_permissions.show_planejadas %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#planejadasSubmenu" 
                               aria-expanded="{% if 'planejadas' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-money-bill-wave me-2"></i>
                                Planejadas
                            </a>
                            <div class="collapse {% if 'planejadas' in request.path %}show{% endif %}" id="planejadasSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_operador_planejadas %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'planejadas_list' %}active{% endif %}" 
                                           href="{% url 'militares:planejadas_list' %}">
                                            <i class="fas fa-list me-2"></i>
                                            Operações Planejadas
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_fiscal_planejadas %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'orcamento_planejadas_list' %}active{% endif %}" 
                                           href="{% url 'militares:orcamento_planejadas_list' %}">
                                            <i class="fas fa-chart-pie me-2"></i>
                                            Orçamentos
                                        </a>
                                    </li>
                                    {% endif %}
                                    {% if menu_permissions.show_liquidacao %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'relatorio_mensal_liquidacao' %}active{% endif %}" 
                                           href="{% url 'militares:relatorio_mensal_liquidacao' %}">
                                            <i class="fas fa-file-invoice-dollar me-2"></i>
                                            Liquidação
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_secao_promocoes or menu_permissions.show_fichas_oficiais or menu_permissions.show_fichas_pracas or menu_permissions.show_calendarios or menu_permissions.show_quadros_fixacao or menu_permissions.show_quadros_acesso or menu_permissions.show_comissoes or menu_permissions.show_meus_votos or menu_permissions.show_promocoes or menu_permissions.show_almanaques %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#promocoesSubmenu" 
                               aria-expanded="{% if 'ficha_conceito' in request.path or 'calendario_promocao' in request.path or 'quadro_fixacao' in request.path or 'quadro_acesso' in request.path or 'comissao' in request.path or 'votos' in request.path or 'promocao' in request.path or 'almanaque' in request.path or 'secao-promocoes' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-arrow-up me-2"></i>
                                Seção de Promoções
                            </a>
                            <div class="collapse {% if 'ficha_conceito' in request.path or 'calendario_promocao' in request.path or 'quadro_fixacao' in request.path or 'quadro_acesso' in request.path or 'comissao' in request.path or 'votos' in request.path or 'promocao' in request.path or 'almanaque' in request.path or 'secao-promocoes' in request.path %}show{% endif %}" id="promocoesSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_fichas_oficiais %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'ficha_conceito_list' %}active{% endif %}" 
                                           href="{% url 'militares:ficha_conceito_list' %}">
                                            <i class="fas fa-clipboard-list me-2"></i>
                                            Fichas de Conceito (Oficiais)
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_fichas_pracas %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'ficha_conceito_pracas_list' %}active{% endif %}" 
                                           href="{% url 'militares:ficha_conceito_pracas_list' %}">
                                            <i class="fas fa-clipboard-list me-2"></i>
                                            Fichas de Conceito (Praças)
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_calendarios %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'calendario_promocao' in request.resolver_match.url_name %}active{% endif %}" 
                                           href="{% url 'militares:calendario_promocao_list' %}">
                                            <i class="fas fa-calendar-alt me-2"></i>
                                            Calendários de Promoções
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_quadros_fixacao %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'quadro_fixacao_vagas_list' %}active{% endif %}" 
                                           href="{% url 'militares:quadro_fixacao_vagas_list' %}">
                                            <i class="fas fa-clipboard-list me-2"></i>
                                            Quadros de Fixação de Vagas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_quadros_acesso %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'quadro_acesso_list' %}active{% endif %}" 
                                           href="{% url 'militares:quadro_acesso_list' %}">
                                            <i class="fas fa-table me-2"></i>
                                            Quadros de Acesso
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_comissoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'comissao_list' %}active{% endif %}" 
                                           href="{% url 'militares:comissao_list' %}">
                                            <i class="fas fa-users-cog me-2"></i>
                                            Comissões de Promoções
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    
                                    {% if menu_permissions.show_meus_votos %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'meus_votos_list' %}active{% endif %}" 
                                           href="{% url 'militares:meus_votos_list' %}">
                                            <i class="fas fa-vote-yea me-2"></i>
                                            Meus Votos
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_promocoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'promocao_list' %}active{% endif %}" 
                                           href="{% url 'militares:promocao_list' %}">
                                            <i class="fas fa-arrow-up me-2"></i>
                                            Promoções
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_almanaques %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'almanaque_list' %}active{% endif %}" 
                                           href="{% url 'militares:almanaque_list' %}">
                                            <i class="fas fa-book me-2"></i>
                                            Almanaques
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_medalhas %}
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#medalhasSubmenu" 
                               aria-expanded="{% if 'medalhas' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-medal me-2"></i>
                                Medalhas
                            </a>
                            <div class="collapse {% if 'medalhas' in request.path %}show{% endif %}" id="medalhasSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_medalhas_concessoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'concessoes_list' %}active{% endif %}" 
                                           href="{% url 'militares:concessoes_list' %}">
                                            <i class="fas fa-list me-2"></i>
                                            Concessões
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_medalhas_propostas %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'conceder_medalha_militar' %}active{% endif %}" 
                                           href="{% url 'militares:conceder_medalha_militar' %}">
                                            <i class="fas fa-plus me-2"></i>
                                            Conceder Medalha
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_elegiveis %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'elegiveis_tempo_servico' %}active{% endif %}" 
                                           href="{% url 'militares:elegiveis_tempo_servico' %}">
                                            <i class="fas fa-users me-2"></i>
                                            Elegíveis
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_propostas %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'lista_propostas' %}active{% endif %}" 
                                           href="{% url 'militares:lista_propostas' %}">
                                            <i class="fas fa-file-alt me-2"></i>
                                            Propostas
                                        </a>
                                    </li>
                                    {% endif %}

                                </ul>
                            </div>
                        </li>
                        {% endif %}
                        
                        
                        {% if menu_permissions.show_intersticios or menu_permissions.show_gerenciar_intersticios or menu_permissions.show_gerenciar_previsao or menu_permissions.show_administracao or menu_permissions.show_usuarios or menu_permissions.show_permissoes or menu_permissions.show_logs or menu_permissions.show_titulos_publicacao or user.is_superuser %}
                        <li class="nav-item">
                            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span>Sistema</span>
                            </h6>
                        </li>
                        {% endif %}
                        
                        {% if menu_permissions.show_intersticios or menu_permissions.show_gerenciar_intersticios or menu_permissions.show_gerenciar_previsao or menu_permissions.show_administracao or menu_permissions.show_usuarios or menu_permissions.show_permissoes or menu_permissions.show_logs or menu_permissions.show_titulos_publicacao or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'configuracoes' in request.path and 'configuracao-planejadas' not in request.path and 'configuracoes-armas' not in request.path %}active{% endif %}" 
                               href="{% url 'militares:configuracoes_cartucheira' %}">
                                <i class="fas fa-cog me-2"></i>
                                Configurações
                            </a>
                        </li>
                        {% endif %}
                        
                        {% comment %}
                        <!-- Menu antigo de configurações (mantido para referência) -->
                        <li class="nav-item">
                            <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="collapse" data-bs-target="#configuracoesSubmenu" 
                               aria-expanded="{% if 'intersticio' in request.path or 'previsao' in request.path or 'usuarios' in request.path or 'cargo_funcao' in request.path or 'funcoes' in request.path or 'logs_sistema' in request.path or 'admin' in request.path or 'orgao' in request.path or 'organograma' in request.path or 'grandes-comandos' in request.path or 'unidades' in request.path or 'sub-unidades' in request.path or 'titulos-publicacao' in request.path or 'configuracao-planejadas' in request.path or 'configuracoes-armas' in request.path or 'almoxarifado/categorias' in request.path or 'almoxarifado/subcategorias/list' in request.path %}true{% else %}false{% endif %}">
                                <i class="fas fa-cog me-2"></i>
                                Configurações
                            </a>
                            <div class="collapse {% if 'intersticio' in request.path or 'previsao' in request.path or 'usuarios' in request.path or 'cargo_funcao' in request.path or 'funcoes' in request.path or 'logs_sistema' in request.path or 'admin' in request.path or 'orgao' in request.path or 'organograma' in request.path or 'grandes-comandos' in request.path or 'unidades' in request.path or 'sub-unidades' in request.path or 'titulos-publicacao' in request.path or 'configuracao-planejadas' in request.path or 'configuracoes-armas' in request.path or 'almoxarifado/categorias' in request.path or 'almoxarifado/subcategorias/list' in request.path %}show{% endif %}" id="configuracoesSubmenu">
                                <ul class="nav flex-column ms-3">
                                    {% if menu_permissions.show_intersticios %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'intersticio_list' %}active{% endif %}" href="{% url 'militares:intersticio_list' %}">
                                            <i class="fas fa-hourglass-half me-2"></i>
                                            Interstícios
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_gerenciar_intersticios %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'intersticio_manage' %}active{% endif %}" href="{% url 'militares:intersticio_manage' %}">
                                            <i class="fas fa-edit me-2"></i>
                                            Gerenciar Interstícios
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_gerenciar_previsao %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'previsao_vaga_manage' %}active{% endif %}" href="{% url 'militares:previsao_vaga_manage' %}">
                                            <i class="fas fa-edit me-2"></i>
                                            Gerenciar Previsão de Vagas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_usuarios or menu_permissions.show_administracao %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'orgao_list' %}active{% endif %}" href="{% url 'militares:orgao_list' %}">
                                            <i class="fas fa-building me-2"></i>
                                            Órgãos
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'organograma' %}active{% endif %}" href="{% url 'militares:organograma' %}">
                                            <i class="fas fa-sitemap me-2"></i>
                                            Organograma
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_usuarios %}
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'militares:usuarios_custom_list' %}">
                                            <i class="fas fa-users-cog me-2"></i>
                                            Gerenciar Usuários
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    
                                    {% if menu_permissions.show_permissoes %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'funcoes' in request.path %}active{% endif %}" href="{% url 'militares:funcoes_militares_list' %}">
                                            <i class="fas fa-user-tie me-2"></i>
                                            Funções Militares
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_logs %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'logs_sistema' in request.resolver_match.url_name %}active{% endif %}" 
                                           href="{% url 'militares:logs_sistema_list' %}">
                                            <i class="fas fa-file-alt me-2"></i>
                                            Logs do Sistema
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    
                                    {% if menu_permissions.show_administracao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'configuracao_planejadas_list' %}active{% endif %}" 
                                           href="{% url 'militares:configuracao_planejadas_list' %}">
                                            <i class="fas fa-calendar-check me-2"></i>
                                            Configuração de Planejadas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_titulos_publicacao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'titulos-publicacao' in request.path %}active{% endif %}" href="{% url 'militares:titulos_publicacao_list' %}">
                                            <i class="fas fa-file-alt me-2"></i>
                                            Títulos de Publicações
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_administracao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'configuracoes-armas' in request.path %}active{% endif %}" href="{% url 'militares:configuracao_arma_list' %}">
                                            <i class="fas fa-gun me-2"></i>
                                            Configurações de Armas
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    {% if menu_permissions.show_administracao or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'configuracoes-municoes' in request.path %}active{% endif %}" href="{% url 'militares:configuracao_municao_list' %}">
                                            <i class="fas fa-bullseye me-2"></i>
                                            Configurações de Munições
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    <!-- Configurações do Almoxarifado -->
                                    {% if menu_permissions.show_almoxarifado or user.is_superuser %}
                                    <li class="nav-item">
                                        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-3 mb-1 text-muted">
                                            <span>Almoxarifado</span>
                                        </h6>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'categoria_list' %}active{% endif %}" 
                                           href="{% url 'militares:categoria_list' %}">
                                            <i class="fas fa-tags me-2"></i>
                                            Categorias
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link {% if request.resolver_match.url_name == 'subcategoria_list' %}active{% endif %}" 
                                           href="{% url 'militares:subcategoria_list' %}">
                                            <i class="fas fa-tag me-2"></i>
                                            Subcategorias
                                        </a>
                                    </li>
                                    {% endif %}
                                    
                                    
                                    {% if menu_permissions.show_administracao %}
                                    <li class="nav-item">
                                        <a class="nav-link" href="{% url 'admin:index' %}">
                                            <i class="fas fa-cog me-2"></i>
                                            Administração
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endcomment %}
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-12 col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="pt-3 pb-2 mb-3">
                    <!-- Sistema de mensagens estáticas para sucesso, info e warning -->
                    {% if messages %}
                        {% for message in messages %}
                            {% if message.tags == 'error' or message.tags == 'danger' %}
                                <!-- Mensagens de erro serão processadas pelo sistema de toasts -->
                            {% else %}
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    <!-- jQuery - Carregar primeiro -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script>
        // Garantir que o jQuery esteja disponível globalmente
        if (typeof jQuery !== 'undefined') {
            window.$ = window.jQuery = jQuery;
        } else {
            console.error('jQuery não foi carregado corretamente!');
        }
    </script>
    <!-- jQuery Mask Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <!-- Select2 JS - Carregar após jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js" onerror="console.error('Erro ao carregar Select2')"></script>
    <!-- Bootstrap JS (local) -->
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <!-- Sistema de Mensagens -->
    <script src="{% static 'js/message-system.js' %}" onerror="console.error('Erro ao carregar message-system.js')"></script>
    <!-- Sistema de Visualização de Senha -->
    <script src="{% static 'js/password-toggle.js' %}" onerror="console.error('Erro ao carregar password-toggle.js')"></script>
    
    <script>
        // Sistema de toast desabilitado - usando modais modernos
        
        // Funções de Modal Modernas Globais
        function mostrarModalSucesso(titulo, mensagem) {
            const modalHtml = `
                <div class="modal fade" id="globalSuccessModal" tabindex="-1" aria-labelledby="globalSuccessModalLabel" aria-hidden="true" style="z-index: 1070;">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0 shadow-lg">
                            <div class="modal-header bg-success text-white border-0">
                                <h5 class="modal-title" id="globalSuccessModalLabel">
                                    <i class="fas fa-check-circle me-2"></i>${titulo}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center py-4">
                                <div class="fs-5">${mensagem}</div>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <button type="button" class="btn btn-success px-4" data-bs-dismiss="modal">
                                    <i class="fas fa-check me-1"></i>Entendi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente se houver
            const existingModal = document.getElementById('globalSuccessModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Adicionar novo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('globalSuccessModal'));
            modal.show();
        }
        
        function mostrarModalErro(titulo, mensagem) {
            const modalHtml = `
                <div class="modal fade" id="globalErrorModal" tabindex="-1" aria-labelledby="globalErrorModalLabel" aria-hidden="true" style="z-index: 1070;">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0 shadow-lg">
                            <div class="modal-header bg-danger text-white border-0">
                                <h5 class="modal-title" id="globalErrorModalLabel">
                                    <i class="fas fa-exclamation-triangle me-2"></i>${titulo}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center py-4">
                                <div class="fs-5">${mensagem}</div>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-1"></i>Fechar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente se houver
            const existingModal = document.getElementById('globalErrorModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Adicionar novo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('globalErrorModal'));
            modal.show();
        }
        
        function mostrarModalConfirmacao(titulo, mensagem, callback) {
            const modalHtml = `
                <div class="modal fade" id="globalConfirmModal" tabindex="-1" aria-labelledby="globalConfirmModalLabel" aria-hidden="true" style="z-index: 1070;">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0 shadow-lg">
                            <div class="modal-header bg-warning text-dark border-0">
                                <h5 class="modal-title" id="globalConfirmModalLabel">
                                    <i class="fas fa-question-circle me-2"></i>${titulo}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center py-4">
                                <div class="fs-5">${mensagem}</div>
                            </div>
                            <div class="modal-footer border-0 justify-content-center">
                                <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">
                                    <i class="fas fa-times me-1"></i>Cancelar
                                </button>
                                <button type="button" class="btn btn-warning" id="globalConfirmBtn">
                                    <i class="fas fa-check me-1"></i>Confirmar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente se houver
            const existingModal = document.getElementById('globalConfirmModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Adicionar novo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Configurar callback
            const confirmBtn = document.getElementById('globalConfirmBtn');
            if (confirmBtn && callback) {
                confirmBtn.addEventListener('click', function() {
                    callback();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('globalConfirmModal'));
                    if (modal) {
                        modal.hide();
                    }
                });
            }
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('globalConfirmModal'));
            modal.show();
        }
        
        // Máscaras para campos
        $(document).ready(function() {
            // Máscara para CPF
            $('.cpf-mask').mask('000.000.000-00');
            
            // Máscara para telefone
            $('.phone-mask').mask('(00) 00000-0000');
            
            // Máscara para CEP
            $('.cep-mask').mask('00000-000');
            
            // Auto-hide para alertas (exceto erros que são toasts)
            setTimeout(function() {
                $('.alert:not(.alert-danger):not(.alert-error)').fadeOut('slow');
            }, 5000);
            
            // Corrigir problemas do Bootstrap tooltip
            // Substituir chamadas antigas do jQuery tooltip pelo Bootstrap 5
            if (typeof $ !== 'undefined') {
                // Substituir método tooltip do jQuery se existir
                if ($.fn.tooltip) {
                    $.fn.tooltip = function() {
                        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                            return new bootstrap.Tooltip(tooltipTriggerEl);
                        });
                        return this;
                    };
                }
                
                // Inicializar tooltips do Bootstrap 5
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
                
            // Converter tooltips antigos (com title) para Bootstrap 5
            if (typeof jQuery !== 'undefined' && typeof jQuery.fn !== 'undefined') {
                jQuery('[title]').each(function() {
                    var $this = jQuery(this);
                    var title = $this.attr('title');
                    if (title && title.trim() !== '') {
                        $this.attr('data-bs-toggle', 'tooltip');
                        $this.attr('data-bs-title', title);
                        $this.removeAttr('title');
                        new bootstrap.Tooltip($this[0]);
                    }
                });
            }
            
            // Configurar Select2
            if (typeof jQuery !== 'undefined' && typeof jQuery.fn !== 'undefined' && typeof jQuery.fn.select2 !== 'undefined') {
                // Configurar idioma padrão para português
                jQuery.fn.select2.defaults.set('language', 'pt-BR');
            } else {
                console.warn('Select2 não está disponível. Alguns campos podem não funcionar corretamente.');
            }
        });
    </script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Modal de Boas-vindas para Usuários -->
    {% if user.is_authenticated and not request.session.usuario_welcome_shown %}
    {% csrf_token %}
    <div id="welcomeModal" class="modal fade" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="welcomeModalLabel">
                        <i class="fas fa-hand-wave me-2"></i>Bem vindo ao Sysgabom
                    </h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <img src="{% static 'sysgabomlogo.png' %}" alt="Sysgabom Logo" class="mb-3" style="max-height: 120px; max-width: 300px;">
                        <h4>Bem vindo ao Sysgabom</h4>
                        <p class="text-muted">Você está logado no <strong>Sistema de Gestão Administrativa do Corpo de Bombeiros Militar do Estado do Piauí</strong>.</p>
                        <p class="text-muted">A página será atualizada automaticamente...</p>
                    </div>
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <div class="d-flex align-items-center">
                        <img src="{% static 'sysgabomlogo.png' %}" alt="Sysgabom" style="height: 20px; margin-right: 8px;">
                        <small class="text-muted">Sistema de Gestão Administrativa do Corpo de Bombeiros Militar do Estado do Piauí</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Mostrar modal de boas-vindas automaticamente
        var welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
        welcomeModal.show();
        
        // Marcar na sessão que a popup foi mostrada
        fetch('{% url "militares:mark_welcome_shown" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('input[name="csrfmiddlewaretoken"]').value,
                'Content-Type': 'application/json',
            }
        }).then(response => {
            if (response.ok) {
                console.log('Modal de boas-vindas marcado como mostrado');
            }
        }).catch(error => {
            console.error('Erro ao marcar modal como mostrado:', error);
        });
        
        // Atualizar página automaticamente após 3 segundos para evitar modal infinito
        setTimeout(function() {
            window.location.reload();
        }, 3000);
    });
    </script>
    {% endif %}
    
    <!-- Script do Cronômetro de Sessão -->
    <script>
        // Configurações do cronômetro de sessão
        const SESSION_TIMEOUT = 30 * 60; // 30 minutos em segundos
        const WARNING_TIME = 5 * 60; // 5 minutos antes de expirar
        
        let sessionTimer;
        let sessionTimeLeft = SESSION_TIMEOUT;
        let isWarningShown = false;
        
        // Função para formatar o tempo
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // Função para atualizar o cronômetro
        function updateSessionTimer() {
            const discreteTimerElement = document.getElementById('discrete-timer');
            const discreteTimerDisplayElement = document.getElementById('discrete-timer-display');
            
            // Verificar se a sessão expirou
            if (sessionTimeLeft <= 0) {
                sessionExpired();
                return;
            }
            
            // Atualizar o cronômetro discreto
            if (discreteTimerDisplayElement) {
                discreteTimerDisplayElement.textContent = formatTime(sessionTimeLeft);
            }
            
            // Mudar cor baseado no tempo restante
            if (sessionTimeLeft <= WARNING_TIME) {
                if (discreteTimerElement) {
                    discreteTimerElement.className = 'discrete-timer danger';
                }
                if (!isWarningShown) {
                    showSessionWarning();
                    isWarningShown = true;
                }
            } else if (sessionTimeLeft <= WARNING_TIME * 2) {
                if (discreteTimerElement) {
                    discreteTimerElement.className = 'discrete-timer warning';
                }
            } else {
                if (discreteTimerElement) {
                    discreteTimerElement.className = 'discrete-timer';
                }
            }
            
            sessionTimeLeft--;
        }
        
        // Função para mostrar aviso de sessão
        function showSessionWarning() {
            // Criar modal de aviso
            const warningModal = document.createElement('div');
            warningModal.className = 'modal fade';
            warningModal.id = 'sessionWarningModal';
            warningModal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-warning text-dark">
                            <h5 class="modal-title">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Sessão Expirando
                            </h5>
                        </div>
                        <div class="modal-body text-center">
                            <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                            <h5>Sua sessão expirará em breve!</h5>
                            <p class="text-muted">Para manter sua sessão ativa, clique em "Manter Ativa" ou faça alguma ação no sistema.</p>
                            <div class="alert alert-info">
                                <strong>Tempo restante:</strong> <span id="warning-timer">05:00</span>
                            </div>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="button" class="btn btn-warning" onclick="extendSession()">
                                <i class="fas fa-sync-alt me-2"></i>Manter Ativa
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Sair
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(warningModal);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(warningModal);
            modal.show();
            
            // Atualizar timer do aviso
            let warningTimeLeft = WARNING_TIME;
            const warningTimerElement = document.getElementById('warning-timer');
            const warningInterval = setInterval(() => {
                if (warningTimeLeft <= 0) {
                    clearInterval(warningInterval);
                    sessionExpired();
                    return;
                }
                warningTimerElement.textContent = formatTime(warningTimeLeft);
                warningTimeLeft--;
            }, 1000);
        }
        
        // Função para estender a sessão
        function extendSession() {
            sessionTimeLeft = SESSION_TIMEOUT;
            isWarningShown = false;
            
            // Fechar modal de aviso
            const warningModal = document.getElementById('sessionWarningModal');
            if (warningModal) {
                const modal = bootstrap.Modal.getInstance(warningModal);
                if (modal) {
                    modal.hide();
                }
                warningModal.remove();
            }
            
            // Mostrar mensagem de sucesso
            mostrarModalSucesso('Sessão Estendida!', 'Sua sessão foi estendida com sucesso!');
        }
        
        // Função para quando a sessão expira
        function sessionExpired() {
            // Fechar qualquer modal aberto
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                const modalInstance = bootstrap.Modal.getInstance(modal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            });
            
            // Mostrar mensagem de expiração
            mostrarModalErro('Sessão Expirada', 'Sua sessão expirou por inatividade. A página será fechada automaticamente.');
            
            // Fechar a página após 3 segundos
            setTimeout(() => {
                window.close();
                // Se não conseguir fechar (alguns navegadores bloqueiam), redireciona para logout
                if (!window.closed) {
                    try { fetch("{% url 'logout' %}", { method: 'GET', credentials: 'include' }); } catch (e) {}
                    window.location.href = "{% url 'militares:ensino_login' %}";
                }
            }, 3000);
        }
        
        // Função para resetar o timer da sessão
        function resetSessionTimer() {
            if (sessionTimer) {
                clearInterval(sessionTimer);
                sessionTimeLeft = SESSION_TIMEOUT;
                isWarningShown = false;
                sessionTimer = setInterval(updateSessionTimer, 1000);
            }
        }
        
        // Função para logout
        function logout() {
            try { fetch("{% url 'logout' %}", { method: 'GET', credentials: 'include' }); } catch (e) {}
            window.location.href = "{% url 'militares:ensino_login' %}";
        }
        
        // Inicializar cronômetro quando a página carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Iniciar cronômetro
            sessionTimer = setInterval(updateSessionTimer, 1000);
            
            // Eventos para resetar o timer
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            events.forEach(event => {
                document.addEventListener(event, resetSessionTimer, true);
            });
            
            // Eventos de formulário
            document.addEventListener('submit', resetSessionTimer, true);
            document.addEventListener('input', resetSessionTimer, true);
            
            // Eventos de navegação
            document.addEventListener('focus', resetSessionTimer, true);
            document.addEventListener('blur', resetSessionTimer, true);
        });
        
        // Limpar timer quando a página for descarregada
        window.addEventListener('beforeunload', function() {
            if (sessionTimer) {
                clearInterval(sessionTimer);
            }
        });
    </script>

    <!-- Popup de Alertas de Login -->
    {% if tem_alertas_popup %}
    <!-- Modal de Alertas -->
    <div class="modal fade" id="alertasLoginModal" tabindex="-1" aria-labelledby="alertasLoginModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="alertasLoginModalLabel">
                        <i class="fas fa-calendar-exclamation"></i> Alerta: Datas de Calendários Vencendo
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    {% for alerta in alertas_popup %}
                        <div class="alert alert-{{ alerta.cor }} mb-3 border-start border-4" role="alert">
                            <h6 class="alert-heading">
                                <i class="{{ alerta.icone }}"></i> {{ alerta.titulo }}
                            </h6>
                            <p class="mb-2"><strong>{{ alerta.mensagem }}</strong></p>
                            
                            {% if alerta.detalhes %}
                                <hr>
                                <h6><i class="fas fa-list"></i> Detalhes das Atividades:</h6>
                                {% for detalhe in alerta.detalhes %}
                                    <div class="mb-3 p-3 border rounded bg-light">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <strong class="text-primary">📅 {{ detalhe.calendario.numero }}</strong><br>
                                                <span class="text-{{ alerta.cor }}">{{ detalhe.alerta.mensagem }}</span><br>
                                                <small class="text-muted">
                                                    <i class="fas fa-tasks"></i> <strong>Atividade:</strong> {{ detalhe.alerta.item.get_tipo_atividade_display }}<br>
                                                    <i class="fas fa-calendar"></i> <strong>Data limite:</strong> {{ detalhe.alerta.item.data_fim|date:"d/m/Y" }}
                                                </small>
                                            </div>
                                            <div class="col-md-4 text-end">
                                                {% if alerta.tipo == 'VENCE_HOJE' %}
                                                    <span class="badge bg-danger fs-6">HOJE!</span>
                                                {% elif alerta.tipo == 'VENCE_BREVE' %}
                                                    <span class="badge bg-warning text-dark fs-6">
                                                        {% if detalhe.alerta.dias_restantes == 1 %}
                                                            AMANHÃ
                                                        {% else %}
                                                            {{ detalhe.alerta.dias_restantes }} DIAS
                                                        {% endif %}
                                                    </span>
                                                {% elif alerta.tipo == 'VENCE_PROXIMO' %}
                                                    <span class="badge bg-info text-dark fs-6">
                                                        {% if detalhe.alerta.dias_restantes == 4 %}
                                                            EM 4 DIAS
                                                        {% elif detalhe.alerta.dias_restantes == 5 %}
                                                            EM 5 DIAS
                                                        {% elif detalhe.alerta.dias_restantes == 6 %}
                                                            EM 6 DIAS
                                                        {% else %}
                                                            EM 7 DIAS
                                                        {% endif %}
                                                    </span>
                                                {% elif alerta.tipo == 'JA_VENCIDO' %}
                                                    <span class="badge bg-secondary fs-6">VENCIDO</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                                
                                <div class="mt-3 text-center">
                                    <a href="{% url 'militares:calendario_promocao_list' %}" class="btn btn-{{ alerta.cor }} btn-lg">
                                        <i class="fas fa-calendar-alt"></i> Ir para Calendários de Promoção
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="naoMostrarHoje">
                        <label class="form-check-label" for="naoMostrarHoje">
                            Não mostrar novamente hoje
                        </label>
                    </div>
                    <button type="button" class="btn btn-primary" id="btnEntendi">
                        <i class="fas fa-check"></i> Entendi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se deve mostrar o popup de alertas
            const temAlertas = {% if tem_alertas_popup %}true{% else %}false{% endif %};
            if (temAlertas) {
                // VERIFICAÇÃO CRÍTICA: Só mostrar no primeiro carregamento da página
                // Verificar se já foi mostrado nesta sessão
                const sessionKey = 'popup_alertas_mostrado_sessao';
                const jaMostradoNestaSessao = sessionStorage.getItem(sessionKey);
                
                // Verificar se não foi marcado para não mostrar hoje
                const naoMostrarHoje = localStorage.getItem('naoMostrarAlertasHoje');
                const hoje = new Date().toDateString();
                
                if (!jaMostradoNestaSessao && naoMostrarHoje !== hoje) {
                    // Marcar que foi mostrado nesta sessão
                    sessionStorage.setItem(sessionKey, 'true');
                    
                    // Aguardar 1 segundo e mostrar o modal
                    setTimeout(function() {
                        const modal = new bootstrap.Modal(document.getElementById('alertasLoginModal'));
                        modal.show();
                    }, 1000);
                }
            }
            
            // Gerenciar checkbox "Não mostrar novamente hoje"
            const checkbox = document.getElementById('naoMostrarHoje');
            const btnEntendi = document.getElementById('btnEntendi');
            
            if (checkbox && btnEntendi) {
                btnEntendi.addEventListener('click', function() {
                    if (checkbox.checked) {
                        localStorage.setItem('naoMostrarAlertasHoje', new Date().toDateString());
                    }
                    const modal = bootstrap.Modal.getInstance(document.getElementById('alertasLoginModal'));
                    modal.hide();
                });
            }
        });
    </script>
    
    <!-- JavaScript para o submenu de medalhas -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gerenciar o submenu de medalhas
            const medalhasToggle = document.querySelector('[data-bs-target="#medalhasSubmenu"]');
            const medalhasSubmenu = document.getElementById('medalhasSubmenu');
            
            if (medalhasToggle && medalhasSubmenu) {
                // Expandir automaticamente se estiver em uma página de medalhas
                if (window.location.pathname.includes('/medalhas/')) {
                    medalhasSubmenu.classList.add('show');
                    medalhasToggle.setAttribute('aria-expanded', 'true');
                }
                
                // Adicionar indicador visual para o item ativo no submenu
                const currentPath = window.location.pathname;
                const submenuLinks = medalhasSubmenu.querySelectorAll('.nav-link');
                
                submenuLinks.forEach(link => {
                    if (link.href && link.href.includes(currentPath)) {
                        link.classList.add('active');
                    }
                });
                
                // Adicionar efeito de hover suave
                submenuLinks.forEach(link => {
                    link.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateX(3px)';
                    });
                    
                    link.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateX(0)';
                    });
                });
            }
        });
    </script>
    {% endif %}

    <!-- Script do Cronômetro com Logout Automático -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configurações do cronômetro
            const TEMPO_LIMITE = 30 * 60 * 1000; // 30 minutos em milissegundos
            let tempoInicial = Date.now();
            let ultimaAtividade = Date.now();
            let cronometroInterval;
            let avisoMostrado = false;
            
            const cronometroElement = document.getElementById('session-timer');
            
            // Função para atualizar o cronômetro
            function atualizarCronometro() {
                const agora = Date.now();
                const tempoDecorrido = agora - tempoInicial;
                const tempoRestante = TEMPO_LIMITE - (agora - ultimaAtividade);
                
                // Se o tempo de inatividade excedeu 30 minutos
                if (tempoRestante <= 0) {
                    logoutAutomatico();
                    return;
                }
                
                // Mostrar aviso quando restam 5 minutos
                if (tempoRestante <= 5 * 60 * 1000 && !avisoMostrado) {
                    mostrarAvisoLogout();
                    avisoMostrado = true;
                }
                
                // Calcular tempo restante
                const minutos = Math.floor(tempoRestante / (1000 * 60));
                const segundos = Math.floor((tempoRestante % (1000 * 60)) / 1000);
                
                const tempoFormatado = 
                    String(minutos).padStart(2, '0') + ':' +
                    String(segundos).padStart(2, '0');
                
                if (cronometroElement) {
                    cronometroElement.textContent = tempoFormatado;
                    
                    // Mudar cor conforme o tempo restante
                    if (tempoRestante <= 5 * 60 * 1000) {
                        cronometroElement.className = 'badge bg-danger text-white';
                    } else if (tempoRestante <= 10 * 60 * 1000) {
                        cronometroElement.className = 'badge bg-warning text-dark';
                    } else {
                        cronometroElement.className = 'badge bg-warning text-dark';
                    }
                }
            }
            
            // Função para mostrar aviso de logout
            function mostrarAvisoLogout() {
                mostrarModalConfirmacao(
                    'Sessão Expirando',
                    'Sua sessão expirará em 10 minutos devido à inatividade. Deseja continuar ou fazer logout agora?',
                    function() {
                        // Usuário clicou OK, resetar o cronômetro
                        ultimaAtividade = Date.now();
                        avisoMostrado = false;
                    }
                );
                
                // Adicionar botão de logout na modal
                setTimeout(() => {
                    const modal = document.getElementById('globalConfirmModal');
                    if (modal) {
                        const footer = modal.querySelector('.modal-footer');
                        if (footer) {
                            const logoutBtn = document.createElement('button');
                            logoutBtn.className = 'btn btn-danger me-2';
                            logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt me-1"></i>Fazer Logout';
                            logoutBtn.onclick = function() {
                                logoutAutomatico();
                            };
                            footer.insertBefore(logoutBtn, footer.firstChild);
                        }
                    }
                }, 100);
            }
            
            // Função para logout automático
            function logoutAutomatico() {
                mostrarModalErro('Sessão Expirada', 'Sua sessão expirou devido à inatividade. A página será fechada automaticamente.');
                // Fechar a página após 3 segundos
                setTimeout(function() {
                    window.close();
                    // Se não conseguir fechar (alguns navegadores bloqueiam), redireciona para logout
                    if (!window.closed) {
                        window.location.href = '{% url "logout" %}';
                    }
                }, 3000);
            }
            
            // Detectar atividade do usuário
            function resetarCronometro() {
                ultimaAtividade = Date.now();
                avisoMostrado = false;
            }
            
            // Eventos que indicam atividade do usuário
            const eventosAtividade = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
            eventosAtividade.forEach(evento => {
                document.addEventListener(evento, resetarCronometro, true);
            });
            
            // Iniciar cronômetro
            cronometroInterval = setInterval(atualizarCronometro, 1000);
            atualizarCronometro();
            
            // Limpar interval quando a página for fechada
            window.addEventListener('beforeunload', function() {
                if (cronometroInterval) {
                    clearInterval(cronometroInterval);
                }
            });
        });
    </script>

    <!-- JavaScript para troca de função via AJAX -->
    <script>
        // Função para atualizar informações da função no navbar principal
        function atualizarInformacoesFuncao(data) {
            // Esta função será chamada após o recarregamento da página
            // As informações serão atualizadas automaticamente pelo Django
            console.log('🔄 Informações da função atualizadas:', data);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Adicionar event listeners para as opções de função
            const funcaoOptions = document.querySelectorAll('.funcao-option');
            
            funcaoOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const funcaoId = this.getAttribute('data-funcao-id');
                    const funcaoNome = this.querySelector('.fw-bold').textContent;
                    const funcaoLotacao = this.querySelector('.text-muted').textContent;
                    
                    if (!funcaoId) {
                        return;
                    }
                    
                    // Obter função atual
                    const funcaoAtualNome = document.getElementById('funcao-atual-nome').textContent;
                    const funcaoAtualLotacao = document.getElementById('funcao-atual-lotacao').textContent;
                    
                    // Atualizar modal com informações
                    document.getElementById('funcao-atual-modal').textContent = funcaoAtualNome;
                    document.getElementById('lotacao-atual-modal').textContent = funcaoAtualLotacao || 'Sem lotação definida';
                    document.getElementById('funcao-nova-modal').textContent = funcaoNome;
                    document.getElementById('lotacao-nova-modal').textContent = funcaoLotacao || 'Sem lotação definida';
                    
                    // Mostrar modal de confirmação
                    const modal = new bootstrap.Modal(document.getElementById('confirmarTrocaFuncaoModal'));
                    modal.show();
                    
                    // Configurar botão de confirmação
                    const confirmarBtn = document.getElementById('confirmarTrocaBtn');
                    confirmarBtn.onclick = function() {
                        // Fechar modal
                        modal.hide();
                        
                        // Mostrar loading no dropdown
                        const dropdown = option.closest('.dropdown-menu');
                        const originalContent = dropdown.innerHTML;
                        dropdown.innerHTML = '<li><div class="dropdown-item text-center"><div class="spinner-border spinner-border-sm me-2" role="status"></div>Alterando função...</div></li>';
                        
                        // Obter CSRF token
                        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                        if (!csrfToken) {
                            mostrarModalErro('Erro de Segurança', 'Token de segurança não encontrado');
                            dropdown.innerHTML = originalContent;
                            return;
                        }
                        
                        // Fazer requisição AJAX
                        fetch('{% url "militares:trocar_funcao_ajax" %}', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': csrfToken.value
                            },
                            body: JSON.stringify({
                                funcao_id: funcaoId
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                        if (data.success) {
                            
                            // Atualizar o texto da função atual
                            const funcaoNomeElement = document.getElementById('funcao-atual-nome');
                            const funcaoLotacaoElement = document.getElementById('funcao-atual-lotacao');
                            
                            if (funcaoNomeElement) {
                                funcaoNomeElement.textContent = data.funcao_nome;
                            }
                            
                            if (funcaoLotacaoElement) {
                                if (data.lotacao) {
                                    funcaoLotacaoElement.textContent = data.lotacao;
                                } else {
                                    funcaoLotacaoElement.textContent = '';
                                }
                            }
                            
                            // Atualizar informações detalhadas da função no navbar principal
                            atualizarInformacoesFuncao(data);
                            
                            // Preparar mensagem com informações de sincronização
                            let mensagem = data.message;
                            if (data.sincronizacao) {
                                const sync = data.sincronizacao;
                                if (sync.funcoes_criadas > 0 || sync.funcoes_atualizadas > 0 || sync.funcoes_desativadas > 0) {
                                    mensagem += '\n\n📊 Sincronização realizada:';
                                    if (sync.funcoes_criadas > 0) {
                                        mensagem += `\n• ${sync.funcoes_criadas} função(ões) criada(s)`;
                                    }
                                    if (sync.funcoes_atualizadas > 0) {
                                        mensagem += `\n• ${sync.funcoes_atualizadas} função(ões) atualizada(s)`;
                                    }
                                    if (sync.funcoes_desativadas > 0) {
                                        mensagem += `\n• ${sync.funcoes_desativadas} função(ões) desativada(s)`;
                                    }
                                }
                            }
                            
                            // Mostrar toast de sucesso personalizado
                            mostrarToastSucesso(data.funcao_nome, data.sincronizacao);
                            
                            // Fechar o dropdown
                            const dropdownToggle = document.querySelector('[data-bs-toggle="dropdown"]');
                            if (dropdownToggle) {
                                const bsDropdown = new bootstrap.Dropdown(dropdownToggle);
                                bsDropdown.hide();
                            }
                            
                            // Recarregar a página para atualizar o contexto completo e o menu
                            setTimeout(() => {
                                console.log('🔄 Recarregando página para atualizar menu...');
                                window.location.reload();
                            }, 1000);
                        } else {
                            // Mostrar toast de erro personalizado
                            mostrarToastErro(data.message);
                            
                            // Restaurar dropdown
                            dropdown.innerHTML = originalContent;
                        }
                    })
                    .catch(error => {
                        console.error('Erro na requisição:', error);
                        
                        // Mostrar toast de erro personalizado
                        mostrarToastErro('Erro ao alterar função. Tente novamente.');
                        
                        // Restaurar dropdown
                        dropdown.innerHTML = originalContent;
                    });
                }; // Fechar função do botão de confirmação
                });
            });
        });
        
        // Função para mostrar toast de sucesso personalizado - DESABILITADA
        function mostrarToastSucesso(funcaoNome, sincronizacao) {
            // Sistema de toast desabilitado - usando modais modernos
            return;
        }
        
        // Função para mostrar toast de erro personalizado - DESABILITADA
        function mostrarToastErro(mensagem) {
            // Sistema de toast desabilitado - usando modais modernos
            return;
        }
    </script>

    <!-- Modal de Confirmação de Mudança de Função - Jovial -->
    <div class="modal fade" id="confirmarTrocaFuncaoModal" tabindex="-1" aria-labelledby="confirmarTrocaFuncaoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                <!-- Header com gradiente animado -->
                <div class="modal-header text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 2rem 1.5rem 1rem;">
                    <div class="w-100">
                        <div class="mb-3">
                            <div class="d-inline-block" style="animation: bounce 2s infinite;">
                                <i class="fas fa-user-tie" style="font-size: 3rem; color: white; text-shadow: 0 4px 8px rgba(0,0,0,0.3);"></i>
                            </div>
                        </div>
                        <h4 class="modal-title text-white fw-bold mb-0" id="confirmarTrocaFuncaoModalLabel">
                            🎯 Confirmação de Mudança
                        </h4>
                        <p class="text-white-50 mb-0 mt-2" style="font-size: 0.9rem;">
                            <i class="fas fa-question-circle me-1"></i>Tem certeza que deseja trocar de função?
                        </p>
                    </div>
                </div>
                
                <!-- Body com animações -->
                <div class="modal-body text-center py-4" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                    <div class="mb-4">
                        <div class="d-flex justify-content-center align-items-center mb-3">
                            <div class="me-3">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px; animation: pulse 2s infinite;">
                                    <i class="fas fa-arrow-right" style="font-size: 1.5rem;"></i>
                                </div>
                            </div>
                            <div class="text-center">
                                <h6 class="mb-1 fw-bold text-primary" id="funcao-atual-modal">Função Atual</h6>
                                <small class="text-muted" id="lotacao-atual-modal">Lotação Atual</small>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="text-center me-3">
                                <h6 class="mb-1 fw-bold text-success" id="funcao-nova-modal">Nova Função</h6>
                                <small class="text-muted" id="lotacao-nova-modal">Nova Lotação</small>
                            </div>
                            <div>
                                <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center" 
                                     style="width: 60px; height: 60px; animation: pulse 2s infinite; animation-delay: 1s;">
                                    <i class="fas fa-star" style="font-size: 1.5rem;"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-warning border-0" style="border-radius: 15px; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-exclamation-triangle text-warning" style="font-size: 1.5rem;"></i>
                            </div>
                            <div class="text-start">
                                <h6 class="mb-1 fw-bold text-warning">⚠️ Atenção</h6>
                                <small class="text-muted mb-0">
                                    Esta ação irá alterar suas permissões e acesso ao sistema. Confirme apenas se deseja continuar.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer com botões animados -->
                <div class="modal-footer border-0 text-center" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 1.5rem;">
                    <div class="d-flex gap-3 justify-content-center w-100">
                        <button type="button" class="btn btn-outline-secondary btn-lg px-4" 
                                data-bs-dismiss="modal" 
                                style="border-radius: 25px; font-weight: 600; transition: all 0.3s ease;"
                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px rgba(0,0,0,0.2)'"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-times me-2"></i>Cancelar
                        </button>
                        <button type="button" class="btn btn-success btn-lg px-4" 
                                id="confirmarTrocaBtn"
                                style="border-radius: 25px; font-weight: 600; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: none; transition: all 0.3s ease;"
                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 15px rgba(40, 167, 69, 0.4)'"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-rocket me-2"></i>Confirmar Troca
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CSS para animações -->
    <style>
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
            }
        }
        
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .modal-content {
            animation: slideInDown 0.5s ease-out;
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .btn:hover {
            transform: translateY(-2px) !important;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>

    <!-- Sistema Global de Toasts -->
    {% include 'includes/global_toasts.html' %}

    <!-- Sistema de Chat em Tempo Real -->
    <script src="{% static 'js/chat-tempo-real.js' %}"></script>
    
    <!-- Chat Widget iOS Flutuante -->
    {% if pode_usar_chat %}
    {% include 'militares/chat_widget.html' %}
    {% endif %}
    
    <!-- Atualização Automática de Notificações -->
    <script src="{% static 'js/notificacoes-auto.js' %}"></script>
    
    <!-- Armazenar ID do usuário para JavaScript -->
    <script>
        document.body.setAttribute('data-usuario-id', '{{ user.id }}');
    </script>
    
    <!-- JavaScript para Toggle da Sidebar em Mobile -->
    <script>
        (function() {
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('mainSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            
            if (sidebarToggle && sidebar && sidebarOverlay) {
                // Função para abrir sidebar
                function openSidebar() {
                    sidebar.classList.add('show');
                    sidebarOverlay.classList.add('show');
                    document.body.style.overflow = 'hidden'; // Previne scroll do body
                }
                
                // Função para fechar sidebar
                function closeSidebar() {
                    sidebar.classList.remove('show');
                    sidebarOverlay.classList.remove('show');
                    document.body.style.overflow = ''; // Restaura scroll do body
                }
                
                // Toggle ao clicar no botão
                sidebarToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (sidebar.classList.contains('show')) {
                        closeSidebar();
                    } else {
                        openSidebar();
                    }
                });
                
                // Fechar ao clicar no overlay
                sidebarOverlay.addEventListener('click', function() {
                    closeSidebar();
                });
                
                // Fechar ao clicar em um link da sidebar (mobile)
                if (window.innerWidth <= 767.98) {
                    const sidebarLinks = sidebar.querySelectorAll('.nav-link');
                    sidebarLinks.forEach(function(link) {
                        link.addEventListener('click', function() {
                            // Pequeno delay para permitir navegação
                            setTimeout(function() {
                                closeSidebar();
                            }, 300);
                        });
                    });
                }
                
                // Fechar sidebar ao redimensionar para desktop
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 767.98) {
                        closeSidebar();
                    }
                });
                
                // Fechar sidebar com ESC
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && sidebar.classList.contains('show')) {
                        closeSidebar();
                    }
                });
            }
        })();
    </script>

</body>

<!-- Mobile Bottom Navigation -->
<div class="mobile-bottom-nav d-md-none d-flex">
    <a href="{% url 'militares:home' %}" class="mobile-nav-item" aria-label="Início">
        <i class="fas fa-home"></i>
        Início
    </a>
    <a href="{% url 'militares:militar_dashboard' %}" class="mobile-nav-item" aria-label="Dashboard">
        <i class="fas fa-tachometer-alt"></i>
        Dash
    </a>
    <a href="{% url 'militares:ensino_dashboard' %}" class="mobile-nav-item" aria-label="Ensino">
        <i class="fas fa-graduation-cap"></i>
        Ensino
    </a>
    <button type="button" class="mobile-nav-item" id="mobileQuickActions" aria-label="Ações">
        <i class="fas fa-bolt"></i>
        Ações
    </button>
    <button type="button" class="mobile-nav-item" id="mobileOpenMenu" aria-label="Menu">
        <i class="fas fa-bars"></i>
        Menu
    </button>
    <button type="button" class="mobile-nav-item" id="mobileThemeToggle" aria-label="Tema">
        <i class="fas fa-moon"></i>
        Tema
    </button>
</div>

<script>
  (function(){
    const btn = document.getElementById('mobileOpenMenu');
    const sidebarToggle = document.getElementById('sidebarToggle');
    if(btn && sidebarToggle){
      btn.addEventListener('click', function(){
        sidebarToggle.click();
      });
    }
    // Dark mode toggle
    const themeToggle = document.getElementById('mobileThemeToggle');
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme){ root.setAttribute('data-theme', savedTheme); }
    if(themeToggle){
      themeToggle.addEventListener('click', function(){
        const current = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', current);
        localStorage.setItem('theme', current);
      });
    }
    // Quick Actions
    const qaBtn = document.getElementById('mobileQuickActions');
    if(qaBtn){
      qaBtn.addEventListener('click', function(){
        const modalEl = document.getElementById('mobileQuickActionsModal');
        if(window.bootstrap && modalEl){
          const m = new bootstrap.Modal(modalEl);
          m.show();
        } else {
          modalEl.classList.add('show');
        }
      });
    }
  })();
</script>

<!-- Mobile Quick Actions Modal -->
<div class="modal fade" id="mobileQuickActionsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-bolt me-2"></i>Ações Rápidas</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-6">
            <a href="{% url 'militares:ensino_aulas_listar' %}" class="btn btn-outline-primary w-100">
              <i class="fas fa-chalkboard-teacher me-1"></i>Aulas
            </a>
          </div>
          <div class="col-6">
            <a href="{% url 'militares:ensino_turmas_listar' %}" class="btn btn-outline-primary w-100">
              <i class="fas fa-users me-1"></i>Turmas
            </a>
          </div>
          <div class="col-6">
            <a href="{% url 'militares:ensino_avaliacoes_listar' %}" class="btn btn-outline-primary w-100">
              <i class="fas fa-clipboard-check me-1"></i>Avaliações
            </a>
          </div>
          <div class="col-6">
            <a href="{% url 'militares:militar_list' %}" class="btn btn-outline-secondary w-100">
              <i class="fas fa-user me-1"></i>Efetivo
            </a>
          </div>
          <div class="col-6">
            <a href="{% url 'militares:publicacoes_list' %}" class="btn btn-outline-secondary w-100">
              <i class="fas fa-newspaper me-1"></i>Publicações
            </a>
          </div>
          <div class="col-6">
            <a href="{% url 'militares:escalas_list' %}" class="btn btn-outline-secondary w-100">
              <i class="fas fa-calendar-alt me-1"></i>Escalas
            </a>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
  </div>

</html>
