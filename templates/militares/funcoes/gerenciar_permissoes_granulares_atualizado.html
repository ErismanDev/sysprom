{% extends 'base.html' %}
{% load static %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-shield-alt text-primary"></i>
            {{ titulo_pagina }}
        </h1>
        <div class="d-flex gap-2">
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-primary" id="expand-all-page" data-bs-toggle="tooltip" title="Expandir todos os acordeons">
                    <i class="fas fa-expand-arrows-alt"></i> Expandir Todos
                </button>
                <button type="button" class="btn btn-outline-secondary" id="collapse-all-page" data-bs-toggle="tooltip" title="Colapsar todos os acordeons">
                    <i class="fas fa-compress-arrows-alt"></i> Colapsar Todos
                </button>
            </div>
            <a href="{% url 'militares:funcoes_militares_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar
            </a>
        </div>
    </div>

    <!-- Estatísticas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Total de Permissões
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-permissoes">
                                {{ total_permissoes }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-shield-alt fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Permissões Ativas
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="permissoes-ativas">
                                {{ permissoes_ativas }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Menus Principais
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="menus-principais">
                                10
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-list fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Submenus
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="submenus">
                                50+
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-sitemap fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulário Principal -->
    <form method="post" id="permissions-form">
        {% csrf_token %}
        
        <!-- Debug: Mostrar dados enviados -->
        <div class="alert alert-info mb-3">
            <strong>Debug:</strong> 
            <br>Total de permissões: {{ total_permissoes }}
            <br>Permissões ativas: {{ permissoes_ativas }}
            <br>Função: {{ funcao.nome }}
        </div>
        
        <!-- Permissões Granulares - Estrutura do Menu Lateral -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-cogs me-2"></i>
                    Permissões Granulares - Estrutura do Menu Lateral
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Configure exatamente como aparece no menu lateral: menus principais, submenus e todos os itens de navegação
                </div>
            </div>
        </div>
                
        <!-- Acordeon Principal - Estrutura do Menu Lateral -->
        <div class="accordion" id="mainAccordion">
            
            <!-- 1. INÍCIO -->
            <div class="card mb-2">
                <div class="card-header" id="headingInicio">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInicio" aria-expanded="false" aria-controls="collapseInicio">
                                <span><i class="fas fa-home text-primary"></i> Início</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-inicio" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-inicio" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseInicio" class="collapse" aria-labelledby="headingInicio" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_dashboard" id="show_dashboard" 
                                   {% if 'show_dashboard' in permissoes_dict %}checked{% endif %}>
                            <label for="show_dashboard" class="form-check-label">
                                <i class="fas fa-home me-2"></i>Página Inicial
                                <small class="text-muted d-block">Acesso à página inicial do sistema</small>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. PESSOAL -->
            <div class="card mb-2">
                <div class="card-header" id="headingPessoal">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePessoal" aria-expanded="false" aria-controls="collapsePessoal">
                                <span><i class="fas fa-user text-primary"></i> Pessoal</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-pessoal" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-pessoal" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapsePessoal" class="collapse" aria-labelledby="headingPessoal" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Pessoal -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_pessoal" id="show_pessoal" 
                                   {% if 'show_pessoal' in permissoes_dict %}checked{% endif %}>
                            <label for="show_pessoal" class="form-check-label">
                                <strong><i class="fas fa-user me-2"></i>Pessoal</strong>
                                <small class="text-muted d-block">Menu principal de informações pessoais</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Pessoal -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_minhas_informacoes" id="show_minhas_informacoes" 
                                       {% if 'show_minhas_informacoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_minhas_informacoes" class="form-check-label">
                                    <i class="fas fa-user-circle me-2"></i>Minhas Informações
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_minha_ficha_cadastro" id="show_minha_ficha_cadastro" 
                                       {% if 'show_minha_ficha_cadastro' in permissoes_dict %}checked{% endif %}>
                                <label for="show_minha_ficha_cadastro" class="form-check-label">
                                    <i class="fas fa-id-card me-2"></i>Minha Ficha de Cadastro
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_minha_ficha_conceito_oficial" id="show_minha_ficha_conceito_oficial" 
                                       {% if 'show_minha_ficha_conceito_oficial' in permissoes_dict %}checked{% endif %}>
                                <label for="show_minha_ficha_conceito_oficial" class="form-check-label">
                                    <i class="fas fa-clipboard-list me-2"></i>Minha Ficha de Conceito (Oficial)
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_minha_ficha_conceito_praca" id="show_minha_ficha_conceito_praca" 
                                       {% if 'show_minha_ficha_conceito_praca' in permissoes_dict %}checked{% endif %}>
                                <label for="show_minha_ficha_conceito_praca" class="form-check-label">
                                    <i class="fas fa-clipboard-list me-2"></i>Minha Ficha de Conceito (Praça)
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_criar_ficha_conceito_oficial" id="show_criar_ficha_conceito_oficial" 
                                       {% if 'show_criar_ficha_conceito_oficial' in permissoes_dict %}checked{% endif %}>
                                <label for="show_criar_ficha_conceito_oficial" class="form-check-label">
                                    <i class="fas fa-plus-circle me-2"></i>Criar Ficha de Conceito (Oficial)
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_criar_ficha_conceito_praca" id="show_criar_ficha_conceito_praca" 
                                       {% if 'show_criar_ficha_conceito_praca' in permissoes_dict %}checked{% endif %}>
                                <label for="show_criar_ficha_conceito_praca" class="form-check-label">
                                    <i class="fas fa-plus-circle me-2"></i>Criar Ficha de Conceito (Praça)
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. EFETIVO -->
            <div class="card mb-2">
                <div class="card-header" id="headingEfetivo">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEfetivo" aria-expanded="false" aria-controls="collapseEfetivo">
                                <span><i class="fas fa-users text-primary"></i> Efetivo</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-efetivo" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-efetivo" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseEfetivo" class="collapse" aria-labelledby="headingEfetivo" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Efetivo -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_efetivo" id="show_efetivo" 
                                   {% if 'show_efetivo' in permissoes_dict %}checked{% endif %}>
                            <label for="show_efetivo" class="form-check-label">
                                <strong><i class="fas fa-users me-2"></i>Efetivo</strong>
                                <small class="text-muted d-block">Menu principal de gestão do efetivo militar</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Efetivo -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_ativos" id="show_ativos" 
                                       {% if 'show_ativos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_ativos" class="form-check-label">
                                    <i class="fas fa-user-check me-2"></i>Ativos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_inativos" id="show_inativos" 
                                       {% if 'show_inativos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_inativos" class="form-check-label">
                                    <i class="fas fa-user-times me-2"></i>Inativos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_lotacoes" id="show_lotacoes" 
                                       {% if 'show_lotacoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_lotacoes" class="form-check-label">
                                    <i class="fas fa-building me-2"></i>Lotações
                                </label>
                            </div>

                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_efetivo_elogios" id="show_efetivo_elogios" 
                                       {% if 'show_efetivo_elogios' in permissoes_dict %}checked{% endif %}>
                                <label for="show_efetivo_elogios" class="form-check-label">
                                    <i class="fas fa-thumbs-up me-2"></i>Elogios
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_efetivo_punicoes" id="show_efetivo_punicoes" 
                                       {% if 'show_efetivo_punicoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_efetivo_punicoes" class="form-check-label">
                                    <i class="fas fa-gavel me-2"></i>Punições
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. SEÇÃO DE PROMOÇÕES -->
            <div class="card mb-2">
                <div class="card-header" id="headingPromocoes">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePromocoes" aria-expanded="false" aria-controls="collapsePromocoes">
                                <span><i class="fas fa-graduation-cap text-primary"></i> Seção de Promoções</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-promocoes" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-promocoes" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapsePromocoes" class="collapse" aria-labelledby="headingPromocoes" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Seção de Promoções -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_secao_promocoes" id="show_secao_promocoes" 
                                   {% if 'show_secao_promocoes' in permissoes_dict %}checked{% endif %}>
                            <label for="show_secao_promocoes" class="form-check-label">
                                <strong><i class="fas fa-graduation-cap me-2"></i>Seção de Promoções</strong>
                                <small class="text-muted d-block">Menu principal de promoções e progressões</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Seção de Promoções -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_fichas_oficiais" id="show_fichas_oficiais" 
                                       {% if 'show_fichas_oficiais' in permissoes_dict %}checked{% endif %}>
                                <label for="show_fichas_oficiais" class="form-check-label">
                                    <i class="fas fa-clipboard-list me-2"></i>Fichas de Conceito (Oficiais)
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_fichas_pracas" id="show_fichas_pracas" 
                                       {% if 'show_fichas_pracas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_fichas_pracas" class="form-check-label">
                                    <i class="fas fa-clipboard-list me-2"></i>Fichas de Conceito (Praças)
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_quadros_acesso" id="show_quadros_acesso" 
                                       {% if 'show_quadros_acesso' in permissoes_dict %}checked{% endif %}>
                                <label for="show_quadros_acesso" class="form-check-label">
                                    <i class="fas fa-table me-2"></i>Quadros de Acesso
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_quadros_fixacao" id="show_quadros_fixacao" 
                                       {% if 'show_quadros_fixacao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_quadros_fixacao" class="form-check-label">
                                    <i class="fas fa-table me-2"></i>Quadros de Fixação de Vagas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_calendarios" id="show_calendarios" 
                                       {% if 'show_calendarios' in permissoes_dict %}checked{% endif %}>
                                <label for="show_calendarios" class="form-check-label">
                                    <i class="fas fa-calendar me-2"></i>Calendários de Promoções
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_comissoes" id="show_comissoes" 
                                       {% if 'show_comissoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_comissoes" class="form-check-label">
                                    <i class="fas fa-users-cog me-2"></i>Comissões de Promoções
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_meus_votos" id="show_meus_votos" 
                                       {% if 'show_meus_votos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_meus_votos" class="form-check-label">
                                    <i class="fas fa-vote-yea me-2"></i>Meus Votos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_promocoes" id="show_promocoes" 
                                       {% if 'show_promocoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_promocoes" class="form-check-label">
                                    <i class="fas fa-graduation-cap me-2"></i>Promoções
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_almanaques" id="show_almanaques" 
                                       {% if 'show_almanaques' in permissoes_dict %}checked{% endif %}>
                                <label for="show_almanaques" class="form-check-label">
                                    <i class="fas fa-book me-2"></i>Almanaques
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5. MEDALHAS -->
            <div class="card mb-2">
                <div class="card-header" id="headingMedalhas">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMedalhas" aria-expanded="false" aria-controls="collapseMedalhas">
                                <span><i class="fas fa-medal text-primary"></i> Medalhas</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-medalhas" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-medalhas" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseMedalhas" class="collapse" aria-labelledby="headingMedalhas" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Medalhas -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_medalhas" id="show_medalhas" 
                                   {% if 'show_medalhas' in permissoes_dict %}checked{% endif %}>
                            <label for="show_medalhas" class="form-check-label">
                                <strong><i class="fas fa-medal me-2"></i>Medalhas</strong>
                                <small class="text-muted d-block">Menu principal de medalhas e condecorações</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Medalhas -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_medalhas_concessoes" id="show_medalhas_concessoes" 
                                       {% if 'show_medalhas_concessoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_medalhas_concessoes" class="form-check-label">
                                    <i class="fas fa-medal me-2"></i>Concessões de Medalhas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_medalhas_propostas" id="show_medalhas_propostas" 
                                       {% if 'show_medalhas_propostas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_medalhas_propostas" class="form-check-label">
                                    <i class="fas fa-file-medical me-2"></i>Propostas de Medalhas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_elegiveis" id="show_elegiveis" 
                                       {% if 'show_elegiveis' in permissoes_dict %}checked{% endif %}>
                                <label for="show_elegiveis" class="form-check-label">
                                    <i class="fas fa-user-check me-2"></i>Elegíveis
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_propostas" id="show_propostas" 
                                       {% if 'show_propostas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_propostas" class="form-check-label">
                                    <i class="fas fa-file-alt me-2"></i>Propostas
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. PUBLICAÇÕES -->
            <div class="card mb-2">
                <div class="card-header" id="headingPublicacoes">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePublicacoes" aria-expanded="false" aria-controls="collapsePublicacoes">
                                <span><i class="fas fa-file-alt text-primary"></i> Publicações</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-publicacoes" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-publicacoes" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapsePublicacoes" class="collapse" aria-labelledby="headingPublicacoes" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Publicações -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_publicacoes" id="show_publicacoes" 
                                   {% if 'show_publicacoes' in permissoes_dict %}checked{% endif %}>
                            <label for="show_publicacoes" class="form-check-label">
                                <strong><i class="fas fa-file-alt me-2"></i>Publicações</strong>
                                <small class="text-muted d-block">Menu principal de publicações e documentos</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Publicações -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_notas" id="show_notas" 
                                       {% if 'show_notas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_notas" class="form-check-label">
                                    <i class="fas fa-file-alt me-2"></i>Notas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_boletins_ostensivos" id="show_boletins_ostensivos" 
                                       {% if 'show_boletins_ostensivos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_boletins_ostensivos" class="form-check-label">
                                    <i class="fas fa-bullhorn me-2"></i>Boletins Ostensivos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_boletins_reservados" id="show_boletins_reservados" 
                                       {% if 'show_boletins_reservados' in permissoes_dict %}checked{% endif %}>
                                <label for="show_boletins_reservados" class="form-check-label">
                                    <i class="fas fa-lock me-2"></i>Boletins Reservados
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_boletins_especiais" id="show_boletins_especiais" 
                                       {% if 'show_boletins_especiais' in permissoes_dict %}checked{% endif %}>
                                <label for="show_boletins_especiais" class="form-check-label">
                                    <i class="fas fa-star me-2"></i>Boletins Especiais
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_avisos" id="show_avisos" 
                                       {% if 'show_avisos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_avisos" class="form-check-label">
                                    <i class="fas fa-exclamation-triangle me-2"></i>Avisos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_ordens_servico" id="show_ordens_servico" 
                                       {% if 'show_ordens_servico' in permissoes_dict %}checked{% endif %}>
                                <label for="show_ordens_servico" class="form-check-label">
                                    <i class="fas fa-clipboard-check me-2"></i>Ordens de Serviço
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 7. ESCALAS DE SERVIÇO -->
            <div class="card mb-2">
                <div class="card-header" id="headingEscalas">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEscalas" aria-expanded="false" aria-controls="collapseEscalas">
                                <span><i class="fas fa-calendar-alt text-primary"></i> Escalas de Serviço</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-escalas" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-escalas" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseEscalas" class="collapse" aria-labelledby="headingEscalas" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Escalas -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas" id="show_escalas" 
                                   {% if 'show_escalas' in permissoes_dict %}checked{% endif %}>
                            <label for="show_escalas" class="form-check-label">
                                <strong><i class="fas fa-calendar-alt me-2"></i>Escalas de Serviço</strong>
                                <small class="text-muted d-block">Menu principal de gestão de escalas e serviços</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Escalas -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas_dashboard" id="show_escalas_dashboard" 
                                       {% if 'show_escalas_dashboard' in permissoes_dict %}checked{% endif %}>
                                <label for="show_escalas_dashboard" class="form-check-label">
                                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard de Escalas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas_lista" id="show_escalas_lista" 
                                       {% if 'show_escalas_lista' in permissoes_dict %}checked{% endif %}>
                                <label for="show_escalas_lista" class="form-check-label">
                                    <i class="fas fa-list me-2"></i>Lista de Escalas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas_configuracao" id="show_escalas_configuracao" 
                                       {% if 'show_escalas_configuracao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_escalas_configuracao" class="form-check-label">
                                    <i class="fas fa-cog me-2"></i>Configurações de Escalas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas_banco_horas" id="show_escalas_banco_horas" 
                                       {% if 'show_escalas_banco_horas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_escalas_banco_horas" class="form-check-label">
                                    <i class="fas fa-clock me-2"></i>Banco de Horas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_escalas_operacoes" id="show_escalas_operacoes" 
                                       {% if 'show_escalas_operacoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_escalas_operacoes" class="form-check-label">
                                    <i class="fas fa-tasks me-2"></i>Operações de Escalas
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 8. OPERAÇÕES PLANEJADAS -->
            <div class="card mb-2">
                <div class="card-header" id="headingPlanejadas">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePlanejadas" aria-expanded="false" aria-controls="collapsePlanejadas">
                                <span><i class="fas fa-money-bill-wave text-primary"></i> Operações Planejadas</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-planejadas" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-planejadas" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapsePlanejadas" class="collapse" aria-labelledby="headingPlanejadas" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Planejadas -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_planejadas" id="show_planejadas" 
                                   {% if 'show_planejadas' in permissoes_dict %}checked{% endif %}>
                            <label for="show_planejadas" class="form-check-label">
                                <strong><i class="fas fa-money-bill-wave me-2"></i>Operações Planejadas</strong>
                                <small class="text-muted d-block">Menu principal de operações planejadas</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Planejadas -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_operador_planejadas" id="show_operador_planejadas" 
                                       {% if 'show_operador_planejadas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_operador_planejadas" class="form-check-label">
                                    <i class="fas fa-list me-2"></i>Operações Planejadas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_fiscal_planejadas" id="show_fiscal_planejadas" 
                                       {% if 'show_fiscal_planejadas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_fiscal_planejadas" class="form-check-label">
                                    <i class="fas fa-chart-pie me-2"></i>Orçamentos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_liquidacao" id="show_liquidacao" 
                                       {% if 'show_liquidacao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_liquidacao" class="form-check-label">
                                    <i class="fas fa-file-invoice-dollar me-2"></i>Liquidação
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 9. CONFIGURAÇÕES/SISTEMA -->
            <div class="card mb-2">
                <div class="card-header" id="headingConfiguracoes">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConfiguracoes" aria-expanded="false" aria-controls="collapseConfiguracoes">
                                <span><i class="fas fa-cog text-primary"></i> Configurações</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-configuracoes" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-configuracoes" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseConfiguracoes" class="collapse" aria-labelledby="headingConfiguracoes" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Configurações -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_configuracoes" id="show_configuracoes" 
                                   {% if 'show_configuracoes' in permissoes_dict %}checked{% endif %}>
                            <label for="show_configuracoes" class="form-check-label">
                                <strong><i class="fas fa-cog me-2"></i>Configurações</strong>
                                <small class="text-muted d-block">Menu principal de configurações do sistema</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Configurações -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_intersticios" id="show_intersticios" 
                                       {% if 'show_intersticios' in permissoes_dict %}checked{% endif %}>
                                <label for="show_intersticios" class="form-check-label">
                                    <i class="fas fa-hourglass-half me-2"></i>Interstícios
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_gerenciar_intersticios" id="show_gerenciar_intersticios" 
                                       {% if 'show_gerenciar_intersticios' in permissoes_dict %}checked{% endif %}>
                                <label for="show_gerenciar_intersticios" class="form-check-label">
                                    <i class="fas fa-edit me-2"></i>Gerenciar Interstícios
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_gerenciar_previsao" id="show_gerenciar_previsao" 
                                       {% if 'show_gerenciar_previsao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_gerenciar_previsao" class="form-check-label">
                                    <i class="fas fa-chart-line me-2"></i>Gerenciar Previsão de Vagas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_usuarios" id="show_usuarios" 
                                       {% if 'show_usuarios' in permissoes_dict %}checked{% endif %}>
                                <label for="show_usuarios" class="form-check-label">
                                    <i class="fas fa-users-cog me-2"></i>Gerenciar Usuários
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_permissoes" id="show_permissoes" 
                                       {% if 'show_permissoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_permissoes" class="form-check-label">
                                    <i class="fas fa-user-tie me-2"></i>Funções Militares
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_orgaos" id="show_orgaos" 
                                       {% if 'show_orgaos' in permissoes_dict %}checked{% endif %}>
                                <label for="show_orgaos" class="form-check-label">
                                    <i class="fas fa-building me-2"></i>Órgãos
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_organograma" id="show_organograma" 
                                       {% if 'show_organograma' in permissoes_dict %}checked{% endif %}>
                                <label for="show_organograma" class="form-check-label">
                                    <i class="fas fa-sitemap me-2"></i>Organograma
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_logs" id="show_logs" 
                                       {% if 'show_logs' in permissoes_dict %}checked{% endif %}>
                                <label for="show_logs" class="form-check-label">
                                    <i class="fas fa-file-alt me-2"></i>Logs do Sistema
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_titulos_publicacao" id="show_titulos_publicacao" 
                                       {% if 'show_titulos_publicacao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_titulos_publicacao" class="form-check-label">
                                    <i class="fas fa-file-alt me-2"></i>Títulos de Publicações
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_administracao" id="show_administracao" 
                                       {% if 'show_administracao' in permissoes_dict %}checked{% endif %}>
                                <label for="show_administracao" class="form-check-label">
                                    <i class="fas fa-cog me-2"></i>Administração
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 10. RELATÓRIOS -->
            <div class="card mb-2">
                <div class="card-header" id="headingRelatorios">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <button class="btn btn-link text-left d-flex align-items-center collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRelatorios" aria-expanded="false" aria-controls="collapseRelatorios">
                                <span><i class="fas fa-chart-bar text-primary"></i> Relatórios</span>
                                <i class="fas fa-chevron-down ms-2"></i>
                            </button>
                        </h6>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success btn-sm" id="select-all-relatorios" data-bs-toggle="tooltip" title="Selecionar todos">
                                <i class="fas fa-check-square"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm" id="deselect-all-relatorios" data-bs-toggle="tooltip" title="Desmarcar todos">
                                <i class="fas fa-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="collapseRelatorios" class="collapse" aria-labelledby="headingRelatorios" data-bs-parent="#mainAccordion">
                    <div class="card-body">
                        <!-- Menu Principal Relatórios -->
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios" id="show_relatorios" 
                                   {% if 'show_relatorios' in permissoes_dict %}checked{% endif %}>
                            <label for="show_relatorios" class="form-check-label">
                                <strong><i class="fas fa-chart-bar me-2"></i>Relatórios</strong>
                                <small class="text-muted d-block">Menu principal de relatórios e estatísticas</small>
                            </label>
                        </div>
                        
                        <!-- Submenus Relatórios -->
                        <div class="ms-4">
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios_militares" id="show_relatorios_militares" 
                                       {% if 'show_relatorios_militares' in permissoes_dict %}checked{% endif %}>
                                <label for="show_relatorios_militares" class="form-check-label">
                                    <i class="fas fa-users me-2"></i>Relatórios de Militares
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios_promocoes" id="show_relatorios_promocoes" 
                                       {% if 'show_relatorios_promocoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_relatorios_promocoes" class="form-check-label">
                                    <i class="fas fa-graduation-cap me-2"></i>Relatórios de Promoções
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios_medalhas" id="show_relatorios_medalhas" 
                                       {% if 'show_relatorios_medalhas' in permissoes_dict %}checked{% endif %}>
                                <label for="show_relatorios_medalhas" class="form-check-label">
                                    <i class="fas fa-medal me-2"></i>Relatórios de Medalhas
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios_publicacoes" id="show_relatorios_publicacoes" 
                                       {% if 'show_relatorios_publicacoes' in permissoes_dict %}checked{% endif %}>
                                <label for="show_relatorios_publicacoes" class="form-check-label">
                                    <i class="fas fa-file-alt me-2"></i>Relatórios de Publicações
                                </label>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input permission-checkbox" name="show_relatorios_gerais" id="show_relatorios_gerais" 
                                       {% if 'show_relatorios_gerais' in permissoes_dict %}checked{% endif %}>
                                <label for="show_relatorios_gerais" class="form-check-label">
                                    <i class="fas fa-chart-pie me-2"></i>Relatórios Gerais
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botões de Ação -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <button type="button" class="btn btn-outline-primary" id="select-all" data-bs-toggle="tooltip" title="Selecionar todas as permissões">
                            <i class="fas fa-check-square"></i> Selecionar Todos
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="deselect-all" data-bs-toggle="tooltip" title="Desmarcar todas as permissões">
                            <i class="fas fa-square"></i> Desmarcar Todos
                        </button>
                        <button type="button" class="btn btn-outline-warning" id="force-hide-loading" data-bs-toggle="tooltip" title="Remover loading se estiver travado">
                            <i class="fas fa-times-circle"></i> Remover Loading
                        </button>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-success" data-bs-toggle="tooltip" title="Salvar todas as permissões selecionadas (Ctrl+S)">
                            <i class="fas fa-save"></i> Salvar Permissões
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Aguardar o DOM estar pronto
document.addEventListener('DOMContentLoaded', function() {
    
    // Função para expandir todos os acordeons
    document.getElementById('expand-all-page').addEventListener('click', function() {
        const collapses = document.querySelectorAll('.collapse');
        collapses.forEach(collapse => {
            const bsCollapse = new bootstrap.Collapse(collapse, { show: true });
        });
    });
    
    // Função para colapsar todos os acordeons
    document.getElementById('collapse-all-page').addEventListener('click', function() {
        const collapses = document.querySelectorAll('.collapse.show');
        collapses.forEach(collapse => {
            const bsCollapse = new bootstrap.Collapse(collapse, { hide: true });
        });
    });
    
    // Função para selecionar todos os checkboxes
    document.getElementById('select-all').addEventListener('click', function() {
        const checkboxes = document.querySelectorAll('.permission-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = true;
        });
        atualizarEstatisticas();
    });
    
    // Função para desmarcar todos os checkboxes
    document.getElementById('deselect-all').addEventListener('click', function() {
        const checkboxes = document.querySelectorAll('.permission-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        atualizarEstatisticas();
    });
    
    // Função para atualizar estatísticas
    function atualizarEstatisticas() {
        const totalCheckboxes = document.querySelectorAll('.permission-checkbox').length;
        const checkedCheckboxes = document.querySelectorAll('.permission-checkbox:checked').length;
        
        document.getElementById('total-permissoes').textContent = totalCheckboxes;
        document.getElementById('permissoes-ativas').textContent = checkedCheckboxes;
    }
    
    // Atualizar estatísticas quando checkboxes mudarem
    document.querySelectorAll('.permission-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', atualizarEstatisticas);
    });
    
    // Atualizar estatísticas inicial
    atualizarEstatisticas();
    
    // Atalho de teclado Ctrl+S para salvar
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            document.getElementById('permissions-form').submit();
        }
    });
    
    // Debug: Verificar campos antes do envio
    document.getElementById('permissions-form').addEventListener('submit', function(e) {
        console.log('🔍 Debug: Formulário sendo enviado...');
        
        const checkboxes = document.querySelectorAll('.permission-checkbox:checked');
        console.log(`📊 Total de checkboxes marcados: ${checkboxes.length}`);
        
        checkboxes.forEach(checkbox => {
            console.log(`✅ Campo marcado: ${checkbox.name} = ${checkbox.value}`);
        });
        
        // Verificar se há campos marcados
        if (checkboxes.length === 0) {
            console.log('⚠️ Nenhum campo marcado!');
        }
    });
    
    // Função para remover loading se estiver travado
    document.getElementById('force-hide-loading').addEventListener('click', function() {
        const loadingElements = document.querySelectorAll('.loading, .spinner-border, .spinner-grow');
        loadingElements.forEach(element => {
            element.style.display = 'none';
        });
    });
    
    // Botões de seleção por seção
    const sections = ['inicio', 'pessoal', 'efetivo', 'promocoes', 'medalhas', 'publicacoes', 'escalas', 'planejadas', 'configuracoes', 'relatorios'];
    
    sections.forEach(section => {
        // Selecionar todos da seção
        const selectAllBtn = document.getElementById(`select-all-${section}`);
        if (selectAllBtn) {
            selectAllBtn.addEventListener('click', function() {
                const sectionCheckboxes = document.querySelectorAll(`#collapse${section.charAt(0).toUpperCase() + section.slice(1)} .permission-checkbox`);
                sectionCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                atualizarEstatisticas();
            });
        }
        
        // Desmarcar todos da seção
        const deselectAllBtn = document.getElementById(`deselect-all-${section}`);
        if (deselectAllBtn) {
            deselectAllBtn.addEventListener('click', function() {
                const sectionCheckboxes = document.querySelectorAll(`#collapse${section.charAt(0).toUpperCase() + section.slice(1)} .permission-checkbox`);
                sectionCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                atualizarEstatisticas();
            });
        }
    });
});
</script>
{% endblock %}
