{% load static %}

<div class="modal-header bg-warning text-dark">
    <h5 class="modal-title" id="modalAfastamentoDetailLabel">
        <i class="fas fa-ban me-2"></i>Detalhes do Afastamento
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
    <div class="row mb-3">
        <div class="col-md-6">
            <strong>Militar:</strong><br>
            <div class="d-flex align-items-center mt-2">
                {% if afastamento.militar.foto %}
                    <img src="{{ afastamento.militar.foto.url }}" alt="Foto" class="rounded me-2" style="width: 60px; height: 60px; object-fit: cover;">
                {% else %}
                    <div class="bg-light rounded d-flex align-items-center justify-content-center me-2" style="width: 60px; height: 60px;">
                        <i class="fas fa-user text-muted"></i>
                    </div>
                {% endif %}
                <div>
                    <strong>{{ afastamento.militar.get_posto_graduacao_display }} {{ afastamento.militar.nome_completo }}</strong><br>
                    <small class="text-muted">
                        {% if afastamento.militar.cpf %}
                            CPF: {{ afastamento.militar.cpf }}
                        {% else %}
                            CPF: -
                        {% endif %}
                    </small><br>
                    <small class="text-muted">Matrícula: {{ afastamento.militar.matricula }}</small>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <strong>Status:</strong><br>
            {% if afastamento.status == 'ATIVO' %}
                <span class="badge bg-success mt-2" style="font-size: 1rem;">{{ afastamento.status_display }}</span>
            {% elif afastamento.status == 'ENCERRADO' %}
                <span class="badge bg-secondary mt-2" style="font-size: 1rem;">{{ afastamento.status_display }}</span>
            {% elif afastamento.status == 'CANCELADO' %}
                <span class="badge bg-danger mt-2" style="font-size: 1rem;">{{ afastamento.status_display }}</span>
            {% endif %}
        </div>
    </div>
    
    <hr>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <strong>Situação:</strong><br>
            <span class="text-primary">{{ afastamento.get_tipo_afastamento_display }}</span>
        </div>
        <div class="col-md-6 mb-3">
            <strong>Data de Início:</strong><br>
            {{ afastamento.data_inicio|date:"d/m/Y" }}
        </div>
        <div class="col-md-6 mb-3">
            <strong>Data de Fim Prevista:</strong><br>
            {% if afastamento.data_fim_prevista %}
                {{ afastamento.data_fim_prevista|date:"d/m/Y" }}
            {% else %}
                <span class="text-muted">Não informada</span>
            {% endif %}
        </div>
        <div class="col-md-6 mb-3">
            <strong>Data de Fim Real:</strong><br>
            {% if afastamento.data_fim_real %}
                {{ afastamento.data_fim_real|date:"d/m/Y" }}
            {% else %}
                <span class="text-muted">Não informada</span>
            {% endif %}
        </div>
        <div class="col-md-12 mb-3">
            <strong>Duração:</strong><br>
            <span class="fw-bold text-primary">{{ afastamento.duracao_formatada }}</span>
            <span class="badge bg-info ms-2">{{ dias_afastamento }} dias</span>
        </div>
    </div>
    
    <hr>
    
    <div class="mb-3">
        <strong>Motivo do Afastamento:</strong><br>
        <div class="bg-light p-3 rounded mt-2">
            {{ afastamento.motivo|linebreaks }}
        </div>
    </div>
    
    {% if afastamento.observacoes %}
    <div class="mb-3">
        <strong>Observações:</strong><br>
        <div class="bg-light p-3 rounded mt-2">
            {{ afastamento.observacoes|linebreaks }}
        </div>
    </div>
    {% endif %}
    
    {% if afastamento.documento_referencia or afastamento.numero_documento %}
    <hr>
    <div class="row">
        {% if afastamento.documento_referencia %}
        <div class="col-md-6 mb-3">
            <strong>Documento de Referência:</strong><br>
            {{ afastamento.documento_referencia }}
        </div>
        {% endif %}
        {% if afastamento.numero_documento %}
        <div class="col-md-6 mb-3">
            <strong>Número do Documento:</strong><br>
            {{ afastamento.numero_documento }}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <hr>
    
    <div class="row mb-3">
        <div class="col-md-6">
            <strong>Cadastrado por:</strong><br>
            {% if afastamento.cadastrado_por %}
                {{ afastamento.cadastrado_por.get_full_name|default:afastamento.cadastrado_por.username }}
            {% else %}
                <span class="text-muted">Não informado</span>
            {% endif %}
        </div>
        <div class="col-md-6">
            <strong>Data de Cadastro:</strong><br>
            {{ afastamento.data_cadastro|date:"d/m/Y H:i" }}
        </div>
    </div>
    
    <div class="mb-3">
        <strong>Última Atualização:</strong><br>
        {{ afastamento.data_atualizacao|date:"d/m/Y H:i" }}
    </div>
    
    <!-- Seção de Documentos -->
    {% if documentos %}
    <hr>
    <div class="mb-3">
        <h6 class="mb-3">
            <i class="fas fa-file-alt me-2"></i>Documentos Anexados
            <span class="badge bg-secondary ms-2">{{ documentos|length }}</span>
        </h6>
        <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-sm table-hover">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Título</th>
                        <th>Descrição</th>
                        <th>Arquivo</th>
                        <th>Upload por</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody>
                    {% for documento in documentos %}
                    <tr>
                        <td><span class="badge bg-info">{{ documento.get_tipo_display }}</span></td>
                        <td><strong>{{ documento.titulo }}</strong></td>
                        <td>{{ documento.descricao|default:"-" }}</td>
                        <td>
                            <a href="{{ documento.arquivo.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-download me-1"></i>Download
                            </a>
                        </td>
                        <td>{{ documento.upload_por.get_full_name|default:documento.upload_por.username }}</td>
                        <td>{{ documento.data_upload|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <hr>
    <div class="alert alert-info text-center mb-0">
        <i class="fas fa-info-circle me-2"></i>
        Nenhum documento anexado ainda.
    </div>
    {% endif %}
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
        <i class="fas fa-times me-2"></i>Fechar
    </button>
    {% if menu_permissions.BOTAO_AFASTAMENTO_EDITAR or user.is_superuser %}
    <button type="button" class="btn btn-primary" onclick="fecharEcarregarFormAfastamento({{ afastamento.pk }})">
        <i class="fas fa-edit me-2"></i>Editar
    </button>
    {% endif %}
    {% if user.is_superuser %}
    <button type="button" class="btn btn-danger" 
            data-bs-toggle="modal" data-bs-target="#excluirAfastamentoModal"
            data-afastamento-id="{{ afastamento.pk }}"
            data-afastamento-url="{% url 'militares:afastamento_delete' afastamento.pk %}"
            data-bs-dismiss="modal">
        <i class="fas fa-trash me-2"></i>Excluir
    </button>
    {% endif %}
    <a href="{% url 'militares:militar_detail' afastamento.militar.pk %}" class="btn btn-outline-info" target="_blank">
        <i class="fas fa-user me-2"></i>Ver Ficha do Militar
    </a>
</div>

