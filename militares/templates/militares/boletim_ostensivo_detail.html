{% extends 'base.html' %}
{% load static %}

{% block title %}Boletim Ostensivo: {{ boletim.numero }}{% endblock %}

{% block extra_css %}
<style>
    .nota-card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    
    .nota-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .nota-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 15px;
        border-radius: 8px 8px 0 0;
    }
    
    .nota-body {
        padding: 20px;
        background: white;
    }
    
    .nota-actions {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 0 0 8px 8px;
        border-top: 1px solid #dee2e6;
    }
    
    .btn-action {
        margin: 2px;
        font-size: 0.85em;
    }
    
    .boletim-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    
    .stats-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Cabe√ßalho do Boletim -->
            <div class="boletim-header text-center">
                <h1 class="mb-3">
                    <i class="fas fa-bullhorn me-2"></i>
                    Boletim Ostensivo {{ boletim.numero }}
                </h1>
                <h4 class="mb-2">{{ boletim.titulo }}</h4>
                {% if boletim.topicos %}
                <p class="mb-0">
                    <i class="fas fa-tags me-1"></i>
                    {{ boletim.topicos }}
                </p>
                {% endif %}
            </div>
            
            <!-- Estat√≠sticas -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="stats-card text-center">
                        <h3 class="text-primary">{{ notas_incluidas.count }}</h3>
                        <p class="mb-0">Notas Inclu√≠das</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card text-center">
                        <h3 class="text-success">{{ notas_disponiveis.count }}</h3>
                        <p class="mb-0">Notas Dispon√≠veis</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stats-card text-center">
                        <h3 class="text-info">{{ boletim.data_criacao|date:"d/m/Y" }}</h3>
                        <p class="mb-0">Data de Cria√ß√£o</p>
                    </div>
                </div>
            </div>
            
            <!-- Conte√∫do do Boletim com Notas -->
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-file-alt text-primary me-2"></i>
                        Conte√∫do do Boletim
                    </h4>
                </div>
                <div class="card-body">
                    <!-- Cabe√ßalho Oficial do Boletim -->
                    <div class="text-center mb-4">
                        <h1 class="mb-1" style="font-size: 12px; font-weight: bold;">ESTADO DO PIAU√ç</h1>
                        <h2 class="mb-1" style="font-size: 12px; font-weight: bold;">CORPO DE BOMBEIROS MILITAR</h2>
                        <h3 class="mb-1" style="font-size: 12px; font-weight: bold;">QUARTEL DO COMANDO GERAL</h3>
                        <h4 class="mb-1" style="font-size: 12px; font-weight: bold;">AJUD√ÇNCIA GERAL</h4>
                        <h5 class="mb-1" style="font-size: 12px; font-weight: bold;">-</h5>
                        <h6 class="mb-0" style="font-size: 12px; font-weight: bold;">-</h6>
                        <hr style="border-top: 2px solid #333; margin: 20px 0;">
                    </div>
                    
                    <!-- T√≥picos do Boletim -->
                    {% if boletim.topicos %}
                    <div class="text-center mb-4">
                        <h4 style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">{{ boletim.topicos }}</h4>
                    </div>
                    {% endif %}
                    
                    <!-- N√∫mero e T√≠tulo -->
                    <div class="text-center mb-4">
                        <h4 style="font-size: 14px; font-weight: bold; margin-bottom: 5px;">{{ boletim.numero }}</h4>
                        <h5 style="font-size: 13px; font-weight: bold; margin-bottom: 15px;">{{ boletim.titulo }}</h5>
                    </div>
                    
                    <!-- Conte√∫do do Boletim com Notas Formatadas -->
                    <div class="conteudo-boletim" style="line-height: 1.2; font-size: 0.9em; word-wrap: break-word; margin: 0; font-family: 'Times New Roman', serif;">
                        {{ boletim.conteudo|safe }}
                    </div>
                    
                    <!-- Notas com Bot√µes de A√ß√£o -->
                    {% if notas_incluidas %}
                        <div class="mt-4">
                            <h5 class="mb-3">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Notas Inclu√≠das no Boletim
                            </h5>
                            {% for nota in notas_incluidas %}
                            <div class="nota-card">
                                <div class="nota-header">
                                    <h5 class="mb-0">
                                        <i class="fas fa-file-alt me-2"></i>
                                        {{ nota.numero }} - {{ nota.titulo }}
                                    </h5>
                                </div>
                                <div class="nota-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-calendar me-1"></i>
                                                <strong>Data:</strong> {{ nota.data_publicacao|date:"d/m/Y H:i"|default:"-" }}
                                            </small>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">
                                                <i class="fas fa-building me-1"></i>
                                                <strong>Origem:</strong> {{ nota.origem_publicacao|default:"-" }}
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="conteudo-nota">
                                        {{ nota.conteudo|truncatewords:30|safe }}
                                    </div>
                                </div>
                                <div class="nota-actions">
                                    <div class="d-flex flex-wrap gap-2">
                                        {% if not boletim.data_disponibilizacao %}
                                        <button onclick="devolverNotaOrigem('{{ nota.numero }}', {{ nota.id }})" 
                                                class="btn btn-warning btn-sm btn-action" 
                                                title="Devolver para origem">
                                            <i class="fas fa-undo me-1"></i> Devolver
                                        </button>
                                        
                                        <button onclick="editarNotaBoletim({{ nota.id }})" 
                                                class="btn btn-primary btn-sm btn-action" 
                                                title="Editar nota">
                                            <i class="fas fa-edit me-1"></i> Editar
                                        </button>
                                        
                                        <button onclick="transferirNotaBoletim('{{ nota.numero }}', {{ nota.id }})" 
                                                class="btn btn-secondary btn-sm btn-action" 
                                                title="Transferir para outro boletim">
                                            <i class="fas fa-exchange-alt me-1"></i> Transferir
                                        </button>
                                        {% endif %}
                                        
                                        <button onclick="visualizarNotaModal({{ nota.id }})" 
                                                class="btn btn-info btn-sm btn-action" 
                                                title="Visualizar nota">
                                            <i class="fas fa-eye me-1"></i> Visualizar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Nenhuma nota inclu√≠da no boletim</h5>
                            <p class="text-muted">Use o bot√£o "Gerenciar Notas" para adicionar notas ao boletim.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="text-center mt-4">
                <a href="{% url 'militares:boletins_ostensivos_list' %}" class="btn btn-secondary me-2">
                    <i class="fas fa-arrow-left me-2"></i>
                    Voltar √† Lista
                </a>
                
                <button onclick="abrirModalGerenciarNotas({{ boletim.pk }}, '{{ boletim.titulo }}', '{{ boletim.topicos }}')" 
                        class="btn btn-primary me-2">
                    <i class="fas fa-cogs me-2"></i>
                    Gerenciar Notas
                </button>
                
                <a href="{% url 'militares:publicacao_edit' boletim.pk %}" class="btn btn-warning">
                    <i class="fas fa-edit me-2"></i>
                    Editar Boletim
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Visualizar Nota -->
<div class="modal fade" id="visualizarNotaModal" tabindex="-1" aria-labelledby="visualizarNotaModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content shadow-lg" style="border: none; border-radius: 8px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; border-radius: 8px 8px 0 0; padding: 1rem 1.5rem;">
                <div class="d-flex align-items-center">
                    <i class="fas fa-file-alt me-3" style="font-size: 1.5rem;"></i>
                    <h5 class="modal-title mb-0" id="visualizarNotaModalLabel">
                        Visualizar Publica√ß√£o
                    </h5>
                </div>
                <div class="d-flex align-items-center gap-2">
                    {% if not boletim.data_disponibilizacao %}
                    <button type="button" class="btn btn-light btn-sm" title="Editar Nota" onclick="editarNotaModal()" id="btnEditarNota" style="display: none;">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-light btn-sm" title="Salvar Altera√ß√µes" onclick="console.log('üîß BOT√ÉO SALVAR CLICADO!'); testarSalvamento();" id="btnSalvarNota" style="display: none;">
                        <i class="fas fa-save"></i>
                    </button>
                    <button type="button" class="btn btn-light btn-sm" title="Cancelar Edi√ß√£o" onclick="cancelarEdicaoModal()" id="btnCancelarEdicao" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                    <button type="button" class="btn btn-light btn-sm" title="Devolver Publica√ß√£o" onclick="devolverNota()">
                        <i class="fas fa-undo"></i>
                    </button>
                    {% endif %}
                    <button type="button" class="btn btn-light btn-sm" title="Imprimir Publica√ß√£o" onclick="imprimirNota()">
                        <i class="fas fa-print"></i>
                    </button>
                    <button type="button" class="btn btn-light btn-sm" title="Arquivar Publica√ß√£o" onclick="arquivarNota()">
                        <i class="fas fa-archive"></i>
                    </button>
                    <button type="button" class="btn-close btn-close-white ms-2" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-body" style="max-height: 80vh; overflow-y: auto; padding: 0; background: #ffffff;">
                <div id="conteudoNotaModal">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-3 text-muted">Carregando conte√∫do da nota...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Gerenciar Notas do Boletim -->
<div class="modal fade" id="gerenciarNotasModal" tabindex="-1" aria-labelledby="gerenciarNotasModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="gerenciarNotasModalLabel">
                    <i class="fas fa-cogs text-primary"></i>
                    Gerenciar Notas do Boletim
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- T√≥picos do Boletim -->
                <div class="text-center mb-4" id="topicosBoletimSection" style="display: none;">
                    <div class="bg-light p-3 rounded">
                        <h6 style="font-size: 12px; font-weight: bold; margin: 0;" id="topicosBoletim">-</h6>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">
                            <i class="fas fa-plus-circle"></i>
                            Notas Dispon√≠veis
                        </h6>
                        <div id="notasDisponiveis" class="border rounded p-3" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin"></i>
                                Carregando notas...
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6 class="text-success">
                            <i class="fas fa-check-circle"></i>
                            Notas Inclu√≠das
                        </h6>
                        <div id="notasIncluidas" class="border rounded p-3" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin"></i>
                                Carregando notas...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Fechar
                </button>
            </div>
        </div>
    </div>
</div>

<script>
console.log('üîß Script do boletim carregado!');

let boletimAtualId = null;

function abrirModalGerenciarNotas(boletimId, titulo, topicos) {
    boletimAtualId = boletimId;
    document.getElementById('gerenciarNotasModalLabel').innerHTML = 
        `<i class="fas fa-cogs text-primary"></i> Gerenciar Notas - ${titulo}`;
    
    // Exibir t√≥picos do boletim
    const topicosElement = document.getElementById('topicosBoletim');
    const topicosSection = document.getElementById('topicosBoletimSection');
    
    if (topicosElement && topicosSection) {
        if (topicos && topicos.trim() !== '') {
            topicosElement.textContent = topicos;
            topicosSection.style.display = 'block';
        } else {
            topicosSection.style.display = 'none';
        }
    }
    
    // Carregar notas dispon√≠veis e inclu√≠das
    carregarNotasDisponiveis(boletimId, topicos);
    carregarNotasIncluidas(boletimId);
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('gerenciarNotasModal'));
    
    // Adicionar evento para recarregar a p√°gina quando o modal for fechado
    document.getElementById('gerenciarNotasModal').addEventListener('hidden.bs.modal', function () {
        location.reload();
    });
    
    modal.show();
}

function carregarNotasDisponiveis(boletimId, topicos) {
    fetch(`/militares/ajax/notas-disponiveis-boletim/?boletim_id=${boletimId}&topicos=${encodeURIComponent(topicos)}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('notasDisponiveis');
            if (data.notas && data.notas.length > 0) {
                container.innerHTML = data.notas.map(nota => {
                    if (nota.pode_incluir) {
                        return `
                            <div class="card mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1">${nota.numero} - ${nota.titulo}</h6>
                                    <p class="card-text small text-muted mb-2">
                                        ${nota.data_publicacao ? new Date(nota.data_publicacao).toLocaleDateString('pt-BR') : 'N/A'}
                                    </p>
                                    <button class="btn btn-sm btn-success" onclick="adicionarNotaBoletim(${boletimId}, ${nota.id})">
                                        <i class="fas fa-plus"></i> Adicionar
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="card mb-2 border-warning">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1 text-muted">${nota.numero} - ${nota.titulo}</h6>
                                    <p class="card-text small text-muted mb-2">
                                        ${nota.data_publicacao ? new Date(nota.data_publicacao).toLocaleDateString('pt-BR') : 'N/A'}
                                    </p>
                                    <div class="alert alert-warning py-2 mb-2">
                                        <small><i class="fas fa-exclamation-triangle"></i> ${nota.motivo_rejeicao}</small>
                                    </div>
                                    <button class="btn btn-sm btn-secondary" disabled>
                                        <i class="fas fa-ban"></i> N√£o Dispon√≠vel
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            } else {
                container.innerHTML = '<div class="text-center text-muted">Nenhuma nota dispon√≠vel</div>';
            }
        })
        .catch(error => {
            console.error('Erro ao carregar notas dispon√≠veis:', error);
            document.getElementById('notasDisponiveis').innerHTML = 
                '<div class="text-center text-danger">Erro ao carregar notas</div>';
        });
}

function carregarNotasIncluidas(boletimId) {
    fetch(`/militares/ajax/notas-incluidas-boletim/?boletim_id=${boletimId}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('notasIncluidas');
            if (data.notas && data.notas.length > 0) {
                container.innerHTML = data.notas.map(nota => `
                    <div class="card mb-2">
                        <div class="card-body p-2">
                            <h6 class="card-title mb-1">${nota.numero} - ${nota.titulo}</h6>
                            <p class="card-text small text-muted mb-2">
                                ${nota.data_publicacao ? new Date(nota.data_publicacao).toLocaleDateString('pt-BR') : 'N/A'}
                            </p>
                            <button class="btn btn-sm btn-danger" onclick="removerNotaBoletim(${boletimId}, ${nota.id})">
                                <i class="fas fa-minus"></i> Remover
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="text-center text-muted">Nenhuma nota inclu√≠da</div>';
            }
        })
        .catch(error => {
            console.error('Erro ao carregar notas inclu√≠das:', error);
            document.getElementById('notasIncluidas').innerHTML = 
                '<div class="text-center text-danger">Erro ao carregar notas</div>';
        });
}

function adicionarNotaBoletim(boletimId, notaId) {
    fetch(`/militares/boletins-ostensivos/${boletimId}/adicionar-nota/${notaId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Recarregar as listas
            carregarNotasDisponiveis(boletimId, document.getElementById('gerenciarNotasModalLabel').textContent.split(' - ')[1]);
            carregarNotasIncluidas(boletimId);
            
            // Mostrar mensagem de sucesso
            showToast('success', data.message);
        } else {
            showToast('error', data.message || 'Erro ao adicionar nota');
        }
    })
    .catch(error => {
        console.error('Erro ao adicionar nota:', error);
        showToast('error', 'Erro ao adicionar nota');
    });
}

function removerNotaBoletim(boletimId, notaId) {
    if (confirm('Deseja remover esta nota do boletim?')) {
        fetch(`/militares/boletins-ostensivos/${boletimId}/remover-nota/${notaId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Recarregar as listas
                carregarNotasDisponiveis(boletimId, document.getElementById('gerenciarNotasModalLabel').textContent.split(' - ')[1]);
                carregarNotasIncluidas(boletimId);
                
                // Mostrar mensagem de sucesso
                showToast('success', data.message);
            } else {
                showToast('error', data.message || 'Erro ao remover nota');
            }
        })
        .catch(error => {
            console.error('Erro ao remover nota:', error);
            showToast('error', 'Erro ao remover nota');
        });
    }
}

// Vari√°vel global para armazenar o ID da nota atual
let notaIdAtual = null;

// Fun√ß√µes para os bot√µes de a√ß√£o do modal
function imprimirNota() {
    if (notaIdAtual) {
        window.open(`/militares/notas/${notaIdAtual}/pdf/`, '_blank');
    }
}

function devolverNota() {
    if (notaIdAtual) {
        if (confirm('Tem certeza que deseja devolver esta publica√ß√£o?')) {
            // Implementar l√≥gica de devolu√ß√£o
            console.log('Devolvendo nota:', notaIdAtual);
            showToast('info', 'Funcionalidade de devolu√ß√£o em desenvolvimento');
        }
    }
}

function arquivarNota() {
    if (notaIdAtual) {
        if (confirm('Tem certeza que deseja arquivar esta publica√ß√£o?')) {
            // Implementar l√≥gica de arquivamento
            console.log('Arquivando nota:', notaIdAtual);
            showToast('info', 'Funcionalidade de arquivamento em desenvolvimento');
        }
    }
}

// Fun√ß√£o para editar nota no modal (chamada do bot√£o Editar no boletim)
window.editarNotaBoletim = function(notaId) {
    console.log('üîß EDITAR NOTA BOLETIM chamada com ID:', notaId);
    notaIdAtual = notaId;
    modoEdicao = true;
    console.log('üîß notaIdAtual definido como:', notaIdAtual);
    
    // Mostrar modal de visualiza√ß√£o
    const modal = new bootstrap.Modal(document.getElementById('visualizarNotaModal'));
    modal.show();
    
    // Mostrar/ocultar bot√µes para modo de edi√ß√£o
    document.getElementById('btnEditarNota').style.display = 'none';
    document.getElementById('btnSalvarNota').style.display = 'inline-block';
    document.getElementById('btnCancelarEdicao').style.display = 'inline-block';
    
    // Converter conte√∫do para formul√°rio edit√°vel
    converterParaFormularioEdicao();
};

// Fun√ß√£o para visualizar nota no modal
function visualizarNotaModal(notaId) {
    console.log('üîç visualizarNotaModal chamada com ID:', notaId);
    notaIdAtual = notaId;
    modoEdicao = false;
    console.log('üîç notaIdAtual definido como:', notaIdAtual);
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('visualizarNotaModal'));
    modal.show();
    
    // Resetar bot√µes para modo de visualiza√ß√£o
    document.getElementById('btnEditarNota').style.display = 'inline-block';
    document.getElementById('btnSalvarNota').style.display = 'none';
    document.getElementById('btnCancelarEdicao').style.display = 'none';
    
    // Carregar conte√∫do da nota
    console.log('üîç Carregando nota ID:', notaId);
    fetch(`/militares/notas/${notaId}/dados-assinatura/`)
        .then(response => {
            console.log('üì° Resposta recebida:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('üìä Dados da nota recebidos:', data);
            console.log('üìÑ Conte√∫do da nota:', data.nota?.conteudo);
            console.log('üìã T√≥picos da nota:', data.nota?.topicos);
            console.log('üé® Aplicando estilos do editor...');
            if (data.success) {
                const conteudo = document.getElementById('conteudoNotaModal');
                conteudo.innerHTML = `
                    <div class="boletim-content">
                        <!-- Cabe√ßalho Oficial -->
                        <div class="cabecalho-oficial">
                            <h1>ESTADO DO PIAU√ç</h1>
                            <h2>CORPO DE BOMBEIROS MILITAR</h2>
                            <h3>QUARTEL DO COMANDO GERAL</h3>
                            <h4>AJUD√ÇNCIA GERAL</h4>
                            <h5>-</h5>
                            <h6>-</h6>
                            <hr>
                        </div>
                        
                        <!-- Informa√ß√µes da Nota -->
                        <div class="boletim-info">
                            <div class="boletim-titulo">${data.nota.titulo || 'T√≠tulo n√£o definido'}</div>
                            
                            <div class="boletim-meta">
                                <div class="meta-item">
                                    <div class="meta-label">N√∫mero</div>
                                    <div class="meta-value">${data.nota.numero || 'N/A'}</div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Status</div>
                                    <div class="meta-value">
                                        <span class="status-badge status-${data.nota.status ? data.nota.status.toLowerCase() : 'rascunho'}">
                                            ${data.nota.status_display || 'Rascunho'}
                                        </span>
                                    </div>
                                </div>
                                <div class="meta-item">
                                    <div class="meta-label">Criado por</div>
                                    <div class="meta-value">${data.nota.criado_por || 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- T√≥picos da Nota -->
                        ${data.nota.topicos ? `
                            <div class="topicos-section">
                                <div class="topicos-title">
                                    <i class="fas fa-list me-2"></i>
                                    T√≥picos
                                </div>
                                <div class="topicos-content">${data.nota.topicos}</div>
                            </div>
                        ` : ''}
                        
                        <!-- Conte√∫do da Nota -->
                        <div class="notas-section">
                            <div class="notas-title">
                                <i class="fas fa-file-alt me-2"></i>
                                Conte√∫do da Nota
                            </div>
                            <div class="nota-item">
                                <div class="nota-conteudo">${data.nota.conteudo ? data.nota.conteudo : '<p class="text-center text-muted"><em>Conte√∫do n√£o dispon√≠vel</em></p>'}</div>
                            </div>
                        </div>
                        
                        <!-- Assinaturas -->
                        ${data.assinaturas && data.assinaturas.length > 0 ? `
                            <div class="notas-section">
                                <div class="notas-title">
                                    <i class="fas fa-signature me-2"></i>
                                    Assinaturas Eletr√¥nicas
                                </div>
                                ${data.assinaturas.map(assinatura => `
                                    <div class="nota-item">
                                        <div class="nota-header">
                                            <div class="nota-titulo">${assinatura.assinado_por}</div>
                                            <div class="nota-data">${new Date(assinatura.data_assinatura).toLocaleDateString('pt-BR')} √†s ${new Date(assinatura.data_assinatura).toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
                                        </div>
                                        <div class="nota-conteudo">
                                            <strong>Fun√ß√£o:</strong> ${assinatura.funcao_assinatura || 'Fun√ß√£o n√£o registrada'}<br>
                                            <strong>Tipo:</strong> ${assinatura.tipo_assinatura_display || 'N/A'}<br>
                                            ${assinatura.observacoes ? `<strong>Observa√ß√µes:</strong> ${assinatura.observacoes}` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Atualizar t√≠tulo do modal
                document.getElementById('visualizarNotaModalLabel').innerHTML = 
                    `<i class="fas fa-file-alt me-2"></i> ${data.nota.numero} - ${data.nota.titulo}`;
                
                // Adicionar estilos da p√°gina de visualiza√ß√£o do boletim ostensivo
                const style = document.createElement('style');
                style.textContent = `
                    /* Estilos da p√°gina de visualiza√ß√£o do boletim ostensivo */
                    #conteudoNotaModal .boletim-content {
                        padding: 30px;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial {
                        text-align: center;
                        margin-bottom: 30px;
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h1 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h2 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h3 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h4 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h5 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial h6 {
                        font-size: 14px;
                        font-weight: bold;
                        margin-bottom: 5px;
                        color: #333;
                    }
                    
                    #conteudoNotaModal .cabecalho-oficial hr {
                        border-top: 2px solid #333;
                        margin: 20px 0;
                    }
                    
                    #conteudoNotaModal .boletim-info {
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        margin-bottom: 20px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    }
                    
                    #conteudoNotaModal .boletim-titulo {
                        font-size: 1.8rem;
                        font-weight: bold;
                        color: #2c3e50;
                        margin-bottom: 15px;
                        text-align: center;
                        border-bottom: 3px solid #3498db;
                        padding-bottom: 10px;
                    }
                    
                    #conteudoNotaModal .boletim-meta {
                        display: flex;
                        justify-content: space-between;
                        flex-wrap: wrap;
                        gap: 15px;
                        margin-bottom: 20px;
                    }
                    
                    #conteudoNotaModal .meta-item {
                        background: #f8f9fa;
                        padding: 10px 15px;
                        border-radius: 8px;
                        border-left: 4px solid #3498db;
                    }
                    
                    #conteudoNotaModal .meta-label {
                        font-weight: bold;
                        color: #666;
                        font-size: 0.9rem;
                        margin-bottom: 5px;
                    }
                    
                    #conteudoNotaModal .meta-value {
                        color: #333;
                        font-size: 1rem;
                    }
                    
                    #conteudoNotaModal .topicos-section {
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        margin-bottom: 20px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    }
                    
                    #conteudoNotaModal .topicos-title {
                        font-size: 1.2rem;
                        font-weight: bold;
                        color: #2c3e50;
                        margin-bottom: 15px;
                        border-bottom: 2px solid #e74c3c;
                        padding-bottom: 8px;
                    }
                    
                    #conteudoNotaModal .topicos-content {
                        font-size: 1rem;
                        line-height: 1.6;
                        color: #444;
                        white-space: pre-line;
                    }
                    
                    #conteudoNotaModal .notas-section {
                        background: white;
                        padding: 20px;
                        border-radius: 10px;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                        margin-bottom: 20px;
                    }
                    
                    #conteudoNotaModal .notas-title {
                        font-size: 1.2rem;
                        font-weight: bold;
                        color: #2c3e50;
                        margin-bottom: 15px;
                        border-bottom: 2px solid #27ae60;
                        padding-bottom: 8px;
                    }
                    
                    #conteudoNotaModal .nota-item {
                        background: #f8f9fa;
                        border: 1px solid #e9ecef;
                        border-radius: 8px;
                        padding: 15px;
                        margin-bottom: 15px;
                        transition: all 0.3s ease;
                    }
                    
                    #conteudoNotaModal .nota-item:hover {
                        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                        transform: translateY(-2px);
                    }
                    
                    #conteudoNotaModal .nota-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 10px;
                    }
                    
                    #conteudoNotaModal .nota-titulo {
                        font-weight: bold;
                        color: #2c3e50;
                        font-size: 1.1rem;
                    }
                    
                    #conteudoNotaModal .nota-data {
                        color: #666;
                        font-size: 0.9rem;
                    }
                    
                    #conteudoNotaModal .nota-conteudo {
                        color: #444;
                        line-height: 1.6;
                        white-space: pre-line;
                    }
                    
                    #conteudoNotaModal .status-badge {
                        display: inline-block;
                        padding: 4px 12px;
                        border-radius: 20px;
                        font-size: 0.8rem;
                        font-weight: bold;
                        text-transform: uppercase;
                    }
                    
                    #conteudoNotaModal .status-publicada {
                        background: #d4edda;
                        color: #155724;
                    }
                    
                    #conteudoNotaModal .status-rascunho {
                        background: #fff3cd;
                        color: #856404;
                    }
                    
                    #conteudoNotaModal .status-revisada {
                        background: #cce5ff;
                        color: #004085;
                    }
                    
                    #conteudoNotaModal .status-aprovada {
                        background: #d1ecf1;
                        color: #0c5460;
                    }
                    
                    /* Estilo para bot√µes do cabe√ßalho */
                    .modal-header .btn-light {
                        background-color: rgba(255, 255, 255, 0.2);
                        border: 1px solid rgba(255, 255, 255, 0.3);
                        color: white;
                        transition: all 0.2s ease;
                    }
                    
                    .modal-header .btn-light:hover {
                        background-color: rgba(255, 255, 255, 0.3);
                        border-color: rgba(255, 255, 255, 0.5);
                        color: white;
                    }
                `;
                document.head.appendChild(style);
                console.log('‚úÖ Estilos da p√°gina de visualiza√ß√£o do boletim aplicados com sucesso!');
            } else {
                document.getElementById('conteudoNotaModal').innerHTML = `
                    <div class="text-center py-5">
                        <div class="alert alert-danger border-0 shadow-sm" style="border-radius: 15px;">
                            <i class="fas fa-exclamation-triangle fa-2x mb-3 text-danger"></i>
                            <h5 class="alert-heading">Erro ao carregar a nota</h5>
                            <p class="mb-0">N√£o foi poss√≠vel carregar o conte√∫do da nota. Tente novamente.</p>
                        </div>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('‚ùå Erro ao carregar nota:', error);
            document.getElementById('conteudoNotaModal').innerHTML = `
                <div class="text-center py-5">
                    <div class="alert alert-danger border-0 shadow-sm" style="border-radius: 15px;">
                        <i class="fas fa-exclamation-triangle fa-2x mb-3 text-danger"></i>
                        <h5 class="alert-heading">Erro de conex√£o</h5>
                        <p class="mb-0">Erro ao carregar a nota: ${error.message}</p>
                        <hr>
                        <small class="text-muted">Verifique sua conex√£o e tente novamente.</small>
                    </div>
                </div>
            `;
        });
}

// Fun√ß√µes para os bot√µes de a√ß√£o das notas
function devolverNotaOrigem(numeroNota, notaId) {
    if (confirm(`Tem certeza que deseja devolver a nota ${numeroNota} para sua origem?`)) {
        fetch(`/militares/ajax/devolver-nota-origem/${notaId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Nota devolvida para origem com sucesso!');
                location.reload();
            } else {
                alert('Erro ao devolver nota: ' + (result.error || 'Erro desconhecido'));
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao devolver nota para origem');
        });
    }
}

function transferirNotaBoletim(numeroNota, notaId) {
    const boletimDestino = prompt(`Digite o n√∫mero do boletim de destino para transferir a nota ${numeroNota}:`);
    if (boletimDestino) {
        fetch(`/militares/ajax/transferir-nota-boletim/${notaId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ boletim_destino: boletimDestino })
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Nota transferida com sucesso!');
                location.reload();
            } else {
                alert('Erro ao transferir nota: ' + (result.error || 'Erro desconhecido'));
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao transferir nota');
        });
    }
}

function showToast(type, message) {
    // Implementar sistema de toast se necess√°rio
    alert(message);
}

// Fun√ß√£o auxiliar para obter CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    console.log(`üç™ CSRF Token obtido: ${cookieValue ? cookieValue.substring(0, 10) + '...' : 'N√ÉO ENCONTRADO'}`);
    
    // Fallback: tentar obter do meta tag
    if (!cookieValue) {
        const metaToken = document.querySelector('meta[name="csrf-token"]');
        if (metaToken) {
            cookieValue = metaToken.getAttribute('content');
            console.log(`üç™ CSRF Token do meta: ${cookieValue ? cookieValue.substring(0, 10) + '...' : 'N√ÉO ENCONTRADO'}`);
        }
    }
    
    // Fallback: tentar obter do input hidden
    if (!cookieValue) {
        const inputToken = document.querySelector('[name=csrfmiddlewaretoken]');
        if (inputToken) {
            cookieValue = inputToken.value;
            console.log(`üç™ CSRF Token do input: ${cookieValue ? cookieValue.substring(0, 10) + '...' : 'N√ÉO ENCONTRADO'}`);
        }
    }
    
    return cookieValue;
}

// Vari√°veis globais para controle da edi√ß√£o
let notaIdAtual = null;
let modoEdicao = false;
let conteudoOriginal = null;

// Verificar se as fun√ß√µes est√£o sendo definidas
console.log('üîß Definindo fun√ß√µes de edi√ß√£o...');

// Definir fun√ß√µes no escopo global
window.editarNotaModal = function() {
    console.log('üîß FUN√á√ÉO editarNotaModal CHAMADA!');
    console.log('üîß notaIdAtual:', notaIdAtual);
    
    if (!notaIdAtual) {
        console.error('‚ùå ID da nota n√£o encontrado');
        alert('Erro: ID da nota n√£o encontrado');
        return;
    }
    
    modoEdicao = true;
    
    // Mostrar/ocultar bot√µes
    document.getElementById('btnEditarNota').style.display = 'none';
    document.getElementById('btnSalvarNota').style.display = 'inline-block';
    document.getElementById('btnCancelarEdicao').style.display = 'inline-block';
    
    // Converter conte√∫do para formul√°rio edit√°vel
    converterParaFormularioEdicao();
};

// Fun√ß√£o para converter o conte√∫do visualizado em formul√°rio edit√°vel
function converterParaFormularioEdicao() {
    const conteudoModal = document.getElementById('conteudoNotaModal');
    
    // Salvar conte√∫do original para poss√≠vel cancelamento
    conteudoOriginal = conteudoModal.innerHTML;
    
    // Buscar dados da nota para edi√ß√£o
    console.log('üîç Buscando dados da nota para edi√ß√£o...');
    fetch(`/militares/notas/${notaIdAtual}/editar-modal/`)
        .then(response => {
            console.log('üì° Resposta do editar-modal:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('üìä Dados recebidos do editar-modal:', data);
            if (data.success) {
                const nota = data.nota;
                console.log('üìÑ Dados da nota:', nota);
                
                // Criar formul√°rio de edi√ß√£o
                conteudoModal.innerHTML = `
                    <div class="container-fluid p-4">
                        <form id="formEdicaoNota">
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="tituloEdicao" class="form-label">T√≠tulo da Nota</label>
                                    <input type="text" class="form-control" id="tituloEdicao" value="${nota.titulo || ''}" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="origemEdicao" class="form-label">Origem da Publica√ß√£o</label>
                                    <input type="text" class="form-control" id="origemEdicao" value="${nota.origem_publicacao || ''}">
                                </div>
                                <div class="col-md-6">
                                    <label for="tipoEdicao" class="form-label">Tipo de Publica√ß√£o</label>
                                    <input type="text" class="form-control" id="tipoEdicao" value="${nota.tipo_publicacao || ''}">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="topicosEdicao" class="form-label">T√≥picos</label>
                                    <textarea class="form-control" id="topicosEdicao" rows="3">${nota.topicos || ''}</textarea>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="conteudoEdicao" class="form-label">Conte√∫do da Nota</label>
                                    <div id="editorEdicao" style="min-height: 300px; border: 1px solid #ced4da; border-radius: 0.375rem; padding: 10px;"></div>
                                </div>
                            </div>
                        </form>
                    </div>
                `;
                
                // Inicializar editor de texto rico
                inicializarEditorEdicao(nota.conteudo || '');
            } else {
                console.error('‚ùå Erro ao carregar dados da nota:', data.error);
                alert('Erro ao carregar dados da nota: ' + (data.error || 'Erro desconhecido'));
            }
        })
        .catch(error => {
            console.error('‚ùå Erro ao carregar dados da nota:', error);
            alert('Erro ao carregar dados da nota: ' + error.message);
        });
}

// Fun√ß√£o para inicializar o editor de texto rico
function inicializarEditorEdicao(conteudoInicial) {
    const editorElement = document.getElementById('editorEdicao');
    if (editorElement) {
        editorElement.innerHTML = conteudoInicial;
        editorElement.contentEditable = true;
        editorElement.style.outline = 'none';
        
        // Adicionar estilos b√°sicos de formata√ß√£o
        editorElement.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'b':
                        e.preventDefault();
                        document.execCommand('bold');
                        break;
                    case 'i':
                        e.preventDefault();
                        document.execCommand('italic');
                        break;
                    case 'u':
                        e.preventDefault();
                        document.execCommand('underline');
                        break;
                }
            }
        });
    }
}

// Fun√ß√£o para salvar as altera√ß√µes
window.salvarNotaModal = function() {
    console.log('üîß FUN√á√ÉO salvarNotaModal CHAMADA!');
    console.log('üîß Iniciando salvamento da nota...');
    
    if (!notaIdAtual) {
        console.error('‚ùå ID da nota n√£o encontrado');
        alert('Erro: ID da nota n√£o encontrado');
        return;
    }
    
    console.log('üìù Coletando dados do formul√°rio...');
    
    // Coletar dados do formul√°rio
    const titulo = document.getElementById('tituloEdicao').value;
    const origem = document.getElementById('origemEdicao').value;
    const tipo = document.getElementById('tipoEdicao').value;
    const topicos = document.getElementById('topicosEdicao').value;
    const conteudo = document.getElementById('editorEdicao').innerHTML;
    
    console.log('üìä Dados coletados:');
    console.log('  - T√≠tulo:', titulo);
    console.log('  - Origem:', origem);
    console.log('  - Tipo:', tipo);
    console.log('  - T√≥picos:', topicos);
    console.log('  - Conte√∫do (primeiros 100 chars):', conteudo.substring(0, 100) + '...');
    
    if (!titulo.trim()) {
        console.error('‚ùå T√≠tulo n√£o preenchido');
        alert('Por favor, preencha o t√≠tulo da nota');
        return;
    }
    
    // Preparar dados para envio
    const formData = new FormData();
    formData.append('titulo', titulo);
    formData.append('origem_publicacao', origem);
    formData.append('tipo_publicacao', tipo);
    formData.append('topicos', topicos);
    formData.append('conteudo', conteudo);
    
    console.log('üì§ Enviando dados para o servidor...');
    console.log('üîó URL:', `/militares/notas/${notaIdAtual}/editar-ajax/`);
    
    // Obter CSRF token
    const csrfToken = getCookie('csrftoken') || 
                     document.querySelector('[name=csrfmiddlewaretoken]')?.value ||
                     document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
    
    console.log('üîê CSRF Token final:', csrfToken ? csrfToken.substring(0, 10) + '...' : 'N√ÉO ENCONTRADO');
    
    if (!csrfToken) {
        console.error('‚ùå CSRF Token n√£o encontrado');
        alert('Erro: Token de seguran√ßa n√£o encontrado. Recarregue a p√°gina e tente novamente.');
        return;
    }
    
    // Enviar dados para o servidor
    fetch(`/militares/notas/${notaIdAtual}/editar-ajax/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
    })
    .then(response => {
        console.log('üì° Resposta recebida:', response.status, response.statusText);
        console.log('üì° Headers da resposta:', response.headers);
        
        if (!response.ok) {
            console.error('‚ùå Resposta n√£o OK:', response.status, response.statusText);
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        return response.text().then(text => {
            console.log('üìÑ Resposta bruta:', text);
            try {
                return JSON.parse(text);
            } catch (e) {
                console.error('‚ùå Erro ao fazer parse do JSON:', e);
                console.error('‚ùå Texto recebido:', text);
                throw new Error('Resposta n√£o √© um JSON v√°lido');
            }
        });
    })
    .then(data => {
        console.log('üìä Dados da resposta:', data);
        if (data.success) {
            console.log('‚úÖ Nota atualizada com sucesso!');
            alert('Nota atualizada com sucesso!');
            // Voltar ao modo de visualiza√ß√£o
            cancelarEdicaoModal();
            // Recarregar o conte√∫do da nota
            visualizarNotaModal(notaIdAtual);
        } else {
            console.error('‚ùå Erro ao salvar nota:', data.error);
            alert('Erro ao salvar nota: ' + (data.error || 'Erro desconhecido'));
        }
    })
    .catch(error => {
        console.error('‚ùå Erro ao salvar nota:', error);
        alert('Erro ao salvar nota: ' + error.message);
    });
};

// Fun√ß√£o para cancelar a edi√ß√£o
window.cancelarEdicaoModal = function() {
    modoEdicao = false;
    
    // Mostrar/ocultar bot√µes
    document.getElementById('btnEditarNota').style.display = 'inline-block';
    document.getElementById('btnSalvarNota').style.display = 'none';
    document.getElementById('btnCancelarEdicao').style.display = 'none';
    
    // Restaurar conte√∫do original
    if (conteudoOriginal) {
        document.getElementById('conteudoNotaModal').innerHTML = conteudoOriginal;
    }
};

// Fun√ß√£o de teste para verificar se o salvamento est√° funcionando
window.testarSalvamento = function() {
    console.log('üß™ TESTE: Fun√ß√£o testarSalvamento chamada!');
    console.log('üß™ TESTE: notaIdAtual:', notaIdAtual);
    console.log('üß™ TESTE: modoEdicao:', modoEdicao);
    
    // Verificar se os elementos existem
    const titulo = document.getElementById('tituloEdicao');
    const conteudo = document.getElementById('editorEdicao');
    
    console.log('üß™ TESTE: Elementos encontrados:');
    console.log('  - tituloEdicao:', titulo);
    console.log('  - editorEdicao:', conteudo);
    
    if (titulo) {
        console.log('üß™ TESTE: Valor do t√≠tulo:', titulo.value);
    }
    
    if (conteudo) {
        console.log('üß™ TESTE: Conte√∫do do editor:', conteudo.innerHTML.substring(0, 100) + '...');
    }
    
    // Chamar a fun√ß√£o original
    console.log('üß™ TESTE: Chamando salvarNotaModal...');
    salvarNotaModal();
};

// Verificar se as fun√ß√µes foram definidas corretamente
console.log('üîß Verificando fun√ß√µes definidas:');
console.log('  - window.editarNotaModal:', typeof window.editarNotaModal);
console.log('  - window.salvarNotaModal:', typeof window.salvarNotaModal);
console.log('  - window.cancelarEdicaoModal:', typeof window.cancelarEdicaoModal);
console.log('  - visualizarNotaModal:', typeof visualizarNotaModal);
</script>

{% endblock %}
