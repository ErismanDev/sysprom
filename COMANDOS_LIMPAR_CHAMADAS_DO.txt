==========================================
COMANDOS PARA LIMPAR CHAMADAS PENDENTES
==========================================

# No servidor Digital Ocean:

# 1. Conectar ao servidor
ssh seprom@64.23.185.235

# 2. Ir para o diretório do projeto
cd /home/seprom/sepromcbmepi

# 3. Ativar ambiente virtual
source venv/bin/activate

# 4. Abrir shell do Django
python manage.py shell

# 5. Executar comandos Python:
from militares.models import Chamada
from django.utils import timezone

# Limpar chamadas pendentes antigas
chamadas_antigas = Chamada.objects.filter(
    status__in=['INICIANDO', 'CHAMANDO', 'EM_ANDAMENTO'],
    data_inicio__lt=timezone.now() - timezone.timedelta(minutes=5)
)
count = chamadas_antigas.count()
chamadas_antigas.update(status='CANCELADA', data_fim=timezone.now())
print(f"✅ {count} chamada(s) cancelada(s)")

# OU cancelar todas as chamadas pendentes:
Chamada.objects.filter(
    status__in=['INICIANDO', 'CHAMANDO', 'EM_ANDAMENTO']
).update(status='CANCELADA', data_fim=timezone.now())

# Sair do shell
exit()

# 6. Limpar cache do navegador e testar novamente

